function ai(){import.meta.url,import("_").catch(()=>1);async function*t(){}}function D(t,e=""){e||(e="show");let o=e==="show"?"block":"none";jQuery(t).css("display",o)}function g(t){const e={"&":"&amp;","<":"&lt;",">":"&gt;",'"':"&quot;","'":"&#039"};return t.replace(/[&<>"']/g,o=>e[o])}function Pt(){const{decimal_separator:t}=acfw_edit_coupon,e=jQuery(this);let o=e.val()+"";o=="0"+t&&e.val("0"),!(o=="0"||o.substring(0,2)=="0"+t)&&(o=o.replace(/^0+/,""),o=o.substring(0,1)==t?"0"+o:o,e.val(o))}function gt(t,e,o="value",i="label"){return t.map(c=>'<option value="'.concat(c[o],'" ').concat(c[o]==e?"selected":"",">").concat(c[i],"</option>")).toString().replace(/>,</g,"><")}function p(t,e){return t==e?"selected":""}function Kt(t="",e=!1){const{currency_symbol:o,discount_field_options:i}=acfw_edit_coupon,{nodiscount:c,override:a,percent:n,fixed:s}=i,l='<option value="nodiscount" '.concat(p(t,"nodiscount"),">= : ").concat(c,"</option>");return"\n    ".concat(e?l:"",'\n    <option value="override" ').concat(p(t,"override"),">").concat(o," : ").concat(a,'</option>\n    <option value="percent" ').concat(p(t,"percent"),">% : ").concat(n,'</option>\n    <option value="fixed" ').concat(p(t,"fixed"),">-").concat(o," : ").concat(s,"</option>\n  ")}function st(t=""){const{exactly:e,anyexcept:o,morethan:i,lessthan:c}=acfw_edit_coupon.condition_field_options;return'\n    <option value="=" '.concat(p(t,"="),">").concat(e,'</option>\n    <option value="!=" ').concat(p(t,"!="),">").concat(o,'</option>\n    <option value=">" ').concat(p(t,">"),">").concat(i,'</option>\n    <option value="<" ').concat(p(t,"<"),">").concat(c,"</option>\n  ")}function Xt(t=""){const{exists:e,notexist:o}=acfw_edit_coupon.condition_exists_field_option;return'\n    <option value="exists" '.concat(p(t,"exists"),">").concat(e,'</option>\n    <option value="notexist" ').concat(p(t,"notexist"),">").concat(o,"</option>\n  ")}function R(t){const{decimal_separator:e}=acfw_edit_coupon,o=parseFloat(t.replace(e,"."));return isNaN(o)?0:o}const Ot=jQuery,{cart_weight:K}=acfw_edit_coupon.cart_condition_fields;function Zt(){K.default_data_value={},K.template_callback=Gt,K.scraper_callback=Yt}function Gt(t){const{condition:e,value:o}=t,{title:i,desc:c,field:a}=K,{condition_label:n}=acfw_edit_coupon;return'\n    <div class="cart-weight-field condition-field" data-type="cart-weight">\n        <a class="remove-condition-field" href="javascript:void(0);"><i class="dashicons dashicons-trash"></i></a>\n        <h3 class="condition-field-title">'.concat(i,"</h3>\n        <label>").concat(c,'</label>\n        <div class="field-control">\n            <label>').concat(n,'</label>\n            <select class="condition-select">\n                ').concat(st(e),'\n            </select>\n        </div>\n        <div class="field-control">\n            <label>').concat(a,'</label>\n            <input class="condition-value wc_input_decimal" type="text" value="').concat(o>=0?o:"",'">\n        </div>\n    </div>\n    ')}function Yt(t){return{condition:Ot(t).find(".condition-select").val(),value:Ot(t).find(".condition-value").val()}}function Et(t){const{product_id:e,product_label:o,condition_label:i,quantity:c}=t;return'\n    <tr>\n        <td class="product" data-product="'.concat(g(JSON.stringify(t)),'" data-product_id="').concat(e,'">\n            ').concat(o,'\n        </td>\n        <td class="condition">').concat(i,'</td>\n        <td class="quantity">').concat(c,'</td>\n        <td class="actions">\n            <a class="edit" href="javascript:void(0)"><span class="dashicons dashicons-edit"></span></a>\n            <a class="remove" href="javascript:void(0)"><span class="dashicons dashicons-no"></span></a>\n        </td>\n    </tr>\n    ')}function Wt(t=4){const{no_products_added:e}=acfw_edit_coupon;return'\n    <tr class="no-result">\n        <td colspan="'.concat(t,'">').concat(e,"</td>\n    </tr>\n    ")}const te=jQuery,{product_quantity:X}=acfw_edit_coupon.cart_condition_fields;function ee(){X.default_data_value={},X.template_callback=oe,X.scraper_callback=ie}function oe(t){const{add_product_label:e}=acfw_edit_coupon,{title:o,product_col:i,condition_col:c,quantity_col:a}=X;let n="";const s=[];if(t.length)for(let l of t)s.push(l.product_id),n+=Et(l);else n=Wt(4);return'\n    <div class="product-quantity-condition-field condition-set"  data-type="product-quantity">\n        <a class="remove-condition-field" href="javascript:void(0);"><i class="dashicons dashicons-trash"></i></a>\n        <h3 class="condition-field-title">'.concat(o,'</h3>\n        <table class="product-quantity-condition-table acfw-styled-table" data-exclude="').concat(JSON.stringify(s),'">\n            <thead>\n                <tr>\n                    <th class="product">').concat(i,'</th>\n                    <th class="condition">').concat(c,'</th>\n                    <th class="quantity">').concat(a,'</th>\n                    <th class="actions"></th>\n                </tr>\n            </thead>\n            <tbody>\n                ').concat(n,'\n            </tbody>\n            <tfoot>\n                <tr>\n                    <td colspan="4">\n                        <a class="add-table-row" href="javascript:void(0);">\n                            <i class="dashicons dashicons-plus"></i>\n                            ').concat(e,"\n                        </a>\n                    </td>\n                </tr>\n            </tfoot>\n        </table>\n    </div>\n    ")}function ie(t){const e=t.querySelectorAll(".product-quantity-condition-table tr td.product"),o=[];return e.forEach(i=>o.push(te(i).data("product"))),o}const ce=jQuery,{customer_registration_date:wt}=acfw_edit_coupon.cart_condition_fields;function ae(){wt.template_callback=ne,wt.scraper_callback=se}function ne(t){const{title:e,desc:o,hours:i}=wt;return'\n    <div class="customer-registration-date-field condition-field" data-type="customer-registration-date">\n\n        <a class="remove-condition-field" href="javascript:void(0);"><i class="dashicons dashicons-trash"></i></a>\n        <h3 class="condition-field-title">'.concat(e,"</h3>\n\n        <label>").concat(o,'</label>   \n        <div class="field-control side-label">\n            <input class="condition-value" type="number" min="1" value="').concat(t&&t>-1?t:0,'">\n            <label>').concat(i,"</label>\n        </div>\n    </div>\n    ")}function se(t){return parseInt(ce(t).find(".condition-value").val())}const le=jQuery,{customer_last_ordered:xt}=acfw_edit_coupon.cart_condition_fields;function de(){xt.template_callback=re,xt.scraper_callback=ue}function re(t){const{title:e,desc:o,hours:i}=xt;return'\n    <div class="customer-last-ordered-field condition-field" data-type="customer-last-ordered">\n        <a class="remove-condition-field" href="javascript:void(0);"><i class="dashicons dashicons-trash"></i></a>\n        <h3 class="condition-field-title">'.concat(e,"</h3>\n        <label>").concat(o,'</label>    \n        <div class="field-control side-label">\n            <input class="condition-value" type="number" min="0" value="').concat(t&&t>-1?t:0,'">\n            <label>').concat(i,"</label>\n        </div>\n    </div>\n    ")}function ue(t){return parseInt(le(t).find(".condition-value").val())}const _t=jQuery,{total_customer_spend:Z}=acfw_edit_coupon.cart_condition_fields;function pe(){Z.default_data_value={},Z.template_callback=_e,Z.scraper_callback=fe}function _e(t){const{condition:e,value:o,offset:i}=t,{condition_label:c}=acfw_edit_coupon,{title:a,desc:n,total_spend:s,days_offset:l}=Z,d=o?R(o):0;return'\n    <div class="total-customer-spend-field condition-field" data-type="total-customer-spend">\n        <a class="remove-condition-field" href="javascript:void(0);"><i class="dashicons dashicons-trash"></i></a>\n        <h3 class="condition-field-title">'.concat(a,"</h3>\n        <label>").concat(n,'</label>\n        <div class="field-control">\n            <label>').concat(c,'</label>\n            <select class="condition-select">\n                ').concat(st(e),'\n            </select>\n        </div>\n        <div class="field-control">\n            <label>').concat(s,'</label>\n            <input class="condition-value wc_input_price" type="text" min="0" value="').concat(!isNaN(d)&&d>-1?o:0,'">\n        </div>\n        <div class="field-control">\n            <label>').concat(l,'</label>\n            <input class="condition-offset" type="number" min="0" value="').concat(i&&i>-1?i:0,'">\n        </div>\n    </div>\n    ')}function fe(t){return{condition:_t(t).find(".condition-select").val(),value:_t(t).find(".condition-value").val(),offset:_t(t).find(".condition-offset").val()}}class he{table_placeholder_row_template(e=4){const{no_products_added:o}=acfw_edit_coupon;return' \n            <tr class="no-result">\n                <td colspan="'.concat(e,'">').concat(o,"</td>\n            </tr>\n        ")}table_markup(){const{add_product_label:e}=acfw_edit_coupon,{tableproduct:o}=acfw_psaeic,{products:i}=o,{label:c}=i;return'\n            <table class="product-stock-availability-exists-in-cart-table acfw-styled-table">\n                <thead>\n                    <tr>\n                        <th class="product">'.concat(c.columns.product,'</th>\n                        <th class="condition">').concat(c.columns.condition,'</th>\n                        <th class="actions"></th>\n                    </tr>\n                </thead>\n                <tbody>\n                    ').concat((()=>{let a="";if(i&&i.data&&i.data.length)for(let n of i.data)o.row.data=n,a+=o.row.template_view_row();else a=o.template.table_placeholder_row_template(4);return a})(),'\n                </tbody>\n                <tfoot>\n                    <tr>\n                        <td colspan="4">\n                            <a class="psaeic-btn-add-category-row" href="javascript:void(0);" onclick="acfw_psaeic.tableproduct.trigger.trigger_btn_add_category(event)">\n                                <i class="dashicons dashicons-plus"></i>\n                                ').concat(e,"\n                            </a>\n                        </td>\n                    </tr>\n                </tfoot>\n            </table>\n        ")}}const L=jQuery;class be{trigger_btn_add_category(e){const{tableproduct:o}=acfw_psaeic,i=e.currentTarget;o.row.element.$button=L(i),o.row.data=o.row.data_initial(),o.row.add()}trigger_btn_action_add(e){const{tableproduct:o}=acfw_psaeic,i=e.currentTarget;o.row.element.$button=L(i),o.row.view()}trigger_btn_action_edit(e){const{tableproduct:o}=acfw_psaeic,i=e.currentTarget;o.row.element.$button=L(i),o.row.edit()}trigger_btn_action_cancel(e){const{tableproduct:o}=acfw_psaeic,i=e.currentTarget;o.row.element.$button=L(i),o.row.cancel()}trigger_btn_action_remove(e){const{tableproduct:o}=acfw_psaeic,i=e.currentTarget;o.row.element.$button=L(i),o.row.detect(),o.row.remove()}}const S=jQuery;class ve{constructor(){this._element={$button:S(null),$table:S(this),$tbody:S(this),$row:S(this),$product:S(this),$condition:S(this),colspan:4,data:[]},this._data=this.data_initial()}get element(){return this._element}set element(e){this._element=e}get data(){return this._data}data_initial(){return{product:{id:0,label:""},condition:{id:"",label:""}}}set data(e){this._data=e}template_initiate_select2(){this._element.$tbody.find("select.wc-product-search").trigger("change"),S("body").trigger("wc-enhanced-select-init")}template_add_edit_row(){const{tableproduct:e}=acfw_psaeic,{products:o}=e,{edit:i,add:c,cancel:a}=acfw_edit_coupon.product_table_buttons,{type_to_search:n}=acfw_edit_coupon.bogo_form_fields;return'\n            <tr class="add-edit-form adding">\n                <td class="product" data-product="'.concat(typeof this._data=="object"?g(JSON.stringify(this._data)):0,'">\n                    <div class="object-search-wrap">\n                        <select class="psaeic-select-product wc-product-search" data-placeholder="').concat(n,'" data-action="acfwp_add_products_search">\n                            ').concat(typeof this._data=="object"&&this._data.product.id?'<option value="'.concat(this._data.product.id,'" selected>').concat(this._data.product.label,"</option>"):"",'\n                        </select>                        \n                    </div>\n                </td>\n                <td class="condition">                \n                    <select class="condition-select psaeic-select-condition">\n                        ').concat(Object.keys(o.options.conditions).map(s=>{let l=o.options.conditions[s],d=typeof this._data=="object"&&this._data.condition.id==s?"selected":"";return'<option value="'.concat(s,'" ').concat(d,">").concat(l,"</option>")}).join(""),'\n                    </select> \n                </td>\n                <td class="actions">\n                    <button type="button" class="button-primary psaeic-btn-add" onclick="acfw_psaeic.tableproduct.trigger.trigger_btn_action_add(event)">').concat(typeof this._data=="object"&&this._data.product.id?i:c,'</button>\n                    <button type="button" class="button psaeic-btn-cancel" onclick="acfw_psaeic.tableproduct.trigger.trigger_btn_action_cancel(event)">').concat(a,"</button>\n                </td>\n            </tr>\n        ")}template_view_row(){return'\n            <tr>\n                <td class="product product-'.concat(this._data.product.id,' object" data-product="').concat(g(JSON.stringify(this._data)),'">\n                    ').concat(this._data.product.label,'\n                </td>\n                <td class="condition">').concat(this._data.condition.label,'</td>\n                <td class="actions">\n                    <a class="psaeic-btn-edit" href="javascript:void(0)" onclick="acfw_psaeic.tableproduct.trigger.trigger_btn_action_edit(event)"><span class="dashicons dashicons-edit"></span></a>\n                    <a class="psaeic-btn-remove" href="javascript:void(0)" onclick="acfw_psaeic.tableproduct.trigger.trigger_btn_action_remove(event)"><span class="dashicons dashicons-no"></span></a>\n                </td>\n            </tr>\n        ')}detect(){this._element.$button&&(this._element.$row=this._element.$button.closest("tr"),this._element.$table=this._element.$button.closest(".acfw-styled-table"),this._element.$tbody=this._element.$table.find("tbody"),this._element.$product=this._element.$row.find(".psaeic-select-product"),this._element.$condition=this._element.$row.find(".psaeic-select-condition"),this._element.colspan=this._element.$row.find("td").length,this._element.data=this._element.$row.find("td.product").data("product"))}read(){var i,c,a,n,s,l,d;const{$product:e,$condition:o}=this._element;this._data={product:{id:parseInt((c=(i=e==null?void 0:e.val())==null?void 0:i.toString())!=null?c:""),label:(s=(n=(a=S(e))==null?void 0:a.select2("data")[0])==null?void 0:n.text.replace("\n","").replace(/\s+/g," ").trim())!=null?s:""},condition:{id:(d=(l=o==null?void 0:o.val())==null?void 0:l.toString())!=null?d:"",label:o.find("option:selected").text().replace("\n","").replace(/\s+/g," ").trim()}}}validate(e=!0){const{tableproduct:o}=acfw_psaeic,{fill_form_propery_error_msg:i}=acfw_edit_coupon,{$product:c,$condition:a}=this._element,{product:n}=this._data;return!c.val()||!a.val()?(vex.dialog.alert(i),!1):(this._element.$table.find("td.product.object").each(function(){if(S(this).data("product").product.id==n.id)return vex.dialog.alert(o.products.exists),!1}),e)}add(){this.detect(),!(this._data.product.id&&!this.validate())&&(this._element.$tbody.find("tr.no-result").remove(),this._element.$tbody.append(this.template_add_edit_row()),this.template_initiate_select2())}edit(){this.detect(),this._data=this._element.data,this._element.$row.replaceWith(this.template_add_edit_row()),this.template_initiate_select2()}view(e={}){this.template_initiate_select2(),this.detect(),Object.keys(e).length||this.read(),this.validate()&&this._element.$row.replaceWith(this.template_view_row())}cancel(){this.detect(),this.remove()}remove(){const{tableproduct:e}=acfw_psaeic;this._element.$row.remove(),this._element.$tbody.find("tr").length<=0&&this._element.$tbody.html(e.template.table_placeholder_row_template(this._element.colspan))}}class me{constructor(){this._products={},this._trigger={},this._template={},this._row={}}get products(){return this._products}set products(e){this._products=e}get template(){return this._template}get trigger(){return this._trigger}get row(){return this._row}build(){this._row=new ve,this._template=new he,this._trigger=new be,this.save()}save(){window.acfw_psaeic={...acfw_edit_coupon.cart_condition_fields.acfw_product_stock_availability_exists_in_cart,tableproduct:this}}}const $e=jQuery,{product_stock_availability_exists_in_cart:G}=acfw_edit_coupon.cart_condition_fields;function ye(){G.default_data_value={},G.template_callback=ge,G.scraper_callback=we}function ge(t={}){const{title:e,products:o}=G;o.data=t.products;const i=new me;return i.products=o,i.build(),'\n        <div class="product-stock-availability-exists-in-cart-field condition-set" data-type="product-stock-availability-exists-in-cart">\n            <a class="remove-condition-field" href="javascript:void(0);"><i class="dashicons dashicons-trash"></i></a>\n            <h3 class="condition-field-title">'.concat(e,"</h3>\n            \n            ").concat(i.template.table_markup(),"\n        </div>\n    ")}function we(t){const e=t.querySelectorAll(".product-stock-availability-exists-in-cart-table tr td.product"),o=[];return e.forEach(i=>o.push($e(i).data("product"))),{products:o}}const ft=jQuery,{has_ordered_before:ht}=acfw_edit_coupon.cart_condition_fields;function xe(){ht.default_data_value={},ht.template_callback=ke,ht.scraper_callback=je}function ke(t={}){const{condition:e,value:o,products:i}=t,{cart_condition_fields:c,add_product_label:a}=acfw_edit_coupon,{product_col:n,condition_col:s,quantity_col:l}=c.product_quantity,{title:d,type:r,within_a_period:f,number_of_orders:z,num_prev_days:j}=c.has_ordered_before,Q=[];let w="";if(i&&i.length)for(let O of i)Q.push(O.product_id),w+=Et(O);else w=Wt(4);return'\n    <div class="cart-quantity-field condition-field condition-set" data-type="has-ordered-before">\n        <a class="remove-condition-field" href="javascript:void(0);"><i class="dashicons dashicons-trash"></i></a>\n        <h3 class="condition-field-title">'.concat(d,'</h3>\n        <div class="field-control">\n            <label>').concat(r,'</label>\n            <select class="condition-select has-ordered-before-type">\n                <option value="within-a-period" ').concat(p(e,"within-a-period"),">").concat(f,'</option>\n                <option value="number-of-orders" ').concat(p(e,"number-of-orders"),">").concat(z,'</option>\n            </select>\n        </div>\n        <div class="field-control condition-type-value">\n            <label>').concat(j,'</label>\n            <input class="condition-value" type="number" min="0" value="').concat(o,'">\n        </div>\n        <table class="has-ordered-before-products-table acfw-styled-table" data-exclude="').concat(JSON.stringify(Q),'">\n            <thead>\n                <tr>\n                    <th class="product">').concat(n,'</th>\n                    <th class="condition">').concat(s,'</th>\n                    <th class="quantity">').concat(l,'</th>\n                    <th class="actions"></th>\n                </tr>\n            </thead>\n            <tbody>\n                ').concat(w,'\n            </tbody>\n            <tfoot>\n                <tr>\n                    <td colspan="4">\n                        <a class="add-table-row" href="javascript:void(0);">\n                            <i class="dashicons dashicons-plus"></i>\n                            ').concat(a,"\n                        </a>\n                    </td>\n                </tr>\n            </tfoot>\n        </table>\n    </div>\n    ")}function je(t){const e=t.querySelectorAll(".has-ordered-before-products-table tr td.product"),o=[];return e.forEach(i=>o.push(ft(i).data("product"))),{condition:ft(t).find(".condition-select").val(),value:parseInt(ft(t).find(".condition-value").val()),products:o}}const T=jQuery,{has_ordered_product_categories_before:bt}=acfw_edit_coupon.cart_condition_fields;function qe(){bt.default_data_value={},bt.template_callback=ze,bt.scraper_callback=Qe,Se()}function Se(){const t=document.querySelector("#acfw_cart_conditions");T(t).on("change","select.hopcb-select-type-condition",function(){const{within_a_period_label:e,number_of_orders_label:o}=acfw_edit_coupon,i=T(this),c=i.closest(".has-ordered-product-categories-before-field"),a=c.find(".hopcb-condition-type-value label");i.val()==="within-a-period"?a.text(e):a.text(o)})}function ze(t={}){const{condition:e,quantity:o}=t,{condition_label:i,cart_condition_fields:{cart_quantity:{field:c},has_ordered_product_categories_before:{title:a,type:n,within_a_period:s,number_of_orders:l,num_prev_days:d,categories:r},product_category:{placeholder:f}},condition_field_options:{exactly:z,anyexcept:j,morethan:Q,lessthan:w}}=acfw_edit_coupon;let O=t.type&&t.type.label?t.type.label:s,rt=[{value:"within-a-period",label:s},{value:"number-of-orders",label:l}],ut=[{value:"=",label:z},{value:"!=",label:j},{value:">",label:Q},{value:"<",label:w}];return'\n        <div class="has-ordered-product-categories-before-field condition-field condition-set" data-type="has-ordered-product-categories-before">\n            <a class="remove-condition-field" href="javascript:void(0);"><i class="dashicons dashicons-trash"></i></a>\n            <h3 class="condition-field-title">'.concat(a,'</h3>\n            \n            <div class="field-control">\n                <label>').concat(n,'</label>\n                <select class="hopcb-select-type-condition">                    \n                    ').concat(rt.map(v=>{let m=t.type?t.type.condition:"within-a-period";const{value:$,label:W}=v;return'<option value="'.concat($,'" ').concat(p(m,$),">").concat(W,"</option>")}).join(""),'\n                </select>\n            </div>\n            <div class="field-control hopcb-condition-type-value">\n                <label>').concat(O,'</label>\n                <input class="hopcb-select-type-value" type="number" min="0" value="').concat(t.type&&t.type.value?t.type.value:0,'">\n            </div>\n            <div class="field-control categories">\n                <label></label>\n                <select class="hopcb-select-categories wc-enhanced-select" multiple data-placeholder="').concat(f,'">\n                    ').concat(Object.keys(r.options).map(v=>{let m=r.options[v];const $=t.categories&&t.categories.indexOf(parseInt(v))>=0?"selected":"";return'<option value="'.concat(v,'" ').concat($,">").concat(m,"</option>")}).join(""),'\n                </select>\n            </div>\n            <div class="field-control">\n                <label>').concat(i,'</label>\n                <select class="hopcb-select-condition">\n                    ').concat(ut.map(v=>{const{value:m,label:$}=v;let pt=(t.condition?t.condition:">")===m?"selected":"";return'<option value="'.concat(m,'" ').concat(pt,">").concat($,"</option>")}).join(""),'\n                </select>\n            </div>\n            <div class="field-control">\n                <label>').concat(c,'</label>\n                <input type="number" class="hopcb-select-quantity" value="').concat(o,'" min="').concat(e=="<"?1:0,'">\n            </div>\n            \n        </div>\n    ')}function Lt(t){if(t==null||typeof t=="string"&&t.trim()===""||Array.isArray(t)&&t.length===0)return!1;if(typeof t=="object"){for(const e in t)if(!Lt(t[e]))return!1}return!0}function Qe(t){t.querySelectorAll(".has-ordered-product-categories-before-table tr td.category");let e={categories:T(t).find(".hopcb-select-categories").val(),condition:T(t).find(".hopcb-select-condition").val(),quantity:T(t).find(".hopcb-select-quantity").val(),type:{condition:T(t).find(".hopcb-select-type-condition").val(),label:T(t).find(".hopcb-select-type-condition option:selected").text(),value:T(t).find(".hopcb-select-type-value").val()}};return Lt(e)?e:!1}const I=jQuery,{total_customer_spend_on_product_category:vt}=acfw_edit_coupon.cart_condition_fields;function Oe(){vt.default_data_value={},vt.template_callback=Te,vt.scraper_callback=Ie,Ce()}function Ce(){const t=document.querySelector("#acfw_cart_conditions");I(t).on("change","select.tcspc-select-type-condition",function(){const{within_a_period_label:e,number_of_orders_label:o}=acfw_edit_coupon,i=I(this),c=i.closest(".total-customer-spend-on-product-category-field"),a=c.find(".tcspc-condition-type-value label");i.val()==="within-a-period"?a.text(e):a.text(o)})}function Te(t={}){const{condition:e,spend:o}=t,{condition_label:i,cart_condition_fields:{total_customer_spend:{total_spend:c},total_customer_spend_on_product_category:{title:a,type:n,within_a_period:s,number_of_orders:l,num_prev_days:d,categories:r},product_category:{placeholder:f}},condition_field_options:{exactly:z,anyexcept:j,morethan:Q,lessthan:w}}=acfw_edit_coupon;let O=t.type&&t.type.label?t.type.label:s,rt=[{value:"within-a-period",label:s},{value:"number-of-orders",label:l}],ut=[{value:"=",label:z},{value:"!=",label:j},{value:">",label:Q},{value:"<",label:w}];return'\n        <div class="total-customer-spend-on-product-category-field condition-field condition-set" data-type="total-customer-spend-on-product-category">\n            <a class="remove-condition-field" href="javascript:void(0);"><i class="dashicons dashicons-trash"></i></a>\n            <h3 class="condition-field-title">'.concat(a,'</h3>\n            \n            <div class="field-control">\n                <label>').concat(n,'</label>\n                <select class="tcspc-select-type-condition">                    \n                    ').concat(rt.map(v=>{let m=t.type?t.type.condition:"within-a-period";const{value:$,label:W}=v;return'<option value="'.concat($,'" ').concat(p(m,$),">").concat(W,"</option>")}).join(""),'\n                </select>\n            </div>\n            <div class="field-control tcspc-condition-type-value">\n                <label>').concat(O,'</label>\n                <input class="tcspc-select-type-value" type="number" min="0" value="').concat(t.type&&t.type.value?t.type.value:0,'">\n            </div>\n            <div class="field-control categories">\n                <label></label>\n                <select class="tcspc-select-categories wc-enhanced-select" multiple data-placeholder="').concat(f,'">\n                    ').concat(Object.keys(r.options).map(v=>{let m=r.options[v];const $=t.categories&&t.categories.indexOf(parseInt(v))>=0?"selected":"";return'<option value="'.concat(v,'" ').concat($,">").concat(m,"</option>")}).join(""),'\n                </select>\n            </div>\n            <div class="field-control">\n                <label>').concat(i,'</label>\n                <select class="tcspc-select-condition">\n                    ').concat(ut.map(v=>{const{value:m,label:$}=v;let pt=(t.condition?t.condition:">")===m?"selected":"";return'<option value="'.concat(m,'" ').concat(pt,">").concat($,"</option>")}).join(""),'\n                </select>\n            </div>\n            <div class="field-control">\n                <label>').concat(c,'</label>\n                <input type="text" class="tcspc-select-spend wc_input_decimal" value="').concat(o!=null?o:0,'">\n            </div>\n            \n        </div>\n    ')}function Vt(t){if(t==null||typeof t=="string"&&t.trim()===""||Array.isArray(t)&&t.length===0)return!1;if(typeof t=="object"){for(const e in t)if(!Vt(t[e]))return!1}return!0}function Ie(t){let e={categories:I(t).find(".tcspc-select-categories").val(),condition:I(t).find(".tcspc-select-condition").val(),spend:I(t).find(".tcspc-select-spend").val(),type:{condition:I(t).find(".tcspc-select-type-condition").val(),label:I(t).find(".tcspc-select-type-condition option:selected").text(),value:I(t).find(".tcspc-select-type-value").val()}};return Vt(e)?e:!1}const Ct=jQuery,{shipping_zone_region:Y}=acfw_edit_coupon.cart_condition_fields;function Ne(){Y.default_data_value={},Y.template_callback=Fe,Y.scraper_callback=De}function Fe(t){const{value:e}=t,{title:o,zone_label:i,zone_placeholder:c,regions_label:a,regions_placeholder:n,zone_options:s}=Y,l=e&&e.length?e:[];return'\n    <div class="shipping-zone-region-field condition-field" data-type="shipping-zone-region"\n        data-zones="'.concat(g(JSON.stringify(s)),'"\n        data-regions="').concat(g(JSON.stringify(l)),'">\n        <a class="remove-condition-field" href="javascript:void(0);"><i class="dashicons dashicons-trash"></i></a>\n        <h3 class="condition-field-title">').concat(o,'</h3>\n        <div class="field-control">\n            <label>').concat(i,'</label>\n            <select class="condition-select wc-enhanced-select" data-placeholder="').concat(g(c),'">\n                <option value="">').concat(c,"</option>\n                ").concat(Ae(t,s),'\n            </select>\n        </div>\n        <div class="field-control regions">\n            <label>').concat(a,'</label>\n            <select class="condition-value wc-enhanced-select" multiple data-placeholder="').concat(g(n),'">\n            </select>\n        </div>\n    </div>\n    ')}function De(t){return{condition:Ct(t).find(".condition-select").val(),value:Ct(t).find(".condition-value").val()}}function Ae(t,e){const{condition:o}=t;let i="";for(let c in e){const a=e[c];i+='\n            <option value="'.concat(c,'" ').concat(p(o,c),">\n                ").concat(a.name,"\n            </option>\n        ")}return i}const H=jQuery,{custom_taxonomy:V}=acfw_edit_coupon.cart_condition_fields,{cart_condition_fields:Me,condition_field_options:Je}=acfw_edit_coupon;function Pe(){V.default_data_value={},V.template_callback=Ee,V.scraper_callback=We}function Ee(t){const{condition:e,value:o,qtyCondition:i,quantity:c}=t,{title:a,select_taxonomy:n,product_type:s,select_terms:l}=V,{field:d}=Me.cart_quantity,{condition_label:r}=acfw_edit_coupon,{exactly:f,anyexcept:z,morethan:j,lessthan:Q}=Je,w=i||">",O=o&&o.length?o:[];return'\n    <div class="custom-taxonomy-field condition-field" data-type="custom-taxonomy" \n      data-selected_terms="'.concat(g(JSON.stringify(O)),'">\n      <a class="remove-condition-field" href="javascript:void(0);"><i class="dashicons dashicons-trash"></i></a>\n      <h3 class="condition-field-title">').concat(a,'</h3>\n      <div class="field-control">\n        <select class="condition-select wc-enhanced-select custom-taxonomy" data-placeholder="').concat(n,'">\n          <option value="">').concat(n,"</option>\n          ").concat(Le(e),'\n        </select>\n      </div>\n      <div class="field-control field-control-wide">\n        <select class="condition-value wc-enhanced-select" multiple data-placeholder="').concat(l,'">\n        </select>\n      </div>\n      <div class="field-control condition">\n            <label>').concat(r,'</label>\n            <select class="condition-select qty-condition-select">\n                <option value="=" ').concat(w=="="?"selected":"",">").concat(f,'</option>\n                <option value="!=" ').concat(w=="!="?"selected":"",">").concat(z,'</option>\n                <option value=">" ').concat(w==">"?"selected":"",">").concat(j,'</option>\n                <option value="<" ').concat(w=="<"?"selected":"",">").concat(Q,'</option>\n            </select>\n        </div>\n        <div class="field-control quantity">\n            <label>').concat(d,'</label>\n            <input type="number" class="condition-quantity" value="').concat(typeof c=="number"?c:0,'" min="').concat(i=="<"?1:0,'">\n        </div>\n    </div>\n    ')}function We(t){return{condition:H(t).find(".condition-select").val(),value:H(t).find(".condition-value").val(),qtyCondition:H(t).find(".qty-condition-select").val(),quantity:H(t).find(".condition-quantity").val()}}function Le(t){const{tax_options:e,product_type:o}=V;let i="";for(let c of e){const{name:a,label:n}=c;i+='\n      <option value="'.concat(a,'" ').concat(p(t,a),">\n        ").concat(n,"\n      </option>\n    ")}return i}const U=jQuery,{cart_condition_fields:qt}=acfw_edit_coupon,{custom_user_meta:mt,custom_cart_item_meta:$t}=qt;function Ve(){mt.default_data_value={},mt.template_callback=Tt,mt.scraper_callback=It,$t.default_data_value={},$t.template_callback=Tt,$t.scraper_callback=It}function Tt(t,e){const{condition:o,key:i,value:c,type:a}=t,{condition_label:n}=acfw_edit_coupon,{title:s,meta_key:l,meta_value:d,value_type:r}=qt[e],f=e.replace(/_/g,"-");return'\n    <div class="'.concat(f,'-field condition-field" data-type="').concat(f,'">\n      <a class="remove-condition-field" href="javascript:void(0);"><i class="dashicons dashicons-trash"></i></a>\n      <h3 class="condition-field-title">').concat(s,'</h3>\n      <div class="field-control wider">\n        <label>').concat(r,'</label>\n        <select class="value-type">\n          ').concat(Be(a,e),'\n        </select>\n      </div>\n      <div class="field-control">\n        <label>').concat(n,'</label>\n        <select class="condition-select">\n          ').concat(st(o),"\n          ").concat(e==="custom_cart_item_meta"?Xt(o):"",'\n        </select>\n      </div>\n      <div class="field-control wider">\n        <label>').concat(l,'</label>\n        <input class="condition-key" type="text" value="').concat(i||"",'">\n      </div>\n      <div class="field-control wider">\n        <label>').concat(d,'</label>\n        <input class="condition-value" type="text" value="').concat(c||c>-1?c:"",'">\n      </div>\n    </div>\n  ')}function It(t){return{condition:U(t).find(".condition-select").val(),key:U(t).find(".condition-key").val(),value:U(t).find(".condition-value").val(),type:U(t).find(".value-type").val()}}function Be(t,e){const{type_options:o}=qt[e];let i="";for(let c in o){const a=o[c];i+='<option value="'.concat(c,'" ').concat(p(t,c),">").concat(a,"</option>")}return i}const yt=jQuery,{number_of_orders:tt}=acfw_edit_coupon.cart_condition_fields;function Re(){tt.default_data_value={},tt.template_callback=He,tt.scraper_callback=Ue}function He(t){const{condition:e,value:o,offset:i}=t,{condition_label:c}=acfw_edit_coupon,{title:a,desc:n,count_label:s,prev_days_label:l}=tt;return'\n    <div class="number-of-orders-field cart-quantity-field condition-field" data-type="number-of-orders">\n      <a class="remove-condition-field" href="javascript:void(0);"><i class="dashicons dashicons-trash"></i></a>\n      <h3 class="condition-field-title">'.concat(a,"</h3>\n      <label>").concat(n,'</label>\n      <div class="field-control">\n        <label>').concat(c,'</label>\n        <select class="condition-select">\n            ').concat(st(e),'\n        </select>\n      </div>\n      <div class="field-control">\n          <label>').concat(s,'</label>\n          <input class="condition-value" type="number" min="0" value="').concat(o>=0?o:"",'">\n      </div>\n      <div class="field-control">\n          <label>').concat(l,'</label>\n          <input class="condition-offset" type="number" min="0" value="').concat(i>=0?i:"",'">\n      </div>\n    </div>\n  ')}function Ue(t){return{condition:yt(t).find(".condition-select").val(),value:yt(t).find(".condition-value").val(),offset:yt(t).find(".condition-offset").val()}}const et=jQuery;function Ke(){const t=document.querySelector("#acfw_cart_conditions");ee(),Zt(),ae(),de(),pe(),ye(),xe(),qe(),Oe(),Ne(),Pe(),Ve(),Re(),et(t).on("change","input.condition-value",Xe),et(t).on("change",".custom-cart-item-meta-field .condition-select",Ze)}function Xe(){const t=et(this);if(t.closest(".condition-field").find("select.value-type").val()==="number"){const i=parseInt(t.val()+"");t.val(isNaN(i)?"":Math.round(i))}}function Ze(){var i;const t=et(this),o=t.closest(".condition-field").find(".condition-value");["exists","notexist"].includes(t.val().toString())?(o.val(0),o.prop("disabled",!0),o.parent().hide()):["exists","notexist"].includes((i=t.data("prevValue"))==null?void 0:i.toString())&&(o.val(""),o.prop("disabled",!1),o.parent().show()),t.data("prevValue",t.val().toString())}const Nt=jQuery,Ft=document.querySelector("#acfw_add_products");function E(t){Nt(Ft).data("editing",t),Nt(Ft).find("#save-add-products").prop("disabled",!t)}function Bt(t=[],e=!1){const{discount_type:o,discount_value:i}=e,{edit:c,add:a,cancel:n}=acfw_edit_coupon.product_table_buttons,{type_to_search:s}=acfw_edit_coupon.bogo_form_fields,l=typeof e=="object"?Ge(e):"",d=typeof e=="object"?c:a,r=i&&R(i)>=0&&o!=="nodiscount"?i:"";return'\n    <tr class="add-edit-form adding">\n        <td class="product" data-object="'.concat(typeof e=="object"?g(JSON.stringify(e)):0,'">\n            <div class="object-search-wrap">\n                <select class="product-in-cart wc-product-search"\n                    data-placeholder="').concat(s,'"\n                    data-action="acfwp_add_products_search"\n                    data-exclude="').concat(g(JSON.stringify(t)),'">').concat(l,'</select>\n            </div>\n        </td>\n        <td class="quantity">\n            <input type="number" class="condition-quantity" value="').concat(typeof e=="object"?e.quantity:1,'" min="1">\n        </td>\n        <td class="price">\n            <div>\n            <select class="discount_type">\n                ').concat(Kt(o,!0),'\n            </select>\n            <input type="text" class="discount_value short wc_input_price" value="').concat(r,'">\n            </div>\n        </td>\n        <td class="actions">\n            <button type="button" class="condition-product-add button-primary">').concat(d,'</button>\n            <button type="button" class="cancel button">').concat(n,"</button>\n        </td>\n    </tr>\n    ")}function Ge(t){const{product_id:e,product_label:o}=t;return'<option value="'.concat(e,'">').concat(o,"</option>")}function St(t){const{product_id:e,product_label:o,quantity:i,discount_type:c,discount_value:a}=t,n=c!=="nodiscount"?a:"";return'\n    <tr>\n        <td class="product product-'.concat(e,' object" data-product="').concat(g(JSON.stringify(t)),'">\n            ').concat(o,'\n        </td>\n        <td class="quantity">').concat(i,'</td>\n        <td class="price">(').concat(c,") ").concat(n,'</td>\n        <td class="actions">\n            <a class="edit" href="javascript:void(0)"><span class="dashicons dashicons-edit"></span></a>\n            <a class="remove" href="javascript:void(0)"><span class="dashicons dashicons-no"></span></a>\n        </td>\n    </tr>\n    ')}function lt(t=4){const{no_products_added:e}=acfw_edit_coupon;return'\n    <tr class="no-result">\n        <td colspan="'.concat(t,'">').concat(e,"</td>\n    </tr>\n    ")}const kt=jQuery;function Ye(){const t=kt(this),e=t.closest(".acfw-styled-table"),o=e.find("tbody"),i=e.data("exclude");o.find("tr.no-result").remove(),o.append(Bt(i)),o.find("select.discount_type").trigger("change"),o.find("select.wc-product-search").trigger("change"),kt("body").trigger("wc-enhanced-select-init")}function to(){const t=jQuery(this),e=t.closest("tr"),o=t.closest(".acfw-styled-table"),i=o.find("tbody"),c=e.find(".product").data("product"),{product_id:a}=c;let n=o.data("exclude");n=typeof n=="object"?n:[],n.splice(n.indexOf(a),1),i.find("tr.no-result").remove(),e.replaceWith(Bt(n,c)),i.find("select.discount_type").trigger("change"),i.find("select.wc-product-search").trigger("acfw_product_select"),o.data("exclude",n),o.find("select.wc-product-search").data("exclude",n),kt("body").trigger("wc-enhanced-select-init")}function eo(){const{fill_form_propery_error_msg:t,product_exists_in_table:e}=acfw_edit_coupon,o=jQuery(this),i=o.closest("tr"),c=o.closest("table.acfw-styled-table"),a=i.find(".wc-product-search"),n=i.find(".condition-quantity"),s=i.find("select.discount_type").val().toString(),l=i.find("input.discount_value").val().toString();let d=c.data("exclude");const r=parseInt(i.find(".wc-product-search").val().toString()),f={product_id:r,quantity:parseInt(i.find(".condition-quantity").val().toString()),product_label:i.find(".wc-product-search option:selected").text(),discount_type:s,discount_value:l};if(!a.val()||!n.val()||n.val()<1||s!=="nodiscount"&&(isNaN(R(l))||R(l)<0)){vex.dialog.alert(t);return}if(d.includes(r)){vex.dialog.alert(acfw_edit_coupon.product_exists_in_table);return}d=typeof d=="object"?d:[],d.push(r),i.replaceWith(St(f)),c.data("exclude",d),c.find(".wc-product-search").data("exclude",d),E(!0)}function oo(){const t=jQuery(this),e=t.closest("tr"),o=t.closest("table"),i=e.closest("tbody"),c=e.find("td").length,a=e.find("td.product").data("object");let n=o.data("exclude");if(n.includes(a.product_id)){vex.dialog.alert(acfw_edit_coupon.product_exists_in_table);return}typeof a=="object"?(n=typeof n=="object"?n:[],n.push(a.product_id),e.replaceWith(St(a)),o.data("exclude",n),o.find(".wc-product-search").data("exclude",n)):(e.remove(),i.find("tr").length<=0&&i.html(lt(c)))}function io(){const t=jQuery(this),e=t.closest("tr"),o=e.closest("table"),i=e.closest("tbody"),c=e.find("td").length,a=e.find("td.object").data("product"),n=o.data("exclude"),s=n.indexOf(parseInt(a.product_id));s!==-1&&n.splice(s,1),o.data("exclude",n),o.find(".wc-product-search").data("exclude",n),e.remove(),i.find("tr").length<=0&&i.html(lt(c)),E(!0)}const u=jQuery,{post_id:ot}=woocommerce_admin_meta_boxes,k=document.querySelector("#acfw_add_products"),it=k?k.querySelector(".acfw-overlay"):null;function co(){u("#acfw_bogo_deals").find(".acfw-styled-table tr.add-edit-form button.cancel").trigger("click");const{post_status:t}=acfw_edit_coupon,e=k.querySelectorAll("table.acfw-styled-table tbody td.object"),o=k.querySelector(".add-before-cart-condition-check-field input[type='checkbox']");let i=[],c;e.forEach(a=>{c=u(a).data("product"),c&&i.push(c)}),D(it,"show"),u.post(ajaxurl,{action:"acfw_save_add_products_data",coupon_id:ot,products:i.length?i:"empty",add_before_conditions:u(o).is(":checked")?1:0,nonce:u("#acfw_add_products").data("nonce")},a=>{a.status=="success"?t!=="publish"&&(u("input[name='post_title']").val()||u("input[name='post_title']").val("coupon-"+ot),u("select[name='post_status']").append(new Option("Published","publish")).val("publish"),u("#publishing-action").append('\n                    <input type="hidden" name="publish" value="Publish">\n                '),u("input#publish").click()):a.error_msg&&(vex.dialog.alert(a.error_msg),console.log(a),u(k).addClass("save-error")),u(k).find("button#clear-add-products").prop("disabled",!1),E(!1),D(it,"hide")},"json")}function ao(){const t=u(this);if(!confirm(t.data("prompt")))return;const e=k.querySelector("table.acfw-styled-table tbody");D(it,"show"),u.post(ajaxurl,{action:"acfw_clear_add_products_data",coupon_id:ot,_wpnonce:t.data("nonce")},o=>{o.status=="success"?(u(e).html(lt(4)),t.prop("disabled",!0),E(!1),u("#post-status-display").text()!="Published"&&(u("input[name='post_title']").val()||u("input[name='post_title']").val("coupon-"+ot),u("input#publish").click())):(o.error_msg&&vex.dialog.alert(o.error_msg),console.log(o)),D(it,"hide")},"json")}function no(t){u(".coupon_data_tabs").find(".acfw_add_products_tab").hasClass("active")&&u(k).data("editing")&&(t.preventDefault(),u(k).find("#save-add-products").trigger("click"),setTimeout(()=>{u(k).hasClass("save-error")?u(k).removeClass("save-error"):u("form#post").submit()},1e3))}const F=jQuery,_=document.querySelector("#acfw_add_products");function so(t=jQuery){t(_).on("click",".acfw-styled-table tfoot .add-table-row",Ye),t(_).on("click",".acfw-styled-table td.actions a.edit",to),t(_).on("click","tr.add-edit-form .actions .condition-product-add",eo),t(_).on("click","tr.add-edit-form .actions .cancel",oo),t(_).on("click",".acfw-styled-table td.actions a.remove",io),t(_).on("click","button#save-add-products",co),t(_).on("click","button#clear-add-products",ao),t(_).on("change","select.discount_type",ro),t(_).on("blur",".wc_input_price",Pt),t("form#post").on("submit",no),t(_).css("min-height",t("#coupon_options ul.coupon_data_tabs").height()+10),t(_).on("click",".acfw-styled-table .actions .remove",()=>E(!0)),t(_).on("change","input[name='add_before_cart_condition']",()=>E(!0)),lo(),t(document).ajaxComplete(uo),t(_).on("change","select.discount_type",po)}function lo(){const t=F(_).data("products"),e=F(_).find(".add-products-data-table tbody");if(t.length>0){let o="";t.forEach(i=>{o+=St(i)}),e.html(o)}else e.html(lt(4))}function ro(){const t=F(this);t.closest("tr").find(".discount_value").prop("disabled",t.val()==="nodiscount")}function uo(t,e){const o=e.getResponseHeader("X-Subscription-IDs");if(!o)return;let i=F(_).data("subscription_ids")||[];const c=o.split(",").map(a=>parseInt(a));F(_).data("subscription_ids",[...i,...c].filter((a,n,s)=>s.indexOf(a)===n))}function po(){const t=F(_).data("subscription_ids")||[];if(!t.length)return;const e=F(this),i=e.closest("tr").find("select.wc-product-search"),c=parseInt(i.val());!t.includes(c)||e.val()==="nodiscount"||(vex.dialog.alert(F(_).data("subscription_discount_error")),e.val("nodiscount"),e.trigger("change"))}var N=jQuery;function _o(){N("body").on("change","#customer_email,#acfw_auto_apply_coupon_field,#usage_limit,#usage_limit_per_user,#_acfw_enable_virtual_coupons",fo),N("#customer_email,#acfw_auto_apply_coupon_field").trigger("change")}function fo(){const t=N("#customer_email"),e=parseInt(N("#usage_limit").val()),o=parseInt(N("#usage_limit_per_user").val()),i=N("#acfw_auto_apply_coupon_field"),c=N("#_acfw_enable_virtual_coupons").is(":checked"),a=N("#acfw-auto-apply-coupon .auto-apply-warning");(t.val()||e||o||c)&&i.prop("checked")?a.show():a.hide()}var ho=jQuery;function bo(){const t=ho(this),e=t.closest("tr"),o=e.find(".select-shipping-method"),i=e.closest(".acfw-styled-table");i.data("exclude");const c=i.data("zonemethods")||[],a=c.filter(s=>s.zone_id==t.val()),n=a.length?a[0].methods:[];o.empty(),n.length&&(n.map(s=>o.append(new Option(s.label,s.value))),o.trigger("change"))}function vo(t){const e=t.find(".select-shipping-zone"),o=e.find("option:first");t.removeClass("fresh"),e.val(o.prop("value")),e.trigger("change")}const Dt=jQuery,At=document.querySelector("#acfw_shipping_overrides");function dt(t){Dt(At).data("editing",t),Dt(At).find("#save-shipping-overrides").prop("disabled",!t)}function zt(t){const{no_shipping_overrides_added:e}=acfw_edit_coupon;return'\n        <tr class="no-result">\n            <td colspan="'.concat(t,'">').concat(e,"</td>\n        </tr>\n    ")}const h=jQuery,A=document.querySelector("#acfw_shipping_overrides"),{post_id:jt}=woocommerce_admin_meta_boxes;function mo(){const{post_status:t}=acfw_edit_coupon,e=A.querySelector(".acfw-overlay"),o=h(this),i=A.querySelectorAll(".shipping-overrides-table tbody tr td.object"),c=[];i.forEach(a=>{c.push(h(a).data("object"))}),D(e,"show"),o.prop("disabled",!0),h.post(ajaxurl,{action:"acfw_save_shipping_overrides",coupon_id:jt,overrides:c.length?c:"empty",nonce:h("#acfw_shipping_overrides").data("nonce")},a=>{a.status=="success"?t!=="publish"&&(h("input[name='post_title']").val()||h("input[name='post_title']").val("coupon-"+jt),h("select[name='post_status']").append(new Option("Published","publish")).val("publish"),h("#publishing-action").append('\n            <input type="hidden" name="publish" value="Publish">\n          '),h("input#publish").click()):(a.error_msg&&vex.dialog.alert(a.error_msg),console.log(a)),h(A).find("#clear-shipping-overrides").prop("disabled",!1),dt(!1),D(e,"hide")},"json")}function $o(){const t=h(this);if(!confirm(t.data("prompt")))return;const e=h(A.querySelector("table.acfw-styled-table")),o=e.find("tbody"),i=A.querySelector(".acfw-overlay");D(i,"show"),h.post(ajaxurl,{action:"acfw_clear_shipping_overrides",coupon_id:woocommerce_admin_meta_boxes.post_id,_wpnonce:t.data("nonce")},c=>{if(c.status=="success"){let a=e.find("thead tr th").length;o.html(""),o.find("tr").length<=0&&o.append(zt(a)),e.data("exclude",[]),t.prop("disabled",!0),dt(!1),jQuery("#post-status-display").text()!="Published"&&(jQuery("input[name='post_title']").val()||jQuery("input[name='post_title']").val("coupon-"+jt),jQuery("input#publish").click())}else c.error_msg&&vex.dialog.alert(c.error_msg),console.log(c);D(i,"hide")},"json")}function Rt(t){h(A).data("editing")&&(t.preventDefault(),h(A).find("#save-shipping-overrides").trigger("click"),h("form#post").off("submit",Rt),setTimeout(()=>{h("form#post").submit()},1e3))}const yo=jQuery,go=document.querySelector("#acfw_shipping_overrides");function Ht(t={}){const{add:e,edit:o,cancel:i}=acfw_edit_coupon.product_table_buttons,{shipping_zone:c,discount_type:a,discount_value:n}=t,l=yo(go).find(".shipping-overrides-table").data("zonemethods")||[],d=l.map(j=>({value:j.zone_id,label:j.zone_name})),r=n&&R(n)>=0?n:"",f=c>=0||c==="nozone"?o:e;return'\n    <tr class="add-edit-form fresh">\n      <td class="shipping-zone" data-object="'.concat(g(JSON.stringify(t)),'">\n        <div>\n          <select class="select-shipping-zone wc-enhanced-select" data-placeholder="Select shipping zone">\n            ').concat(gt(d,c),'\n          </select>\n        </div>\n      </td>\n      <td class="shipping-method">\n        <div>\n          <select class="select-shipping-method wc-enhanced-select" data-placeholder="Select shipping method">\n            ').concat(wo(l,t),'\n          </select>\n        </div>\n      </td>\n      <td class="discount">\n        <select class="discount-type">\n          ').concat(xo(a),'\n        </select>\n        <input type="text" class="discount_value short wc_input_price" value="').concat(r,'">\n      </td>\n      <td class="actions">\n        <button type="button" class="add button-primary">').concat(f,'</button>\n        <button type="button" class="cancel button">').concat(i,"</button>\n      </td>\n    </tr>\n  ")}function wo(t,e){const{shipping_zone:o,shipping_method:i}=e;if(o==="nozone"&&i||o>=0&&i){const c=t.filter(n=>n.zone_id==o),a=c.length?c[0].methods:[];return gt(a,i)}else{const c=t.length?t[0].methods:[];return gt(c,i)}}function xo(t=""){const{currency_symbol:e,discount_field_options:o}=acfw_edit_coupon,{override:i,percent:c,fixed:a}=o;return'\n    <option value="percent" '.concat(p(t,"percent"),">% : ").concat(c,'</option>\n    <option value="fixed" ').concat(p(t,"fixed"),">-").concat(e," : ").concat(a,'</option>\n    <option value="override" ').concat(p(t,"override"),">").concat(e," : ").concat(i,"</option>\n  ")}const ko=jQuery,jo=document.querySelector("#acfw_shipping_overrides");function Qt(t){const{shipping_zone:e,discount_type:o,discount_value:i,shipping_method:c}=t,s=(ko(jo).find(".shipping-overrides-table").data("zonemethods")||[]).filter(f=>f.zone_id==e);if(!s.length)return"";const{zone_name:l,methods:d}=s[0],r=d.filter(f=>f.value==c);return r.length?'\n    <tr>\n      <td class="shipping-zone object" data-object="'.concat(g(JSON.stringify(t)),'">\n        ').concat(l,'\n      </td>\n      <td class="shipping-method">\n        ').concat(r[0].label,'\n      </td>\n      <td class="discount">\n        (').concat(o,") ").concat(i,'\n      </td>\n      <td class="actions">\n        <a class="edit" href="javascript:void(0);">\n          <span class="dashicons dashicons-edit"></span>\n        </a>\n        <a class="remove" href="javascript:void(0);">\n          <span class="dashicons dashicons-no"></span>\n        </a>\n      </td>\n    </tr>\n  '):""}const ct=jQuery;function qo(){const t=ct(this),e=t.closest(".acfw-styled-table"),o=e.find("tbody");e.data("exclude"),o.find("tr.no-result").remove(),o.append(Ht()),ct("body").trigger("wc-enhanced-select-init");const i=e.find("tr.add-edit-form.fresh");vo(i)}function So(){const{fill_form_propery_error_msg:t,shipping_zone_already_added:e}=acfw_edit_coupon,o=ct(this),i=o.closest("tr"),c=i.closest(".acfw-styled-table");let a=parseInt(i.find(".select-shipping-zone").val()+""),n=i.find(".select-shipping-method").val()+"";a=a>=0&&!isNaN(a)?a:"nozone";let s=c.data("exclude");if((a<0||!n)&&!(a==="nozone"&&n)){vex.dialog.alert(t);return}if(s.filter(d=>d.zone==a&&d.method==n).length){vex.dialog.alert(e);return}const l={shipping_zone:a,shipping_method:n,discount_type:i.find(".discount-type").val(),discount_value:i.find(".discount_value").val()};i.replaceWith(Qt(l)),s.push({zone:a,method:n}),c.data("exclude",s),dt(!0)}function zo(){const t=jQuery(this),e=t.closest("tr"),o=t.closest(".acfw-styled-table"),i=o.find("tbody"),c=e.find(".shipping-zone").data("object");let a=o.data("exclude")||[];a=a.filter(n=>n.zone!=c.shipping_zone||n.method!=c.shipping_method),i.find("tr.no-result").remove(),e.replaceWith(Ht(c)),o.data("exclude",a),ct("body").trigger("wc-enhanced-select-init")}function Qo(){const t=jQuery(this),e=t.closest("tr"),o=t.closest("table"),i=e.closest("tbody"),c=e.find("td").length,a=e.find("td.shipping-zone").data("object");let n=o.data("exclude");n=n.filter(s=>s.zone!=a.shipping_zone||s.method!=a.shipping_method),o.data("exclude",n),e.remove(),i.find("tr").length<=0&&i.append(zt(c)),dt(!0)}function Oo(){const{shipping_zone_already_added:t}=acfw_edit_coupon,e=jQuery(this),o=e.closest("tr"),i=e.closest("table"),c=o.closest("tbody"),a=o.find("td").length,n=o.find("td.shipping-zone").data("object"),{shipping_zone:s,shipping_method:l}=n;let d=i.data("exclude");if(d.filter(r=>r.zone==s&&r.method==l).length){vex.dialog.alert(t);return}s==="nozone"&&l||s>=0&&l?(d.push({zone:s,method:s}),o.replaceWith(Qt(n)),i.data("exclude",d)):(o.remove(),c.find("tr").length<=0&&c.append(zt(a)))}const y=jQuery,x=document.querySelector("#acfw_shipping_overrides");function Co(){y(x).on("click",".acfw-styled-table tfoot .add-table-row",qo),y(x).on("change","tr.add-edit-form .select-shipping-zone",bo),y(x).on("click","tr.add-edit-form .actions .add",So),y(x).on("click","tr .actions .edit",zo),y(x).on("click","tr .actions .remove",Qo),y(x).on("click","tr.add-edit-form .actions .cancel",Oo),y(x).on("blur",".wc_input_price",Pt),y(x).on("click","#save-shipping-overrides",mo),y(x).on("click","#clear-shipping-overrides",$o),y("form#post").on("submit",Rt),y(x).css("min-height",y("#coupon_options ul.coupon_data_tabs").height()+10),To()}function To(){const t=y(x).find(".shipping-overrides-table"),e=t.find("tbody"),o=t.data("overrides");o.length&&(e.find("tr.no-result").remove(),o.forEach(i=>{e.append(Qt(i))}))}const b=jQuery;function Io(){const t=document.querySelector("#acfw_scheduler");b(t).on("change acfw_load",'.days-time-fields input[type="checkbox"]',Do),b(t).on("change acfw_load",".days-time-fields input.time-field",Ao),b(t).on("change",".days-time-fields input.time-field",Mo),b(t).on("change acfw_load",".acfw-scheduler-section .date-field",Jo),b(t).find('.days-time-fields input[type="checkbox"], .days-time-fields input.time-field').trigger("acfw_load"),b(t).find(".acfw-scheduler-section .date-field").trigger("acfw_load"),b(".wrap").on("submit","form#post",Fo),No()}function No(){b(".days-time-fields input.time-field").flatpickr({allowInput:!0,enableTime:!0,noCalendar:!0,altInput:!0,altFormat:"h:i K",dateFormat:"H:i",onOpen:function(t,e,o){if(e===""){var i=new Date;i.setHours(0),i.setMinutes(0),o.setDate(i),b(".days-time-fields input.time-field").trigger("change")}}})}function Fo(t){b(".days-time-fields input.time-field").hasClass("error")&&(t.preventDefault(),vex.dialog.alert({unsafeMessage:acfw_edit_coupon.invalid_scheduler_time}),b("#publishing-action .spinner").removeClass("is-active"),b("#publishing-action #publish").removeClass("disabled"))}function Do(){const t=b(this),e=t.closest(".days-time-field");e.find(".start-time").prop("disabled",!t.is(":checked")||t.is(":disabled")),e.find(".end-time").prop("disabled",!t.is(":checked")||t.is(":disabled"))}function Ao(){const t=b(this).closest(".days-time-field"),e=t.find(".start-time"),o=t.find(".end-time"),i=at(o.val())+1,c=at(e.val())-1,a=i?Mt(i):"",n=c?Mt(c):"";e.attr("max",a!=null?a:""),o.attr("min",n!=null?n:"")}function Mo(){const t=b(this).closest(".days-time-field"),e=t.find(".start-time"),o=t.find(".end-time"),i=at(e.val()),c=at(o.val());i>=c?e.addClass("error"):e.removeClass("error"),c<=i?o.addClass("error"):o.removeClass("error")}function Jo(){const t=b(this).closest(".options_group"),e=t.find("#_acfw_schedule_start"),o=t.find("#_acfw_schedule_expire"),i=Po(e.is(":disabled")?"":e.val(),e.is(":disabled")?"":o.val());Ut().forEach(c=>{const a=b(".".concat(c,"-time-field"));i.includes(c)?a.find('input[type="checkbox"]').prop("disabled",!1).trigger("change"):(a.find('input[type="checkbox"]').prop("disabled",!0),a.find(".time-field").prop("disabled",!0))})}function at(t){const[e,o]=t.split(":").map(i=>parseInt(i));return e*60+o}function Mt(t){const e=Math.floor(t/60),o=t-e*60;return"".concat(String(e).padStart(2,"0"),":").concat(String(o).padStart(2,"0"))}function Po(t,e){const o=Ut(),i=[];if(!t||!e)return o;for(const c=new Date(t);c<=new Date(e);c.setDate(c.getDate()+1))i.push(o[c.getDay()]);return[...new Set(i)]}function Ut(){return["sunday","monday","tuesday","wednesday","thursday","friday","saturday"]}const q=jQuery,{bogo_toggle_editing_mode:Eo}=acfw_edit_coupon,{post_id:Wo}=woocommerce_admin_meta_boxes;function Lo(){const t=document.querySelector("#acfw_bogo_deals");q(t).on("change acfw_load","select#bogo-deals-type",Vo),q(t).on("change acfw_load","select#bogo-condition-type,select#bogo-deals-type",Ro),q(t).on("change acfw_load",".bogo-auto-add-products-field input[type='checkbox']",()=>Eo(!0)),q(t).on("save_bogo_deals",Bo),q(t).find("select#bogo-deals-type").trigger("acfw_load")}function Vo(){const t=q(this),o=t.closest("#acfw_bogo_deals").find(".bogo-auto-add-products-field"),i=o.find("input[type='checkbox']");t.val()==="specific-products"?(i.prop("disabled",!1),o.addClass("show")):(i.prop("disabled",!1),o.removeClass("show"))}function Bo(){const t=q(this),e=t.find("select#bogo-deals-type"),o=t.find(".bogo-auto-add-products-field input[type='checkbox']");e.val()==="specific-products"&&q.post(ajaxurl,{action:"acfw_save_bogo_additional_settings",coupon_id:Wo,auto_add_products:o.is(":checked")?"yes":"no",nonce:q(".bogo-settings-field").data("nonce")})}function Ro(){const t=q("#acfw_bogo_deals"),e=t.find("input[name='bogo_type'][value='once']"),o=t.find("input[name='bogo_type'][value='repeat']"),i=t.find("#bogo-condition-type").val(),c=t.find("#bogo-deals-type").val();t.find(".repeat-incompatible").remove(),c==="any-products"&&i!=="any-products"?(e.prop("checked",!0),o.prop("disabled",!0),o.closest(".radio-group-wrap").append('<span class="repeat-incompatible">'.concat(acfw_edit_coupon.repeat_incompatible_notice,"</span>"))):o.prop("disabled",!1)}const B=document.querySelector(".acfw-sort-coupon-priority-field"),M=jQuery;function Ho(){M(B).on("change","select#_acfw_coupon_sort_select",Uo),M(B).on("change","input#_acfw_coupon_sort_priority",Ko),M(B).find("select#_acfw_coupon_sort_select").trigger("change")}function Uo(){const t=M(this),e=M(B).find("input#_acfw_coupon_sort_priority"),o=t.val().toString();switch(o){case"0":case"1":case"10":case"30":case"50":case"90":e.hide(),e.val(o);break;case"custom":default:e.show(),e.val(M(B).data("value"))}}function Ko(){const t=M(this),e=parseInt(t.val());(isNaN(e)||1>e)&&(vex.dialog.alert(acfw_edit_coupon.coupon_sort_invalid),t.val(""))}const nt=jQuery;function Xo(){nt("body").on("change load_virtual_coupon","#_acfw_enable_virtual_coupons",Zo),nt("#_acfw_enable_virtual_coupons").trigger("load_virtual_coupon")}function Zo(t){const e=jQuery(this),o=e.closest(".inside"),i=nt("select.acfw-allowed-customers");t.type==="change"&&o.find(".save-notice").show(),e.is(":checked")?(o.removeClass("disabled"),i.prop("disabled",!0),i.closest(".options_group").hide(),Jt(!0)):(o.addClass("disabled"),i.closest(".options_group").show(),i.prop("disabled",!1),Jt(!1))}function Jt(t){var i;const e=jQuery(".form-field._acfw_coupon_url_field"),o=jQuery(".form-field._acfw_code_url_override_field");if(t){const c=(i=nt("#acfw-virtual-coupon .feature-control").data("labels"))!=null?i:{};e.find("input,button,span").hide(),e.append('<span class="vc-manage-url-coupon">'.concat(c.url_coupon_message,"</span>")),o.hide()}else e.find(".vc-manage-url-coupon").remove(),e.find("input,button,span").show(),o.show()}jQuery;function Go(){const t=jQuery("p.acfw_exclude_coupons_field"),e=t.closest(".options_group");t.insertAfter("p.form-field.individual_use_field"),e.remove()}const P=jQuery;function Yo(){P("#woocommerce-coupon-data").on("change acfwp_load","#discount_type",ti),P("#woocommerce-coupon-data").on("change acfw_load","select#discount_type",ei),P("#discount_type").trigger("acfwp_load"),P("#_acfw_coupon_label").trigger("acfw_load")}function ti(){const t=P(this),e=t.closest(".woocommerce_options_panel").find("._acfw_percentage_discount_cap_field");t.val()==="percent"||t.val()==="acfw_percentage_cashback"?(e.addClass("show"),e.find("input").prop("disabled",!1)):(e.removeClass("show"),e.find("input").prop("disabled",!0))}function ei(){P("#_acfw_coupon_label").prop("disabled",!1)}const J=jQuery;function oi(){J("#general_coupon_data").on("change acfw_load","#discount_type",ii),J("#general_coupon_data").on("change acfw_load","#discount_type",ci),J("#discount_type").trigger("acfw_load")}function ii(){const t=J(this),e=J("p.coupon_amount_field label"),{cashback_coupon:o}=acfw_edit_coupon;let i=e.data("default_label");switch(i||(e.data("default_label",e.text()),i=e.text()),t.val()){case"acfw_percentage_cashback":e.text(o.cashback_percentage_label);break;case"acfw_fixed_cashback":e.text(o.cashback_amount_label);break;default:e.text(i);break}}function ci(){const t=J(this),e=J("#_acfw_cashback_waiting_period");switch(t.val()){case"acfw_percentage_cashback":case"acfw_fixed_cashback":e.closest("p.form-field").show(),e.prop("disabled",!1);break;default:e.closest("p.form-field").hide(),e.prop("disabled",!0);break}}const{modules:C}=acfw_edit_coupon;jQuery(document).ready(t=>{C.indexOf("acfw_cart_conditions_module")>-1&&Ke(),C.indexOf("acfw_add_free_products_module")>-1&&so(),C.indexOf("acfw_auto_apply_module")>-1&&_o(),C.indexOf("acfw_shipping_overrides_module")>-1&&Co(),C.indexOf("acfw_scheduler_module")>-1&&Io(),C.indexOf("acfw_bogo_deals_module")>-1&&Lo(),C.indexOf("acfw_sort_coupons_module")>-1&&Ho(),C.indexOf("acfw_virtual_coupons_module")>-1&&Xo(),Go(),Yo(),oi()});export{ai as __vite_legacy_guard};
