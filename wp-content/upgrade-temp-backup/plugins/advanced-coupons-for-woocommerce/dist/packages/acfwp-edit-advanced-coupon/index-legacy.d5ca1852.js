System.register([],(function(t,e){"use strict";return{execute:function(){var t=document.createElement("style");function e(t,e=""){e||(e="show");let n="show"===e?"block":"none";jQuery(t).css("display",n)}function n(t){const e={"&":"&amp;","<":"&lt;",">":"&gt;",'"':"&quot;","'":"&#039"};return t.replace(/[&<>"']/g,(t=>e[t]))}function o(){const{decimal_separator:t}=acfw_edit_coupon,e=jQuery(this);let n=e.val()+"";n=="0"+t&&e.val("0"),"0"!=n&&n.substring(0,2)!="0"+t&&(n=n.replace(/^0+/,""),n=n.substring(0,1)==t?"0"+n:n,e.val(n))}function i(t,e,n="value",o="label"){return t.map((t=>`<option value="${t[n]}" ${t[n]==e?"selected":""}>${t[o]}</option>`)).toString().replace(/>,</g,"><")}function a(t,e){return t==e?"selected":""}function c(t=""){const{exactly:e,anyexcept:n,morethan:o,lessthan:i}=acfw_edit_coupon.condition_field_options;return`\n    <option value="=" ${a(t,"=")}>${e}</option>\n    <option value="!=" ${a(t,"!=")}>${n}</option>\n    <option value=">" ${a(t,">")}>${o}</option>\n    <option value="<" ${a(t,"<")}>${i}</option>\n  `}function d(t){const{decimal_separator:e}=acfw_edit_coupon,n=parseFloat(t.replace(e,"."));return isNaN(n)?0:n}t.textContent='#acfw_cart_conditions .cart-weight-field:after{content:"";display:table;clear:both}#acfw_cart_conditions .cart-weight-field label{width:100%}#acfw_cart_conditions .cart-weight-field .field-control{float:left;width:150px;margin:5px 10px 0 0}#acfw_cart_conditions .cart-weight-field .field-control.no-label{margin-top:28px}#acfw_cart_conditions .cart-weight-field .field-control input,#acfw_cart_conditions .cart-weight-field .field-control select{width:100%}#acfw_cart_conditions .cart-weight-field .field-control input[type=checkbox]{width:1rem}#acfw_cart_conditions .cart-weight-field .field-control.wider{width:200px}#acfw_cart_conditions .cart-weight-field .field-control.side-label input{width:80px;margin-right:5px}#acfw_cart_conditions .cart-weight-field .field-control.side-label label{float:left!important;width:auto!important;position:relative;top:5px}#acfw_cart_conditions .has-ordered-product-categories-before-field .field-control.categories{width:100%}#acfw_cart_conditions .has-ordered-product-categories-before-field .select2{width:100%!important}#acfw_cart_conditions .has-ordered-product-categories-before-field .hopcb-btn-remove{color:#dc3332}#acfw_cart_conditions .has-ordered-product-categories-before-field .hopcb-btn-add-category-row{color:#000;font-weight:700;text-decoration:none}#acfw_cart_conditions .product-stock-availability-exists-in-cart-field .field-control.categories{width:100%}#acfw_cart_conditions .product-stock-availability-exists-in-cart-field .select2{width:100%!important}#acfw_cart_conditions .product-stock-availability-exists-in-cart-field .psaeic-btn-remove{color:#dc3332}#acfw_cart_conditions .product-stock-availability-exists-in-cart-field .psaeic-btn-add-category-row{color:#000;font-weight:700;text-decoration:none}#acfw_cart_conditions .total-customer-spend-on-product-category-field .field-control.categories{width:100%}#acfw_cart_conditions .total-customer-spend-on-product-category-field .select2{width:100%!important}#acfw_cart_conditions .total-customer-spend-on-product-category-field .tcspc-btn-remove{color:#dc3332}#acfw_cart_conditions .total-customer-spend-on-product-category-field .tcspc-btn-add-category-row{color:#000;font-weight:700;text-decoration:none}#acfw_add_products{padding-bottom:51px}#acfw_add_products .add-before-cart-condition-check-field{display:inline-block;margin-left:10px}#acfw_add_products .add-before-cart-condition-check-field label{float:none;margin:0;width:auto;font-size:12px}#acfw_add_products .add-before-cart-condition-check-field label input{margin-top:-2px}#acfw_add_products .add-before-cart-condition-check-field label span{display:inline-block;margin-left:5px}.woocommerce_options_panel .date-time-field{float:left;display:flex;width:50%;align-items:top;height:30px}.woocommerce_options_panel .date-time-field input[type=text].date-field{width:calc(100% - 135px);margin-right:5px}.woocommerce_options_panel .date-time-field span{margin-right:5px}.woocommerce_options_panel .date-time-field input.date-hour{width:60px;margin-right:5px}.woocommerce_options_panel .date-time-field input.date-minute{width:60px}.woocommerce_options_panel .clear-scheduler-fields{position:relative;top:2px;display:inline-block;color:#dc3232;text-decoration:none;box-shadow:none!important}.woocommerce_options_panel .acfw-sort-coupon-priority-field select{width:25%;margin-right:5px}.woocommerce_options_panel .acfw-sort-coupon-priority-field input[type=number]{width:calc(25% - 10px)}#acfw_bogo_deals .bogo-auto-add-products-field{display:none}#acfw_bogo_deals .bogo-auto-add-products-field.show{display:block}span.repeat-incompatible{display:inline-block;width:65%;max-width:500px;margin:10px 0 0;padding:5px 10px;border-left:5px solid #11a0d2;box-shadow:0 0 8px -2px rgba(0,0,0,.3)}#acfw-virtual-coupon p.save-notice{border-left:4px solid #11a0d2;padding:.5em .7em;font-size:.9em;box-shadow:0 0 8px -2px rgba(0,0,0,.3)}p._acfw_percentage_discount_cap_field{display:none}p._acfw_percentage_discount_cap_field.show{display:block}#acfw_bogo_deals.migration-running .acfw-overlay{display:block;background-image:none!important}#woocommerce-coupon-data #general_coupon_data.acfw-bogo-type{min-height:auto}#woocommerce-coupon-data #general_coupon_data.acfw-bogo-type p.form-field._acfw_coupon_label_field{display:block}#woocommerce-coupon-data .vc-manage-url-coupon{font-size:13px;font-style:italic}\n',document.head.appendChild(t);const s=jQuery,{cart_weight:l}=acfw_edit_coupon.cart_condition_fields;function r(t){const{condition:e,value:n}=t,{title:o,desc:i,field:a}=l,{condition_label:d}=acfw_edit_coupon;return`\n    <div class="cart-weight-field condition-field" data-type="cart-weight">\n        <a class="remove-condition-field" href="javascript:void(0);"><i class="dashicons dashicons-trash"></i></a>\n        <h3 class="condition-field-title">${o}</h3>\n        <label>${i}</label>\n        <div class="field-control">\n            <label>${d}</label>\n            <select class="condition-select">\n                ${c(e)}\n            </select>\n        </div>\n        <div class="field-control">\n            <label>${a}</label>\n            <input class="condition-value wc_input_decimal" type="text" value="${n>=0?n:""}">\n        </div>\n    </div>\n    `}function p(t){return{condition:s(t).find(".condition-select").val(),value:s(t).find(".condition-value").val()}}function u(t){const{product_id:e,product_label:o,condition_label:i,quantity:a}=t;return`\n    <tr>\n        <td class="product" data-product="${n(JSON.stringify(t))}" data-product_id="${e}">\n            ${o}\n        </td>\n        <td class="condition">${i}</td>\n        <td class="quantity">${a}</td>\n        <td class="actions">\n            <a class="edit" href="javascript:void(0)"><span class="dashicons dashicons-edit"></span></a>\n            <a class="remove" href="javascript:void(0)"><span class="dashicons dashicons-no"></span></a>\n        </td>\n    </tr>\n    `}function _(t=4){const{no_products_added:e}=acfw_edit_coupon;return`\n    <tr class="no-result">\n        <td colspan="${t}">${e}</td>\n    </tr>\n    `}const f=jQuery,{product_quantity:h}=acfw_edit_coupon.cart_condition_fields;function b(t){const{add_product_label:e}=acfw_edit_coupon,{title:n,product_col:o,condition_col:i,quantity_col:a}=h;let c="";const d=[];if(t.length)for(let s of t)d.push(s.product_id),c+=u(s);else c=_(4);return`\n    <div class="product-quantity-condition-field condition-set"  data-type="product-quantity">\n        <a class="remove-condition-field" href="javascript:void(0);"><i class="dashicons dashicons-trash"></i></a>\n        <h3 class="condition-field-title">${n}</h3>\n        <table class="product-quantity-condition-table acfw-styled-table" data-exclude="${JSON.stringify(d)}">\n            <thead>\n                <tr>\n                    <th class="product">${o}</th>\n                    <th class="condition">${i}</th>\n                    <th class="quantity">${a}</th>\n                    <th class="actions"></th>\n                </tr>\n            </thead>\n            <tbody>\n                ${c}\n            </tbody>\n            <tfoot>\n                <tr>\n                    <td colspan="4">\n                        <a class="add-table-row" href="javascript:void(0);">\n                            <i class="dashicons dashicons-plus"></i>\n                            ${e}\n                        </a>\n                    </td>\n                </tr>\n            </tfoot>\n        </table>\n    </div>\n    `}function v(t){const e=t.querySelectorAll(".product-quantity-condition-table tr td.product"),n=[];return e.forEach((t=>n.push(f(t).data("product")))),n}const m=jQuery,{customer_registration_date:y}=acfw_edit_coupon.cart_condition_fields;function g(t){const{title:e,desc:n,hours:o}=y;return`\n    <div class="customer-registration-date-field condition-field" data-type="customer-registration-date">\n\n        <a class="remove-condition-field" href="javascript:void(0);"><i class="dashicons dashicons-trash"></i></a>\n        <h3 class="condition-field-title">${e}</h3>\n\n        <label>${n}</label>   \n        <div class="field-control side-label">\n            <input class="condition-value" type="number" min="1" value="${t&&t>-1?t:0}">\n            <label>${o}</label>\n        </div>\n    </div>\n    `}function w(t){return parseInt(m(t).find(".condition-value").val())}const $=jQuery,{customer_last_ordered:x}=acfw_edit_coupon.cart_condition_fields;function j(t){const{title:e,desc:n,hours:o}=x;return`\n    <div class="customer-last-ordered-field condition-field" data-type="customer-last-ordered">\n        <a class="remove-condition-field" href="javascript:void(0);"><i class="dashicons dashicons-trash"></i></a>\n        <h3 class="condition-field-title">${e}</h3>\n        <label>${n}</label>    \n        <div class="field-control side-label">\n            <input class="condition-value" type="number" min="0" value="${t&&t>-1?t:0}">\n            <label>${o}</label>\n        </div>\n    </div>\n    `}function k(t){return parseInt($(t).find(".condition-value").val())}const q=jQuery,{total_customer_spend:S}=acfw_edit_coupon.cart_condition_fields;function Q(t){const{condition:e,value:n,offset:o}=t,{condition_label:i}=acfw_edit_coupon,{title:a,desc:s,total_spend:l,days_offset:r}=S,p=n?d(n):0;return`\n    <div class="total-customer-spend-field condition-field" data-type="total-customer-spend">\n        <a class="remove-condition-field" href="javascript:void(0);"><i class="dashicons dashicons-trash"></i></a>\n        <h3 class="condition-field-title">${a}</h3>\n        <label>${s}</label>\n        <div class="field-control">\n            <label>${i}</label>\n            <select class="condition-select">\n                ${c(e)}\n            </select>\n        </div>\n        <div class="field-control">\n            <label>${l}</label>\n            <input class="condition-value wc_input_price" type="text" min="0" value="${!isNaN(p)&&p>-1?n:0}">\n        </div>\n        <div class="field-control">\n            <label>${r}</label>\n            <input class="condition-offset" type="number" min="0" value="${o&&o>-1?o:0}">\n        </div>\n    </div>\n    `}function z(t){return{condition:q(t).find(".condition-select").val(),value:q(t).find(".condition-value").val(),offset:q(t).find(".condition-offset").val()}}class O{table_placeholder_row_template(t=4){const{no_products_added:e}=acfw_edit_coupon;return` \n            <tr class="no-result">\n                <td colspan="${t}">${e}</td>\n            </tr>\n        `}table_markup(){const{add_product_label:t}=acfw_edit_coupon,{tableproduct:e}=acfw_psaeic,{products:n}=e,{label:o}=n;return`\n            <table class="product-stock-availability-exists-in-cart-table acfw-styled-table">\n                <thead>\n                    <tr>\n                        <th class="product">${o.columns.product}</th>\n                        <th class="condition">${o.columns.condition}</th>\n                        <th class="actions"></th>\n                    </tr>\n                </thead>\n                <tbody>\n                    ${(()=>{let t="";if(n&&n.data&&n.data.length)for(let o of n.data)e.row.data=o,t+=e.row.template_view_row();else t=e.template.table_placeholder_row_template(4);return t})()}\n                </tbody>\n                <tfoot>\n                    <tr>\n                        <td colspan="4">\n                            <a class="psaeic-btn-add-category-row" href="javascript:void(0);" onclick="acfw_psaeic.tableproduct.trigger.trigger_btn_add_category(event)">\n                                <i class="dashicons dashicons-plus"></i>\n                                ${t}\n                            </a>\n                        </td>\n                    </tr>\n                </tfoot>\n            </table>\n        `}}const N=jQuery;class C{trigger_btn_add_category(t){const{tableproduct:e}=acfw_psaeic,n=t.currentTarget;e.row.element.$button=N(n),e.row.data=e.row.data_initial(),e.row.add()}trigger_btn_action_add(t){const{tableproduct:e}=acfw_psaeic,n=t.currentTarget;e.row.element.$button=N(n),e.row.view()}trigger_btn_action_edit(t){const{tableproduct:e}=acfw_psaeic,n=t.currentTarget;e.row.element.$button=N(n),e.row.edit()}trigger_btn_action_cancel(t){const{tableproduct:e}=acfw_psaeic,n=t.currentTarget;e.row.element.$button=N(n),e.row.cancel()}trigger_btn_action_remove(t){const{tableproduct:e}=acfw_psaeic,n=t.currentTarget;e.row.element.$button=N(n),e.row.detect(),e.row.remove()}}const I=jQuery;class J{constructor(){this._element={$button:I(null),$table:I(this),$tbody:I(this),$row:I(this),$product:I(this),$condition:I(this),colspan:4,data:[]},this._data=this.data_initial()}get element(){return this._element}set element(t){this._element=t}get data(){return this._data}data_initial(){return{product:{id:0,label:""},condition:{id:"",label:""}}}set data(t){this._data=t}template_initiate_select2(){this._element.$tbody.find("select.wc-product-search").trigger("change"),I("body").trigger("wc-enhanced-select-init")}template_add_edit_row(){const{tableproduct:t}=acfw_psaeic,{products:e}=t,{edit:o,add:i,cancel:a}=acfw_edit_coupon.product_table_buttons,{type_to_search:c}=acfw_edit_coupon.bogo_form_fields;return`\n            <tr class="add-edit-form adding">\n                <td class="product" data-product="${"object"==typeof this._data?n(JSON.stringify(this._data)):0}">\n                    <div class="object-search-wrap">\n                        <select class="psaeic-select-product wc-product-search" data-placeholder="${c}" data-action="acfwp_add_products_search">\n                            ${"object"==typeof this._data&&this._data.product.id?`<option value="${this._data.product.id}" selected>${this._data.product.label}</option>`:""}\n                        </select>                        \n                    </div>\n                </td>\n                <td class="condition">                \n                    <select class="condition-select psaeic-select-condition">\n                        ${Object.keys(e.options.conditions).map((t=>{let n=e.options.conditions[t];return`<option value="${t}" ${"object"==typeof this._data&&this._data.condition.id==t?"selected":""}>${n}</option>`})).join("")}\n                    </select> \n                </td>\n                <td class="actions">\n                    <button type="button" class="button-primary psaeic-btn-add" onclick="acfw_psaeic.tableproduct.trigger.trigger_btn_action_add(event)">${"object"==typeof this._data&&this._data.product.id?o:i}</button>\n                    <button type="button" class="button psaeic-btn-cancel" onclick="acfw_psaeic.tableproduct.trigger.trigger_btn_action_cancel(event)">${a}</button>\n                </td>\n            </tr>\n        `}template_view_row(){return`\n            <tr>\n                <td class="product product-${this._data.product.id} object" data-product="${n(JSON.stringify(this._data))}">\n                    ${this._data.product.label}\n                </td>\n                <td class="condition">${this._data.condition.label}</td>\n                <td class="actions">\n                    <a class="psaeic-btn-edit" href="javascript:void(0)" onclick="acfw_psaeic.tableproduct.trigger.trigger_btn_action_edit(event)"><span class="dashicons dashicons-edit"></span></a>\n                    <a class="psaeic-btn-remove" href="javascript:void(0)" onclick="acfw_psaeic.tableproduct.trigger.trigger_btn_action_remove(event)"><span class="dashicons dashicons-no"></span></a>\n                </td>\n            </tr>\n        `}detect(){this._element.$button&&(this._element.$row=this._element.$button.closest("tr"),this._element.$table=this._element.$button.closest(".acfw-styled-table"),this._element.$tbody=this._element.$table.find("tbody"),this._element.$product=this._element.$row.find(".psaeic-select-product"),this._element.$condition=this._element.$row.find(".psaeic-select-condition"),this._element.colspan=this._element.$row.find("td").length,this._element.data=this._element.$row.find("td.product").data("product"))}read(){var t,e,n,o,i,a;const{$product:c,$condition:d}=this._element;this._data={product:{id:parseInt(null!==(t=null==c||null===(e=c.val())||void 0===e?void 0:e.toString())&&void 0!==t?t:""),label:null!==(n=null===(o=I(c))||void 0===o||null===(o=o.select2("data")[0])||void 0===o?void 0:o.text.replace("\n","").replace(/\s+/g," ").trim())&&void 0!==n?n:""},condition:{id:null!==(i=null==d||null===(a=d.val())||void 0===a?void 0:a.toString())&&void 0!==i?i:"",label:d.find("option:selected").text().replace("\n","").replace(/\s+/g," ").trim()}}}validate(t=!0){const{tableproduct:e}=acfw_psaeic,{fill_form_propery_error_msg:n}=acfw_edit_coupon,{$product:o,$condition:i}=this._element,{product:a}=this._data;return o.val()&&i.val()?(this._element.$table.find("td.product.object").each((function(){if(I(this).data("product").product.id==a.id)return vex.dialog.alert(e.products.exists),!1})),t):(vex.dialog.alert(n),!1)}add(){this.detect(),this._data.product.id&&!this.validate()||(this._element.$tbody.find("tr.no-result").remove(),this._element.$tbody.append(this.template_add_edit_row()),this.template_initiate_select2())}edit(){this.detect(),this._data=this._element.data,this._element.$row.replaceWith(this.template_add_edit_row()),this.template_initiate_select2()}view(t={}){this.template_initiate_select2(),this.detect(),Object.keys(t).length||this.read(),this.validate()&&this._element.$row.replaceWith(this.template_view_row())}cancel(){this.detect(),this.remove()}remove(){const{tableproduct:t}=acfw_psaeic;this._element.$row.remove(),this._element.$tbody.find("tr").length<=0&&this._element.$tbody.html(t.template.table_placeholder_row_template(this._element.colspan))}}class A{constructor(){this._products={},this._trigger={},this._template={},this._row={}}get products(){return this._products}set products(t){this._products=t}get template(){return this._template}get trigger(){return this._trigger}get row(){return this._row}build(){this._row=new J,this._template=new O,this._trigger=new C,this.save()}save(){window.acfw_psaeic={...acfw_edit_coupon.cart_condition_fields.acfw_product_stock_availability_exists_in_cart,tableproduct:this}}}const D=jQuery,{product_stock_availability_exists_in_cart:E}=acfw_edit_coupon.cart_condition_fields;function T(t={}){const{title:e,products:n}=E;n.data=t.products;const o=new A;return o.products=n,o.build(),`\n        <div class="product-stock-availability-exists-in-cart-field condition-set" data-type="product-stock-availability-exists-in-cart">\n            <a class="remove-condition-field" href="javascript:void(0);"><i class="dashicons dashicons-trash"></i></a>\n            <h3 class="condition-field-title">${e}</h3>\n            \n            ${o.template.table_markup()}\n        </div>\n    `}function W(t){const e=t.querySelectorAll(".product-stock-availability-exists-in-cart-table tr td.product"),n=[];return e.forEach((t=>n.push(D(t).data("product")))),{products:n}}const P=jQuery,{has_ordered_before:M}=acfw_edit_coupon.cart_condition_fields;function F(t={}){const{condition:e,value:n,products:o}=t,{cart_condition_fields:i,add_product_label:c}=acfw_edit_coupon,{product_col:d,condition_col:s,quantity_col:l}=i.product_quantity,{title:r,type:p,within_a_period:f,number_of_orders:h,num_prev_days:b}=i.has_ordered_before,v=[];let m="";if(o&&o.length)for(let a of o)v.push(a.product_id),m+=u(a);else m=_(4);return`\n    <div class="cart-quantity-field condition-field condition-set" data-type="has-ordered-before">\n        <a class="remove-condition-field" href="javascript:void(0);"><i class="dashicons dashicons-trash"></i></a>\n        <h3 class="condition-field-title">${r}</h3>\n        <div class="field-control">\n            <label>${p}</label>\n            <select class="condition-select has-ordered-before-type">\n                <option value="within-a-period" ${a(e,"within-a-period")}>${f}</option>\n                <option value="number-of-orders" ${a(e,"number-of-orders")}>${h}</option>\n            </select>\n        </div>\n        <div class="field-control condition-type-value">\n            <label>${b}</label>\n            <input class="condition-value" type="number" min="0" value="${n}">\n        </div>\n        <table class="has-ordered-before-products-table acfw-styled-table" data-exclude="${JSON.stringify(v)}">\n            <thead>\n                <tr>\n                    <th class="product">${d}</th>\n                    <th class="condition">${s}</th>\n                    <th class="quantity">${l}</th>\n                    <th class="actions"></th>\n                </tr>\n            </thead>\n            <tbody>\n                ${m}\n            </tbody>\n            <tfoot>\n                <tr>\n                    <td colspan="4">\n                        <a class="add-table-row" href="javascript:void(0);">\n                            <i class="dashicons dashicons-plus"></i>\n                            ${c}\n                        </a>\n                    </td>\n                </tr>\n            </tfoot>\n        </table>\n    </div>\n    `}function H(t){const e=t.querySelectorAll(".has-ordered-before-products-table tr td.product"),n=[];return e.forEach((t=>n.push(P(t).data("product")))),{condition:P(t).find(".condition-select").val(),value:parseInt(P(t).find(".condition-value").val()),products:n}}const V=jQuery,{has_ordered_product_categories_before:K}=acfw_edit_coupon.cart_condition_fields;function R(){K.default_data_value={},K.template_callback=X,K.scraper_callback=G,function(){const t=document.querySelector("#acfw_cart_conditions");V(t).on("change","select.hopcb-select-type-condition",(function(){const{within_a_period_label:t,number_of_orders_label:e}=acfw_edit_coupon,n=V(this),o=n.closest(".has-ordered-product-categories-before-field").find(".hopcb-condition-type-value label");"within-a-period"===n.val()?o.text(t):o.text(e)}))}()}function X(t={}){const{condition:e,quantity:n}=t,{condition_label:o,cart_condition_fields:{cart_quantity:{field:i},has_ordered_product_categories_before:{title:c,type:d,within_a_period:s,number_of_orders:l,num_prev_days:r,categories:p},product_category:{placeholder:u}},condition_field_options:{exactly:_,anyexcept:f,morethan:h,lessthan:b}}=acfw_edit_coupon;let v=t.type&&t.type.label?t.type.label:s,m=[{value:"=",label:_},{value:"!=",label:f},{value:">",label:h},{value:"<",label:b}];return`\n        <div class="has-ordered-product-categories-before-field condition-field condition-set" data-type="has-ordered-product-categories-before">\n            <a class="remove-condition-field" href="javascript:void(0);"><i class="dashicons dashicons-trash"></i></a>\n            <h3 class="condition-field-title">${c}</h3>\n            \n            <div class="field-control">\n                <label>${d}</label>\n                <select class="hopcb-select-type-condition">                    \n                    ${[{value:"within-a-period",label:s},{value:"number-of-orders",label:l}].map((e=>{let n=t.type?t.type.condition:"within-a-period";const{value:o,label:i}=e;return`<option value="${o}" ${a(n,o)}>${i}</option>`})).join("")}\n                </select>\n            </div>\n            <div class="field-control hopcb-condition-type-value">\n                <label>${v}</label>\n                <input class="hopcb-select-type-value" type="number" min="0" value="${t.type&&t.type.value?t.type.value:0}">\n            </div>\n            <div class="field-control categories">\n                <label></label>\n                <select class="hopcb-select-categories wc-enhanced-select" multiple data-placeholder="${u}">\n                    ${Object.keys(p.options).map((e=>{let n=p.options[e];return`<option value="${e}" ${t.categories&&t.categories.indexOf(parseInt(e))>=0?"selected":""}>${n}</option>`})).join("")}\n                </select>\n            </div>\n            <div class="field-control">\n                <label>${o}</label>\n                <select class="hopcb-select-condition">\n                    ${m.map((e=>{const{value:n,label:o}=e;return`<option value="${n}" ${(t.condition?t.condition:">")===n?"selected":""}>${o}</option>`})).join("")}\n                </select>\n            </div>\n            <div class="field-control">\n                <label>${i}</label>\n                <input type="number" class="hopcb-select-quantity" value="${n}" min="${"<"==e?1:0}">\n            </div>\n            \n        </div>\n    `}function B(t){if(null==t)return!1;if("string"==typeof t&&""===t.trim())return!1;if(Array.isArray(t)&&0===t.length)return!1;if("object"==typeof t)for(const e in t)if(!B(t[e]))return!1;return!0}function G(t){t.querySelectorAll(".has-ordered-product-categories-before-table tr td.category");let e={categories:V(t).find(".hopcb-select-categories").val(),condition:V(t).find(".hopcb-select-condition").val(),quantity:V(t).find(".hopcb-select-quantity").val(),type:{condition:V(t).find(".hopcb-select-type-condition").val(),label:V(t).find(".hopcb-select-type-condition option:selected").text(),value:V(t).find(".hopcb-select-type-value").val()}};return!!B(e)&&e}const L=jQuery,{total_customer_spend_on_product_category:U}=acfw_edit_coupon.cart_condition_fields;function Y(){U.default_data_value={},U.template_callback=Z,U.scraper_callback=et,function(){const t=document.querySelector("#acfw_cart_conditions");L(t).on("change","select.tcspc-select-type-condition",(function(){const{within_a_period_label:t,number_of_orders_label:e}=acfw_edit_coupon,n=L(this),o=n.closest(".total-customer-spend-on-product-category-field").find(".tcspc-condition-type-value label");"within-a-period"===n.val()?o.text(t):o.text(e)}))}()}function Z(t={}){const{condition:e,spend:n}=t,{condition_label:o,cart_condition_fields:{total_customer_spend:{total_spend:i},total_customer_spend_on_product_category:{title:c,type:d,within_a_period:s,number_of_orders:l,num_prev_days:r,categories:p},product_category:{placeholder:u}},condition_field_options:{exactly:_,anyexcept:f,morethan:h,lessthan:b}}=acfw_edit_coupon;let v=t.type&&t.type.label?t.type.label:s,m=[{value:"=",label:_},{value:"!=",label:f},{value:">",label:h},{value:"<",label:b}];return`\n        <div class="total-customer-spend-on-product-category-field condition-field condition-set" data-type="total-customer-spend-on-product-category">\n            <a class="remove-condition-field" href="javascript:void(0);"><i class="dashicons dashicons-trash"></i></a>\n            <h3 class="condition-field-title">${c}</h3>\n            \n            <div class="field-control">\n                <label>${d}</label>\n                <select class="tcspc-select-type-condition">                    \n                    ${[{value:"within-a-period",label:s},{value:"number-of-orders",label:l}].map((e=>{let n=t.type?t.type.condition:"within-a-period";const{value:o,label:i}=e;return`<option value="${o}" ${a(n,o)}>${i}</option>`})).join("")}\n                </select>\n            </div>\n            <div class="field-control tcspc-condition-type-value">\n                <label>${v}</label>\n                <input class="tcspc-select-type-value" type="number" min="0" value="${t.type&&t.type.value?t.type.value:0}">\n            </div>\n            <div class="field-control categories">\n                <label></label>\n                <select class="tcspc-select-categories wc-enhanced-select" multiple data-placeholder="${u}">\n                    ${Object.keys(p.options).map((e=>{let n=p.options[e];return`<option value="${e}" ${t.categories&&t.categories.indexOf(parseInt(e))>=0?"selected":""}>${n}</option>`})).join("")}\n                </select>\n            </div>\n            <div class="field-control">\n                <label>${o}</label>\n                <select class="tcspc-select-condition">\n                    ${m.map((e=>{const{value:n,label:o}=e;return`<option value="${n}" ${(t.condition?t.condition:">")===n?"selected":""}>${o}</option>`})).join("")}\n                </select>\n            </div>\n            <div class="field-control">\n                <label>${i}</label>\n                <input type="text" class="tcspc-select-spend wc_input_decimal" value="${null!=n?n:0}">\n            </div>\n            \n        </div>\n    `}function tt(t){if(null==t)return!1;if("string"==typeof t&&""===t.trim())return!1;if(Array.isArray(t)&&0===t.length)return!1;if("object"==typeof t)for(const e in t)if(!tt(t[e]))return!1;return!0}function et(t){let e={categories:L(t).find(".tcspc-select-categories").val(),condition:L(t).find(".tcspc-select-condition").val(),spend:L(t).find(".tcspc-select-spend").val(),type:{condition:L(t).find(".tcspc-select-type-condition").val(),label:L(t).find(".tcspc-select-type-condition option:selected").text(),value:L(t).find(".tcspc-select-type-value").val()}};return!!tt(e)&&e}const nt=jQuery,{shipping_zone_region:ot}=acfw_edit_coupon.cart_condition_fields;function it(t){const{value:e}=t,{title:o,zone_label:i,zone_placeholder:c,regions_label:d,regions_placeholder:s,zone_options:l}=ot,r=e&&e.length?e:[];return`\n    <div class="shipping-zone-region-field condition-field" data-type="shipping-zone-region"\n        data-zones="${n(JSON.stringify(l))}"\n        data-regions="${n(JSON.stringify(r))}">\n        <a class="remove-condition-field" href="javascript:void(0);"><i class="dashicons dashicons-trash"></i></a>\n        <h3 class="condition-field-title">${o}</h3>\n        <div class="field-control">\n            <label>${i}</label>\n            <select class="condition-select wc-enhanced-select" data-placeholder="${n(c)}">\n                <option value="">${c}</option>\n                ${function(t,e){const{condition:n}=t;let o="";for(let i in e){const t=e[i];o+=`\n            <option value="${i}" ${a(n,i)}>\n                ${t.name}\n            </option>\n        `}return o}(t,l)}\n            </select>\n        </div>\n        <div class="field-control regions">\n            <label>${d}</label>\n            <select class="condition-value wc-enhanced-select" multiple data-placeholder="${n(s)}">\n            </select>\n        </div>\n    </div>\n    `}function at(t){return{condition:nt(t).find(".condition-select").val(),value:nt(t).find(".condition-value").val()}}const ct=jQuery,{custom_taxonomy:dt}=acfw_edit_coupon.cart_condition_fields,{cart_condition_fields:st,condition_field_options:lt}=acfw_edit_coupon;function rt(t){const{condition:e,value:o,qtyCondition:i,quantity:c}=t,{title:d,select_taxonomy:s,product_type:l,select_terms:r}=dt,{field:p}=st.cart_quantity,{condition_label:u}=acfw_edit_coupon,{exactly:_,anyexcept:f,morethan:h,lessthan:b}=lt,v=i||">",m=o&&o.length?o:[];return`\n    <div class="custom-taxonomy-field condition-field" data-type="custom-taxonomy" \n      data-selected_terms="${n(JSON.stringify(m))}">\n      <a class="remove-condition-field" href="javascript:void(0);"><i class="dashicons dashicons-trash"></i></a>\n      <h3 class="condition-field-title">${d}</h3>\n      <div class="field-control">\n        <select class="condition-select wc-enhanced-select custom-taxonomy" data-placeholder="${s}">\n          <option value="">${s}</option>\n          ${function(t){const{tax_options:e,product_type:n}=dt;let o="";for(let i of e){const{name:e,label:n}=i;o+=`\n      <option value="${e}" ${a(t,e)}>\n        ${n}\n      </option>\n    `}return o}(e)}\n        </select>\n      </div>\n      <div class="field-control field-control-wide">\n        <select class="condition-value wc-enhanced-select" multiple data-placeholder="${r}">\n        </select>\n      </div>\n      <div class="field-control condition">\n            <label>${u}</label>\n            <select class="condition-select qty-condition-select">\n                <option value="=" ${"="==v?"selected":""}>${_}</option>\n                <option value="!=" ${"!="==v?"selected":""}>${f}</option>\n                <option value=">" ${">"==v?"selected":""}>${h}</option>\n                <option value="<" ${"<"==v?"selected":""}>${b}</option>\n            </select>\n        </div>\n        <div class="field-control quantity">\n            <label>${p}</label>\n            <input type="number" class="condition-quantity" value="${"number"==typeof c?c:0}" min="${"<"==i?1:0}">\n        </div>\n    </div>\n    `}function pt(t){return{condition:ct(t).find(".condition-select").val(),value:ct(t).find(".condition-value").val(),qtyCondition:ct(t).find(".qty-condition-select").val(),quantity:ct(t).find(".condition-quantity").val()}}const ut=jQuery,{cart_condition_fields:_t}=acfw_edit_coupon,{custom_user_meta:ft,custom_cart_item_meta:ht}=_t;function bt(t,e){const{condition:n,key:o,value:i,type:d}=t,{condition_label:s}=acfw_edit_coupon,{title:l,meta_key:r,meta_value:p,value_type:u}=_t[e],_=e.replace(/_/g,"-");return`\n    <div class="${_}-field condition-field" data-type="${_}">\n      <a class="remove-condition-field" href="javascript:void(0);"><i class="dashicons dashicons-trash"></i></a>\n      <h3 class="condition-field-title">${l}</h3>\n      <div class="field-control wider">\n        <label>${u}</label>\n        <select class="value-type">\n          ${function(t,e){const{type_options:n}=_t[e];let o="";for(let i in n){const e=n[i];o+=`<option value="${i}" ${a(t,i)}>${e}</option>`}return o}(d,e)}\n        </select>\n      </div>\n      <div class="field-control">\n        <label>${s}</label>\n        <select class="condition-select">\n          ${c(n)}\n          ${"custom_cart_item_meta"===e?function(t=""){const{exists:e,notexist:n}=acfw_edit_coupon.condition_exists_field_option;return`\n    <option value="exists" ${a(t,"exists")}>${e}</option>\n    <option value="notexist" ${a(t,"notexist")}>${n}</option>\n  `}(n):""}\n        </select>\n      </div>\n      <div class="field-control wider">\n        <label>${r}</label>\n        <input class="condition-key" type="text" value="${o||""}">\n      </div>\n      <div class="field-control wider">\n        <label>${p}</label>\n        <input class="condition-value" type="text" value="${i||i>-1?i:""}">\n      </div>\n    </div>\n  `}function vt(t){return{condition:ut(t).find(".condition-select").val(),key:ut(t).find(".condition-key").val(),value:ut(t).find(".condition-value").val(),type:ut(t).find(".value-type").val()}}const mt=jQuery,{number_of_orders:yt}=acfw_edit_coupon.cart_condition_fields;function gt(t){const{condition:e,value:n,offset:o}=t,{condition_label:i}=acfw_edit_coupon,{title:a,desc:d,count_label:s,prev_days_label:l}=yt;return`\n    <div class="number-of-orders-field cart-quantity-field condition-field" data-type="number-of-orders">\n      <a class="remove-condition-field" href="javascript:void(0);"><i class="dashicons dashicons-trash"></i></a>\n      <h3 class="condition-field-title">${a}</h3>\n      <label>${d}</label>\n      <div class="field-control">\n        <label>${i}</label>\n        <select class="condition-select">\n            ${c(e)}\n        </select>\n      </div>\n      <div class="field-control">\n          <label>${s}</label>\n          <input class="condition-value" type="number" min="0" value="${n>=0?n:""}">\n      </div>\n      <div class="field-control">\n          <label>${l}</label>\n          <input class="condition-offset" type="number" min="0" value="${o>=0?o:""}">\n      </div>\n    </div>\n  `}function wt(t){return{condition:mt(t).find(".condition-select").val(),value:mt(t).find(".condition-value").val(),offset:mt(t).find(".condition-offset").val()}}const $t=jQuery;function xt(){const t=document.querySelector("#acfw_cart_conditions");h.default_data_value={},h.template_callback=b,h.scraper_callback=v,l.default_data_value={},l.template_callback=r,l.scraper_callback=p,y.template_callback=g,y.scraper_callback=w,x.template_callback=j,x.scraper_callback=k,S.default_data_value={},S.template_callback=Q,S.scraper_callback=z,E.default_data_value={},E.template_callback=T,E.scraper_callback=W,M.default_data_value={},M.template_callback=F,M.scraper_callback=H,R(),Y(),ot.default_data_value={},ot.template_callback=it,ot.scraper_callback=at,dt.default_data_value={},dt.template_callback=rt,dt.scraper_callback=pt,ft.default_data_value={},ft.template_callback=bt,ft.scraper_callback=vt,ht.default_data_value={},ht.template_callback=bt,ht.scraper_callback=vt,yt.default_data_value={},yt.template_callback=gt,yt.scraper_callback=wt,$t(t).on("change","input.condition-value",jt),$t(t).on("change",".custom-cart-item-meta-field .condition-select",kt)}function jt(){const t=$t(this);if("number"===t.closest(".condition-field").find("select.value-type").val()){const e=parseInt(t.val()+"");t.val(isNaN(e)?"":Math.round(e))}}function kt(){var t;const e=$t(this),n=e.closest(".condition-field").find(".condition-value");["exists","notexist"].includes(e.val().toString())?(n.val(0),n.prop("disabled",!0),n.parent().hide()):["exists","notexist"].includes(null===(t=e.data("prevValue"))||void 0===t?void 0:t.toString())&&(n.val(""),n.prop("disabled",!1),n.parent().show()),e.data("prevValue",e.val().toString())}const qt=jQuery,St=document.querySelector("#acfw_add_products");function Qt(t){qt(St).data("editing",t),qt(St).find("#save-add-products").prop("disabled",!t)}function zt(t=[],e=!1){const{discount_type:o,discount_value:i}=e,{edit:c,add:s,cancel:l}=acfw_edit_coupon.product_table_buttons,{type_to_search:r}=acfw_edit_coupon.bogo_form_fields,p="object"==typeof e?function(t){const{product_id:e,product_label:n}=t;return`<option value="${e}">${n}</option>`}(e):"",u="object"==typeof e?c:s,_=i&&d(i)>=0&&"nodiscount"!==o?i:"";return`\n    <tr class="add-edit-form adding">\n        <td class="product" data-object="${"object"==typeof e?n(JSON.stringify(e)):0}">\n            <div class="object-search-wrap">\n                <select class="product-in-cart wc-product-search"\n                    data-placeholder="${r}"\n                    data-action="acfwp_add_products_search"\n                    data-exclude="${n(JSON.stringify(t))}">${p}</select>\n            </div>\n        </td>\n        <td class="quantity">\n            <input type="number" class="condition-quantity" value="${"object"==typeof e?e.quantity:1}" min="1">\n        </td>\n        <td class="price">\n            <div>\n            <select class="discount_type">\n                ${function(t="",e=!1){const{currency_symbol:n,discount_field_options:o}=acfw_edit_coupon,{nodiscount:i,override:c,percent:d,fixed:s}=o,l=`<option value="nodiscount" ${a(t,"nodiscount")}>= : ${i}</option>`;return`\n    ${e?l:""}\n    <option value="override" ${a(t,"override")}>${n} : ${c}</option>\n    <option value="percent" ${a(t,"percent")}>% : ${d}</option>\n    <option value="fixed" ${a(t,"fixed")}>-${n} : ${s}</option>\n  `}(o,!0)}\n            </select>\n            <input type="text" class="discount_value short wc_input_price" value="${_}">\n            </div>\n        </td>\n        <td class="actions">\n            <button type="button" class="condition-product-add button-primary">${u}</button>\n            <button type="button" class="cancel button">${l}</button>\n        </td>\n    </tr>\n    `}function Ot(t){const{product_id:e,product_label:o,quantity:i,discount_type:a,discount_value:c}=t,d="nodiscount"!==a?c:"";return`\n    <tr>\n        <td class="product product-${e} object" data-product="${n(JSON.stringify(t))}">\n            ${o}\n        </td>\n        <td class="quantity">${i}</td>\n        <td class="price">(${a}) ${d}</td>\n        <td class="actions">\n            <a class="edit" href="javascript:void(0)"><span class="dashicons dashicons-edit"></span></a>\n            <a class="remove" href="javascript:void(0)"><span class="dashicons dashicons-no"></span></a>\n        </td>\n    </tr>\n    `}function Nt(t=4){const{no_products_added:e}=acfw_edit_coupon;return`\n    <tr class="no-result">\n        <td colspan="${t}">${e}</td>\n    </tr>\n    `}const Ct=jQuery;function It(){const t=Ct(this).closest(".acfw-styled-table"),e=t.find("tbody"),n=t.data("exclude");e.find("tr.no-result").remove(),e.append(zt(n)),e.find("select.discount_type").trigger("change"),e.find("select.wc-product-search").trigger("change"),Ct("body").trigger("wc-enhanced-select-init")}function Jt(){const t=jQuery(this),e=t.closest("tr"),n=t.closest(".acfw-styled-table"),o=n.find("tbody"),i=e.find(".product").data("product"),{product_id:a}=i;let c=n.data("exclude");c="object"==typeof c?c:[],c.splice(c.indexOf(a),1),o.find("tr.no-result").remove(),e.replaceWith(zt(c,i)),o.find("select.discount_type").trigger("change"),o.find("select.wc-product-search").trigger("acfw_product_select"),n.data("exclude",c),n.find("select.wc-product-search").data("exclude",c),Ct("body").trigger("wc-enhanced-select-init")}function At(){const{fill_form_propery_error_msg:t,product_exists_in_table:e}=acfw_edit_coupon,n=jQuery(this),o=n.closest("tr"),i=n.closest("table.acfw-styled-table"),a=o.find(".wc-product-search"),c=o.find(".condition-quantity"),s=o.find("select.discount_type").val().toString(),l=o.find("input.discount_value").val().toString();let r=i.data("exclude");const p=parseInt(o.find(".wc-product-search").val().toString()),u={product_id:p,quantity:parseInt(o.find(".condition-quantity").val().toString()),product_label:o.find(".wc-product-search option:selected").text(),discount_type:s,discount_value:l};!a.val()||!c.val()||c.val()<1||"nodiscount"!==s&&(isNaN(d(l))||d(l)<0)?vex.dialog.alert(t):r.includes(p)?vex.dialog.alert(acfw_edit_coupon.product_exists_in_table):(r="object"==typeof r?r:[],r.push(p),o.replaceWith(Ot(u)),i.data("exclude",r),i.find(".wc-product-search").data("exclude",r),Qt(!0))}function Dt(){const t=jQuery(this),e=t.closest("tr"),n=t.closest("table"),o=e.closest("tbody"),i=e.find("td").length,a=e.find("td.product").data("object");let c=n.data("exclude");c.includes(a.product_id)?vex.dialog.alert(acfw_edit_coupon.product_exists_in_table):"object"==typeof a?(c="object"==typeof c?c:[],c.push(a.product_id),e.replaceWith(Ot(a)),n.data("exclude",c),n.find(".wc-product-search").data("exclude",c)):(e.remove(),o.find("tr").length<=0&&o.html(Nt(i)))}function Et(){const t=jQuery(this).closest("tr"),e=t.closest("table"),n=t.closest("tbody"),o=t.find("td").length,i=t.find("td.object").data("product"),a=e.data("exclude"),c=a.indexOf(parseInt(i.product_id));-1!==c&&a.splice(c,1),e.data("exclude",a),e.find(".wc-product-search").data("exclude",a),t.remove(),n.find("tr").length<=0&&n.html(Nt(o)),Qt(!0)}const Tt=jQuery,{post_id:Wt}=woocommerce_admin_meta_boxes,Pt=document.querySelector("#acfw_add_products"),Mt=Pt?Pt.querySelector(".acfw-overlay"):null;function Ft(){Tt("#acfw_bogo_deals").find(".acfw-styled-table tr.add-edit-form button.cancel").trigger("click");const{post_status:t}=acfw_edit_coupon,n=Pt.querySelectorAll("table.acfw-styled-table tbody td.object"),o=Pt.querySelector(".add-before-cart-condition-check-field input[type='checkbox']");let i,a=[];n.forEach((t=>{i=Tt(t).data("product"),i&&a.push(i)})),e(Mt,"show"),Tt.post(ajaxurl,{action:"acfw_save_add_products_data",coupon_id:Wt,products:a.length?a:"empty",add_before_conditions:Tt(o).is(":checked")?1:0,nonce:Tt("#acfw_add_products").data("nonce")},(n=>{"success"==n.status?"publish"!==t&&(Tt("input[name='post_title']").val()||Tt("input[name='post_title']").val("coupon-"+Wt),Tt("select[name='post_status']").append(new Option("Published","publish")).val("publish"),Tt("#publishing-action").append('\n                    <input type="hidden" name="publish" value="Publish">\n                '),Tt("input#publish").click()):n.error_msg&&(vex.dialog.alert(n.error_msg),console.log(n),Tt(Pt).addClass("save-error")),Tt(Pt).find("button#clear-add-products").prop("disabled",!1),Qt(!1),e(Mt,"hide")}),"json")}function Ht(){const t=Tt(this);if(!confirm(t.data("prompt")))return;const n=Pt.querySelector("table.acfw-styled-table tbody");e(Mt,"show"),Tt.post(ajaxurl,{action:"acfw_clear_add_products_data",coupon_id:Wt,_wpnonce:t.data("nonce")},(o=>{"success"==o.status?(Tt(n).html(Nt(4)),t.prop("disabled",!0),Qt(!1),"Published"!=Tt("#post-status-display").text()&&(Tt("input[name='post_title']").val()||Tt("input[name='post_title']").val("coupon-"+Wt),Tt("input#publish").click())):(o.error_msg&&vex.dialog.alert(o.error_msg),console.log(o)),e(Mt,"hide")}),"json")}function Vt(t){Tt(".coupon_data_tabs").find(".acfw_add_products_tab").hasClass("active")&&Tt(Pt).data("editing")&&(t.preventDefault(),Tt(Pt).find("#save-add-products").trigger("click"),setTimeout((()=>{Tt(Pt).hasClass("save-error")?Tt(Pt).removeClass("save-error"):Tt("form#post").submit()}),1e3))}const Kt=jQuery,Rt=document.querySelector("#acfw_add_products");function Xt(t=jQuery){t(Rt).on("click",".acfw-styled-table tfoot .add-table-row",It),t(Rt).on("click",".acfw-styled-table td.actions a.edit",Jt),t(Rt).on("click","tr.add-edit-form .actions .condition-product-add",At),t(Rt).on("click","tr.add-edit-form .actions .cancel",Dt),t(Rt).on("click",".acfw-styled-table td.actions a.remove",Et),t(Rt).on("click","button#save-add-products",Ft),t(Rt).on("click","button#clear-add-products",Ht),t(Rt).on("change","select.discount_type",Bt),t(Rt).on("blur",".wc_input_price",o),t("form#post").on("submit",Vt),t(Rt).css("min-height",t("#coupon_options ul.coupon_data_tabs").height()+10),t(Rt).on("click",".acfw-styled-table .actions .remove",(()=>Qt(!0))),t(Rt).on("change","input[name='add_before_cart_condition']",(()=>Qt(!0))),function(){const t=Kt(Rt).data("products"),e=Kt(Rt).find(".add-products-data-table tbody");if(t.length>0){let n="";t.forEach((t=>{n+=Ot(t)})),e.html(n)}else e.html(Nt(4))}(),t(document).ajaxComplete(Gt),t(Rt).on("change","select.discount_type",Lt)}function Bt(){const t=Kt(this);t.closest("tr").find(".discount_value").prop("disabled","nodiscount"===t.val())}function Gt(t,e){const n=e.getResponseHeader("X-Subscription-IDs");if(!n)return;let o=Kt(Rt).data("subscription_ids")||[];const i=n.split(",").map((t=>parseInt(t)));Kt(Rt).data("subscription_ids",[...o,...i].filter(((t,e,n)=>n.indexOf(t)===e)))}function Lt(){const t=Kt(Rt).data("subscription_ids")||[];if(!t.length)return;const e=Kt(this),n=e.closest("tr").find("select.wc-product-search"),o=parseInt(n.val());t.includes(o)&&"nodiscount"!==e.val()&&(vex.dialog.alert(Kt(Rt).data("subscription_discount_error")),e.val("nodiscount"),e.trigger("change"))}var Ut=jQuery;function Yt(){const t=Ut("#customer_email"),e=parseInt(Ut("#usage_limit").val()),n=parseInt(Ut("#usage_limit_per_user").val()),o=Ut("#acfw_auto_apply_coupon_field"),i=Ut("#_acfw_enable_virtual_coupons").is(":checked"),a=Ut("#acfw-auto-apply-coupon .auto-apply-warning");(t.val()||e||n||i)&&o.prop("checked")?a.show():a.hide()}var Zt=jQuery;function te(){const t=Zt(this),e=t.closest("tr"),n=e.find(".select-shipping-method"),o=e.closest(".acfw-styled-table");o.data("exclude");const i=(o.data("zonemethods")||[]).filter((e=>e.zone_id==t.val())),a=i.length?i[0].methods:[];n.empty(),a.length&&(a.map((t=>n.append(new Option(t.label,t.value)))),n.trigger("change"))}const ee=jQuery,ne=document.querySelector("#acfw_shipping_overrides");function oe(t){ee(ne).data("editing",t),ee(ne).find("#save-shipping-overrides").prop("disabled",!t)}function ie(t){const{no_shipping_overrides_added:e}=acfw_edit_coupon;return`\n        <tr class="no-result">\n            <td colspan="${t}">${e}</td>\n        </tr>\n    `}const ae=jQuery,ce=document.querySelector("#acfw_shipping_overrides"),{post_id:de}=woocommerce_admin_meta_boxes;function se(){const{post_status:t}=acfw_edit_coupon,n=ce.querySelector(".acfw-overlay"),o=ae(this),i=ce.querySelectorAll(".shipping-overrides-table tbody tr td.object"),a=[];i.forEach((t=>{a.push(ae(t).data("object"))})),e(n,"show"),o.prop("disabled",!0),ae.post(ajaxurl,{action:"acfw_save_shipping_overrides",coupon_id:de,overrides:a.length?a:"empty",nonce:ae("#acfw_shipping_overrides").data("nonce")},(o=>{"success"==o.status?"publish"!==t&&(ae("input[name='post_title']").val()||ae("input[name='post_title']").val("coupon-"+de),ae("select[name='post_status']").append(new Option("Published","publish")).val("publish"),ae("#publishing-action").append('\n            <input type="hidden" name="publish" value="Publish">\n          '),ae("input#publish").click()):(o.error_msg&&vex.dialog.alert(o.error_msg),console.log(o)),ae(ce).find("#clear-shipping-overrides").prop("disabled",!1),oe(!1),e(n,"hide")}),"json")}function le(){const t=ae(this);if(!confirm(t.data("prompt")))return;const n=ae(ce.querySelector("table.acfw-styled-table")),o=n.find("tbody"),i=ce.querySelector(".acfw-overlay");e(i,"show"),ae.post(ajaxurl,{action:"acfw_clear_shipping_overrides",coupon_id:woocommerce_admin_meta_boxes.post_id,_wpnonce:t.data("nonce")},(a=>{if("success"==a.status){let e=n.find("thead tr th").length;o.html(""),o.find("tr").length<=0&&o.append(ie(e)),n.data("exclude",[]),t.prop("disabled",!0),oe(!1),"Published"!=jQuery("#post-status-display").text()&&(jQuery("input[name='post_title']").val()||jQuery("input[name='post_title']").val("coupon-"+de),jQuery("input#publish").click())}else a.error_msg&&vex.dialog.alert(a.error_msg),console.log(a);e(i,"hide")}),"json")}function re(t){ae(ce).data("editing")&&(t.preventDefault(),ae(ce).find("#save-shipping-overrides").trigger("click"),ae("form#post").off("submit",re),setTimeout((()=>{ae("form#post").submit()}),1e3))}const pe=jQuery,ue=document.querySelector("#acfw_shipping_overrides");function _e(t={}){const{add:e,edit:o,cancel:c}=acfw_edit_coupon.product_table_buttons,{shipping_zone:s,discount_type:l,discount_value:r}=t,p=pe(ue).find(".shipping-overrides-table").data("zonemethods")||[],u=p.map((t=>({value:t.zone_id,label:t.zone_name}))),_=r&&d(r)>=0?r:"",f=s>=0||"nozone"===s?o:e,h=`\n    <tr class="add-edit-form fresh">\n      <td class="shipping-zone" data-object="${n(JSON.stringify(t))}">\n        <div>\n          <select class="select-shipping-zone wc-enhanced-select" data-placeholder="Select shipping zone">\n            ${i(u,s)}\n          </select>\n        </div>\n      </td>\n      <td class="shipping-method">\n        <div>\n          <select class="select-shipping-method wc-enhanced-select" data-placeholder="Select shipping method">\n            ${function(t,e){const{shipping_zone:n,shipping_method:o}=e;if("nozone"===n&&o||n>=0&&o){const e=t.filter((t=>t.zone_id==n));return i(e.length?e[0].methods:[],o)}return i(t.length?t[0].methods:[],o)}(p,t)}\n          </select>\n        </div>\n      </td>\n      <td class="discount">\n        <select class="discount-type">\n          ${function(t=""){const{currency_symbol:e,discount_field_options:n}=acfw_edit_coupon,{override:o,percent:i,fixed:c}=n;return`\n    <option value="percent" ${a(t,"percent")}>% : ${i}</option>\n    <option value="fixed" ${a(t,"fixed")}>-${e} : ${c}</option>\n    <option value="override" ${a(t,"override")}>${e} : ${o}</option>\n  `}(l)}\n        </select>\n        <input type="text" class="discount_value short wc_input_price" value="${_}">\n      </td>\n      <td class="actions">\n        <button type="button" class="add button-primary">${f}</button>\n        <button type="button" class="cancel button">${c}</button>\n      </td>\n    </tr>\n  `;return h}const fe=jQuery,he=document.querySelector("#acfw_shipping_overrides");function be(t){const{shipping_zone:e,discount_type:o,discount_value:i,shipping_method:a}=t,c=(fe(he).find(".shipping-overrides-table").data("zonemethods")||[]).filter((t=>t.zone_id==e));if(!c.length)return"";const{zone_name:d,methods:s}=c[0],l=s.filter((t=>t.value==a));return l.length?`\n    <tr>\n      <td class="shipping-zone object" data-object="${n(JSON.stringify(t))}">\n        ${d}\n      </td>\n      <td class="shipping-method">\n        ${l[0].label}\n      </td>\n      <td class="discount">\n        (${o}) ${i}\n      </td>\n      <td class="actions">\n        <a class="edit" href="javascript:void(0);">\n          <span class="dashicons dashicons-edit"></span>\n        </a>\n        <a class="remove" href="javascript:void(0);">\n          <span class="dashicons dashicons-no"></span>\n        </a>\n      </td>\n    </tr>\n  `:""}const ve=jQuery;function me(){const t=ve(this).closest(".acfw-styled-table"),e=t.find("tbody");t.data("exclude"),e.find("tr.no-result").remove(),e.append(_e()),ve("body").trigger("wc-enhanced-select-init"),function(t){const e=t.find(".select-shipping-zone"),n=e.find("option:first");t.removeClass("fresh"),e.val(n.prop("value")),e.trigger("change")}(t.find("tr.add-edit-form.fresh"))}function ye(){const{fill_form_propery_error_msg:t,shipping_zone_already_added:e}=acfw_edit_coupon,n=ve(this).closest("tr"),o=n.closest(".acfw-styled-table");let i=parseInt(n.find(".select-shipping-zone").val()+""),a=n.find(".select-shipping-method").val()+"";i=i>=0&&!isNaN(i)?i:"nozone";let c=o.data("exclude");if((i<0||!a)&&("nozone"!==i||!a))return void vex.dialog.alert(t);if(c.filter((t=>t.zone==i&&t.method==a)).length)return void vex.dialog.alert(e);const d={shipping_zone:i,shipping_method:a,discount_type:n.find(".discount-type").val(),discount_value:n.find(".discount_value").val()};n.replaceWith(be(d)),c.push({zone:i,method:a}),o.data("exclude",c),oe(!0)}function ge(){const t=jQuery(this),e=t.closest("tr"),n=t.closest(".acfw-styled-table"),o=n.find("tbody"),i=e.find(".shipping-zone").data("object");let a=n.data("exclude")||[];a=a.filter((t=>t.zone!=i.shipping_zone||t.method!=i.shipping_method)),o.find("tr.no-result").remove(),e.replaceWith(_e(i)),n.data("exclude",a),ve("body").trigger("wc-enhanced-select-init")}function we(){const t=jQuery(this),e=t.closest("tr"),n=t.closest("table"),o=e.closest("tbody"),i=e.find("td").length,a=e.find("td.shipping-zone").data("object");let c=n.data("exclude");c=c.filter((t=>t.zone!=a.shipping_zone||t.method!=a.shipping_method)),n.data("exclude",c),e.remove(),o.find("tr").length<=0&&o.append(ie(i)),oe(!0)}function $e(){const{shipping_zone_already_added:t}=acfw_edit_coupon,e=jQuery(this),n=e.closest("tr"),o=e.closest("table"),i=n.closest("tbody"),a=n.find("td").length,c=n.find("td.shipping-zone").data("object"),{shipping_zone:d,shipping_method:s}=c;let l=o.data("exclude");l.filter((t=>t.zone==d&&t.method==s)).length?vex.dialog.alert(t):"nozone"===d&&s||d>=0&&s?(l.push({zone:d,method:d}),n.replaceWith(be(c)),o.data("exclude",l)):(n.remove(),i.find("tr").length<=0&&i.append(ie(a)))}const xe=jQuery,je=document.querySelector("#acfw_shipping_overrides");function ke(){xe(je).on("click",".acfw-styled-table tfoot .add-table-row",me),xe(je).on("change","tr.add-edit-form .select-shipping-zone",te),xe(je).on("click","tr.add-edit-form .actions .add",ye),xe(je).on("click","tr .actions .edit",ge),xe(je).on("click","tr .actions .remove",we),xe(je).on("click","tr.add-edit-form .actions .cancel",$e),xe(je).on("blur",".wc_input_price",o),xe(je).on("click","#save-shipping-overrides",se),xe(je).on("click","#clear-shipping-overrides",le),xe("form#post").on("submit",re),xe(je).css("min-height",xe("#coupon_options ul.coupon_data_tabs").height()+10),function(){const t=xe(je).find(".shipping-overrides-table"),e=t.find("tbody"),n=t.data("overrides");n.length&&(e.find("tr.no-result").remove(),n.forEach((t=>{e.append(be(t))})))}()}const qe=jQuery;function Se(){const t=document.querySelector("#acfw_scheduler");qe(t).on("change acfw_load",'.days-time-fields input[type="checkbox"]',ze),qe(t).on("change acfw_load",".days-time-fields input.time-field",Oe),qe(t).on("change",".days-time-fields input.time-field",Ne),qe(t).on("change acfw_load",".acfw-scheduler-section .date-field",Ce),qe(t).find('.days-time-fields input[type="checkbox"], .days-time-fields input.time-field').trigger("acfw_load"),qe(t).find(".acfw-scheduler-section .date-field").trigger("acfw_load"),qe(".wrap").on("submit","form#post",Qe),qe(".days-time-fields input.time-field").flatpickr({allowInput:!0,enableTime:!0,noCalendar:!0,altInput:!0,altFormat:"h:i K",dateFormat:"H:i",onOpen:function(t,e,n){if(""===e){var o=new Date;o.setHours(0),o.setMinutes(0),n.setDate(o),qe(".days-time-fields input.time-field").trigger("change")}}})}function Qe(t){qe(".days-time-fields input.time-field").hasClass("error")&&(t.preventDefault(),vex.dialog.alert({unsafeMessage:acfw_edit_coupon.invalid_scheduler_time}),qe("#publishing-action .spinner").removeClass("is-active"),qe("#publishing-action #publish").removeClass("disabled"))}function ze(){const t=qe(this),e=t.closest(".days-time-field");e.find(".start-time").prop("disabled",!t.is(":checked")||t.is(":disabled")),e.find(".end-time").prop("disabled",!t.is(":checked")||t.is(":disabled"))}function Oe(){const t=qe(this).closest(".days-time-field"),e=t.find(".start-time"),n=t.find(".end-time"),o=Ie(n.val())+1,i=Ie(e.val())-1,a=o?Je(o):"",c=i?Je(i):"";e.attr("max",null!=a?a:""),n.attr("min",null!=c?c:"")}function Ne(){const t=qe(this).closest(".days-time-field"),e=t.find(".start-time"),n=t.find(".end-time"),o=Ie(e.val()),i=Ie(n.val());o>=i?e.addClass("error"):e.removeClass("error"),i<=o?n.addClass("error"):n.removeClass("error")}function Ce(){const t=qe(this).closest(".options_group"),e=t.find("#_acfw_schedule_start"),n=t.find("#_acfw_schedule_expire"),o=function(t,e){const n=["sunday","monday","tuesday","wednesday","thursday","friday","saturday"],o=[];if(!t||!e)return n;for(const i=new Date(t);i<=new Date(e);i.setDate(i.getDate()+1))o.push(n[i.getDay()]);return[...new Set(o)]}(e.is(":disabled")?"":e.val(),e.is(":disabled")?"":n.val());["sunday","monday","tuesday","wednesday","thursday","friday","saturday"].forEach((t=>{const e=qe(`.${t}-time-field`);o.includes(t)?e.find('input[type="checkbox"]').prop("disabled",!1).trigger("change"):(e.find('input[type="checkbox"]').prop("disabled",!0),e.find(".time-field").prop("disabled",!0))}))}function Ie(t){const[e,n]=t.split(":").map((t=>parseInt(t)));return 60*e+n}function Je(t){const e=Math.floor(t/60),n=t-60*e;return`${String(e).padStart(2,"0")}:${String(n).padStart(2,"0")}`}const Ae=jQuery,{bogo_toggle_editing_mode:De}=acfw_edit_coupon,{post_id:Ee}=woocommerce_admin_meta_boxes;function Te(){const t=Ae(this),e=t.closest("#acfw_bogo_deals").find(".bogo-auto-add-products-field"),n=e.find("input[type='checkbox']");"specific-products"===t.val()?(n.prop("disabled",!1),e.addClass("show")):(n.prop("disabled",!1),e.removeClass("show"))}function We(){const t=Ae(this),e=t.find("select#bogo-deals-type"),n=t.find(".bogo-auto-add-products-field input[type='checkbox']");"specific-products"===e.val()&&Ae.post(ajaxurl,{action:"acfw_save_bogo_additional_settings",coupon_id:Ee,auto_add_products:n.is(":checked")?"yes":"no",nonce:Ae(".bogo-settings-field").data("nonce")})}function Pe(){const t=Ae("#acfw_bogo_deals"),e=t.find("input[name='bogo_type'][value='once']"),n=t.find("input[name='bogo_type'][value='repeat']"),o=t.find("#bogo-condition-type").val(),i=t.find("#bogo-deals-type").val();t.find(".repeat-incompatible").remove(),"any-products"===i&&"any-products"!==o?(e.prop("checked",!0),n.prop("disabled",!0),n.closest(".radio-group-wrap").append(`<span class="repeat-incompatible">${acfw_edit_coupon.repeat_incompatible_notice}</span>`)):n.prop("disabled",!1)}const Me=document.querySelector(".acfw-sort-coupon-priority-field"),Fe=jQuery;function He(){const t=Fe(this),e=Fe(Me).find("input#_acfw_coupon_sort_priority"),n=t.val().toString();switch(n){case"0":case"1":case"10":case"30":case"50":case"90":e.hide(),e.val(n);break;default:e.show(),e.val(Fe(Me).data("value"))}}function Ve(){const t=Fe(this),e=parseInt(t.val());(isNaN(e)||1>e)&&(vex.dialog.alert(acfw_edit_coupon.coupon_sort_invalid),t.val(""))}const Ke=jQuery;function Re(t){const e=jQuery(this),n=e.closest(".inside"),o=Ke("select.acfw-allowed-customers");"change"===t.type&&n.find(".save-notice").show(),e.is(":checked")?(n.removeClass("disabled"),o.prop("disabled",!0),o.closest(".options_group").hide(),Xe(!0)):(n.addClass("disabled"),o.closest(".options_group").show(),o.prop("disabled",!1),Xe(!1))}function Xe(t){const e=jQuery(".form-field._acfw_coupon_url_field"),n=jQuery(".form-field._acfw_code_url_override_field");if(t){var o;const t=null!==(o=Ke("#acfw-virtual-coupon .feature-control").data("labels"))&&void 0!==o?o:{};e.find("input,button,span").hide(),e.append(`<span class="vc-manage-url-coupon">${t.url_coupon_message}</span>`),n.hide()}else e.find(".vc-manage-url-coupon").remove(),e.find("input,button,span").show(),n.show()}jQuery;const Be=jQuery;function Ge(){const t=Be(this),e=t.closest(".woocommerce_options_panel").find("._acfw_percentage_discount_cap_field");"percent"===t.val()||"acfw_percentage_cashback"===t.val()?(e.addClass("show"),e.find("input").prop("disabled",!1)):(e.removeClass("show"),e.find("input").prop("disabled",!0))}function Le(){Be("#_acfw_coupon_label").prop("disabled",!1)}const Ue=jQuery;function Ye(){Ue("#general_coupon_data").on("change acfw_load","#discount_type",Ze),Ue("#general_coupon_data").on("change acfw_load","#discount_type",tn),Ue("#discount_type").trigger("acfw_load")}function Ze(){const t=Ue(this),e=Ue("p.coupon_amount_field label"),{cashback_coupon:n}=acfw_edit_coupon;let o=e.data("default_label");switch(o||(e.data("default_label",e.text()),o=e.text()),t.val()){case"acfw_percentage_cashback":e.text(n.cashback_percentage_label);break;case"acfw_fixed_cashback":e.text(n.cashback_amount_label);break;default:e.text(o)}}function tn(){const t=Ue(this),e=Ue("#_acfw_cashback_waiting_period");switch(t.val()){case"acfw_percentage_cashback":case"acfw_fixed_cashback":e.closest("p.form-field").show(),e.prop("disabled",!1);break;default:e.closest("p.form-field").hide(),e.prop("disabled",!0)}}const{modules:en}=acfw_edit_coupon;jQuery(document).ready((t=>{en.indexOf("acfw_cart_conditions_module")>-1&&xt(),en.indexOf("acfw_add_free_products_module")>-1&&Xt(),en.indexOf("acfw_auto_apply_module")>-1&&(Ut("body").on("change","#customer_email,#acfw_auto_apply_coupon_field,#usage_limit,#usage_limit_per_user,#_acfw_enable_virtual_coupons",Yt),Ut("#customer_email,#acfw_auto_apply_coupon_field").trigger("change")),en.indexOf("acfw_shipping_overrides_module")>-1&&ke(),en.indexOf("acfw_scheduler_module")>-1&&Se(),en.indexOf("acfw_bogo_deals_module")>-1&&function(){const t=document.querySelector("#acfw_bogo_deals");Ae(t).on("change acfw_load","select#bogo-deals-type",Te),Ae(t).on("change acfw_load","select#bogo-condition-type,select#bogo-deals-type",Pe),Ae(t).on("change acfw_load",".bogo-auto-add-products-field input[type='checkbox']",(()=>De(!0))),Ae(t).on("save_bogo_deals",We),Ae(t).find("select#bogo-deals-type").trigger("acfw_load")}(),en.indexOf("acfw_sort_coupons_module")>-1&&(Fe(Me).on("change","select#_acfw_coupon_sort_select",He),Fe(Me).on("change","input#_acfw_coupon_sort_priority",Ve),Fe(Me).find("select#_acfw_coupon_sort_select").trigger("change")),en.indexOf("acfw_virtual_coupons_module")>-1&&(Ke("body").on("change load_virtual_coupon","#_acfw_enable_virtual_coupons",Re),Ke("#_acfw_enable_virtual_coupons").trigger("load_virtual_coupon")),function(){const t=jQuery("p.acfw_exclude_coupons_field"),e=t.closest(".options_group");t.insertAfter("p.form-field.individual_use_field"),e.remove()}(),Be("#woocommerce-coupon-data").on("change acfwp_load","#discount_type",Ge),Be("#woocommerce-coupon-data").on("change acfw_load","select#discount_type",Le),Be("#discount_type").trigger("acfwp_load"),Be("#_acfw_coupon_label").trigger("acfw_load"),Ye()}))}}}));
