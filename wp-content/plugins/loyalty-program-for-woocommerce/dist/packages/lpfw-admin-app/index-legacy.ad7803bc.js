System.register(["../../common/index-legacy.bd623a01.js","../../common/reactLib-legacy.665c3571.js"],(function(e,t){"use strict";var n;return{setters:[e=>{n=e.a},null],execute:function(){var e=document.createElement("style");e.textContent='#lpfw_admin_app{margin:70px 25px 0}#lpfw_admin_app .page-header .acfw-logo,#lpfw_admin_app .tab-header .acfw-logo{margin-bottom:40px}#lpfw_admin_app .page-header h1,#lpfw_admin_app .tab-header h1{font-size:26px;line-height:31px;font-weight:700}#lpfw_admin_app .page-header p,#lpfw_admin_app .tab-header p{font-size:16px;line-height:19px}#lpfw_admin_app #lpfw_loyalty_point_reminder_schedule_waiting_period_field .ant-input-affix-wrapper{width:25%}#lpfw_admin_app #lpfw_loyalty_point_reminder_schedule_field .field-desc a{text-decoration:underline;padding-top:.25rem;display:block}#lpfw_admin_app #acfw_loyalprog_disallowed_users_field .ant-select-selection-search-input{box-shadow:none!important}#lpfw_admin_app .field-desc .btn-preview-email,#lpfw_admin_app .field-desc .btn-wc-email-setting{display:block;text-decoration:underline}.lpfw-activate-license-notice h4.lpfw-activate-license-notice{margin:1.1em}.lpfw-dashboard{max-width:1300px}.lpfw-dashboard .ant-card{margin-bottom:20px;min-height:604px}.lpfw-dashboard .ant-card .ant-card-head-title{font-weight:700}.lpfw-dashboard .ant-card table{border:1px solid #f0f0f0}.lpfw-dashboard .ant-card table .ant-table-thead th{font-weight:700}.lpfw-dashboard .lpfw-dashboard-history .ant-table-empty table{min-height:490px}.lpfw-dashboard .lpfw-dashboard-history .ant-pagination{text-align:right;margin-top:1em}.lpfw-customers-list,.lpfw-single-customer{max-width:1100px}.lpfw-customers-list .ant-descriptions,.lpfw-single-customer .ant-descriptions,.lpfw-customers-list .ant-card,.lpfw-single-customer .ant-card{margin-bottom:20px}.lpfw-customers-list .ant-card.customer-points-status,.lpfw-customers-list .ant-card.customer-points-sources,.lpfw-single-customer .ant-card.customer-points-status,.lpfw-single-customer .ant-card.customer-points-sources{min-height:604px}.lpfw-customers-list .ant-card .ant-card-head-title,.lpfw-single-customer .ant-card .ant-card-head-title{font-weight:700}.lpfw-customers-list .ant-card table,.lpfw-single-customer .ant-card table{border:1px solid #f0f0f0}.lpfw-customers-list .ant-card table .ant-table-thead th,.lpfw-single-customer .ant-card table .ant-table-thead th{font-weight:700}.lpfw-customers-list .ant-card.adjust-points-card .ant-select,.lpfw-customers-list .ant-card.adjust-points-card .ant-input,.lpfw-single-customer .ant-card.adjust-points-card .ant-select,.lpfw-single-customer .ant-card.adjust-points-card .ant-input{width:256px;border-radius:0;border-color:#d9d9d9}.lpfw-customers-list .ant-card.adjust-points-card .ant-btn-primary,.lpfw-single-customer .ant-card.adjust-points-card .ant-btn-primary{background:#1693a7;border-color:#1693a7;border-radius:0}.lpfw-customers-list .ant-card.adjust-points-card .ant-btn-primary:hover,.lpfw-single-customer .ant-card.adjust-points-card .ant-btn-primary:hover{opacity:.9}.lpfw-customers-list .ant-card .ant-pagination,.lpfw-single-customer .ant-card .ant-pagination{text-align:right;margin-top:10px}.lpfw-customers-list .go-back-customers,.lpfw-single-customer .go-back-customers{margin-bottom:25px}.confirm-adjust-points{background:#1693a7;border-color:#1693a7;border-radius:0}.confirm-adjust-points:hover{opacity:.9;background:#1693a7;border-color:#1693a7}.reload-points-btn-wrap{display:flex;flex-wrap:wrap;align-items:flex-start;justify-content:space-between}.reload-points-btn-wrap .ant-btn{visibility:hidden}.reload-points-btn-wrap .ant-btn.show{visibility:visible}.lpfw-setting-field-label{display:inline-block;max-width:calc(100% - 25px)}.point-calc-options .option,.actions-earn-points-options .option{margin-bottom:10px}.point-calc-options .option button,.point-calc-options .option .ant-typography,.actions-earn-points-options .option button,.actions-earn-points-options .option .ant-typography{margin-right:10px}.points-table-actions button{background:transparent;border:0;cursor:pointer}.points-table-actions button.delete{color:red}.points-table-actions button:hover{opacity:.8}.form-heading.spacer{padding-top:30px}.form-heading h3{font-weight:700}.order-points-table .points{width:100px!important}.order-points-table .points-table-actions{width:70px!important}.import-points-form-wrapper{margin-bottom:1em}.import-points-form-wrapper:after{content:"";display:table;clear:both}.import-points-form-wrapper .deactivate-plugin-checkbox{margin-top:10px}.import-points-form-wrapper .ant-btn-primary{float:right;margin-top:10px}.import-points-progress-wrapper p{margin:0}.import-points-progress-wrapper .ant-descriptions{max-width:300px;margin-top:1.5em}#lpfw_admin_app .acfw-license-box{margin-top:-70px}#lpfw_admin_app .acfw-license-box .license-info{position:relative}#lpfw_admin_app .acfw-license-box .license-info .heading .left{width:calc(100% - 192px)!important}#lpfw_admin_app .acfw-license-box .license-info .overlay{display:none;position:absolute;top:0;left:0;width:100%;height:100%;background:rgba(255,255,255,.6);align-items:center;justify-content:center;text-align:center}#lpfw_admin_app .acfw-license-box .license-info.show .overlay{display:flex}#lpfw_admin_app .acfw-license-box .license-info .active-indicator.activated{padding:12px 16px;background:#c6cd2e}#lpfw_admin_app .acfw-license-box .license-info .active-indicator.activated .anticon{margin-right:.5em}#lpfw_admin_app .acfw-license-box .content table *{text-align:left}#lpfw_admin_app .acfw-license-box .no-hover{opacity:1!important}#lpfw_admin_app .acfw-license-box .license-specs th,#lpfw_admin_app .acfw-license-box .license-specs td{text-align:center}#lpfw_admin_app .acfw-license-box .license-form{padding:20px 30px;border-top:1px solid #d5d5d5;background:#f1f1f1}#lpfw_admin_app .acfw-license-box .license-form .ant-form{display:flex;align-items:end;justify-content:space-between}#lpfw_admin_app .acfw-license-box .license-form .ant-form .license-form-item{width:calc(50% - 99px);margin-bottom:10px}#lpfw_admin_app .acfw-license-box .license-form .ant-form .license-form-item.form-action{width:100%;max-width:198px}#lpfw_admin_app .acfw-license-box .license-form .ant-form .ant-form-item-label{padding-bottom:5px}#lpfw_admin_app .acfw-license-box .license-form .ant-form input,#lpfw_admin_app .acfw-license-box .license-form .ant-form button{border-radius:2px;font-size:16px}#lpfw_admin_app .acfw-license-box .license-form .ant-form label{display:inline-block;font-size:13px;color:#444;font-weight:700}#lpfw_admin_app .acfw-license-box .license-form .ant-form input{padding:5px 10px;width:calc(100% - 15px);border:1px solid #D9D9D9;box-sizing:border-box}#lpfw_admin_app .acfw-license-box .license-form .ant-form button{width:100%;margin-top:27px;background:#C6CD2E;cursor:pointer;border:0;color:#262626;height:43px;font-weight:700}#lpfw_admin_app .acfw-license-box .license-form .ant-form button:hover{opacity:.8}#lpfw_admin_app .acfw-license-box .license-form .help-row{font-size:13px}#lpfw_admin_app .acfw-license-box .license-form .help-row a{color:inherit;text-decoration:underline}#lpfw_admin_app .acfw-license-box .license-form .help-row a:hover{color:#00a0d2}\n',document.head.appendChild(e);var t=(e=>(e.READ_DASHBOARD_DATA="READ_DASHBOARD_DATA",e.READ_DASHBOARD_HISTORY_DATA="READ_DASHBOARD_HISTORY_DATA",e.SET_DASHBOARD_DATA="SET_DASHBOARD_DATA",e.SET_DASHBOARD_HISTORY_DATA="SET_DASHBOARD_HISTORY_DATA",e))(t||{});const a={readDashboardData:e=>({type:"READ_DASHBOARD_DATA",payload:e}),readDashboardHistoryData:e=>({type:"READ_DASHBOARD_HISTORY_DATA",payload:e}),setStoreDashboardData:e=>({type:"SET_DASHBOARD_DATA",payload:e}),setStoreDashboardHistoryData:e=>({type:"SET_DASHBOARD_HISTORY_DATA",payload:e})},l=(e=null,n)=>{switch(n.type){case t.SET_DASHBOARD_DATA:{const{data:t}=n.payload;return{...e,...t}}case t.SET_DASHBOARD_HISTORY_DATA:{const{data:t}=n.payload;return{...e,history:t}}default:return e}};var s=(e=>(e.READ_SECTIONS="READ_SECTIONS",e.READ_SECTION="READ_SECTION",e.SET_STORE_SECTIONS="SET_STORE_SECTIONS",e.SET_STORE_SECTION="SET_STORE_SECTION",e))(s||{});const o={readSections:e=>({type:"READ_SECTIONS",payload:e}),readSection:e=>({type:"READ_SECTION",payload:e}),setStoreSectionItems:e=>({type:"SET_STORE_SECTIONS",payload:e}),setStoreSectionItem:e=>({type:"SET_STORE_SECTION",payload:e})},{lodash:{cloneDeep:r}}=acfwpElements,c=(e=[],t)=>{switch(t.type){case s.SET_STORE_SECTIONS:{const{data:e}=t.payload;return e}case s.SET_STORE_SECTION:{const{data:n}=t.payload,a=e.findIndex((e=>e.id===n.id));if(a<0)return e;const l=r(e);return l[a]={...l[a],...n},l}default:return e}};var i=(e=>(e.CREATE_SETTING="CREATE_SETTING",e.UPDATE_SETTING="UPDATE_SETTING",e.DELETE_SETTING="DELETE_SETTING",e.READ_SETTINGS="READ_SETTINGS",e.REHYDRATE_STORE_SETTINGS="REHYDRATE_STORE_SETTINGS",e.REHYDRATE_STORE_SETTING="REHYDRATE_STORE_SETTING",e.SET_STORE_SETTINGS="SET_STORE_SETTINGS",e.SET_STORE_SETTING="SET_STORE_SETTING",e))(i||{});const m={createSetting:e=>({type:"CREATE_SETTING",payload:e}),updateSetting:e=>({type:"UPDATE_SETTING",payload:e}),deleteSetting:e=>({type:"DELETE_SETTING",payload:e}),readSettings:e=>({type:"READ_SETTINGS",payload:e}),rehydrateStoreSettings:e=>({type:"REHYDRATE_STORE_SETTINGS",payload:e}),rehydrateStoreSetting:e=>({type:"REHYDRATE_STORE_SETTING",payload:e}),setStoreSettingItems:e=>({type:"SET_STORE_SETTINGS",payload:e}),setStoreSettingItem:e=>({type:"SET_STORE_SETTING",payload:e})},{lodash:{cloneDeep:p}}=acfwpElements,d=(e=[],t)=>{switch(t.type){case i.SET_STORE_SETTINGS:{const{data:n}=t.payload;let a=p(e);for(const t of n){let n=e.findIndex((e=>e.id===t.id));a[n]?a[n]=t:a.push(t)}return a}case i.SET_STORE_SETTING:{const{data:n}=t.payload,a=e.findIndex((e=>e.id===n.id));if(a<0)return e;const l=p(e);return l[a]={...l[a],...n},l}default:return e}};var u=(e=>(e.READ_CUSTOMERS="READ_CUSTOMERS",e.READ_SINGLE_CUSTOMER="READ_SINGLE_CUSTOMER",e.READ_SINGLE_CUSTOMER_POINTS="READ_SINGLE_CUSTOMER_POINTS",e.READ_CUSTOMER_STATUS="READ_CUSTOMER_STATUS",e.READ_CUSTOMER_HISTORY="READ_CUSTOMER_HISTORY",e.ADJUST_CUSTOMER_POINTS="ADJUST_CUSTOMER_POINTS",e.SET_STORE_CUSTOMERS="SET_STORE_CUSTOMERS",e.SET_SINGLE_CUSTOMER="SET_SINGLE_CUSTOMER",e.SET_SINGLE_CUSTOMER_POINTS="SET_SINGLE_CUSTOMER_POINTS",e.SET_STORE_CUSTOMER_STATUS="SET_STORE_CUSTOMER_STATUS",e.SET_STORE_CUSTOMER_SOURCES="SET_STORE_CUSTOMER_SOURCES",e.SET_STORE_HISTORY_ENTRIES="SET_STORE_HISTORY_ENTRIES",e.SET_STORE_HISTORY_ENTRY="SET_STORE_HISTORY_ENTRY",e))(u||{});const f={readCustomers:e=>({type:"READ_CUSTOMERS",payload:e}),readSingleCustomer:e=>({type:"READ_SINGLE_CUSTOMER",payload:e}),readSingleCustomerPoints:e=>({type:"READ_SINGLE_CUSTOMER_POINTS",payload:e}),readCustomerStatus:e=>({type:"READ_CUSTOMER_STATUS",payload:e}),readCustomerHistory:e=>({type:"READ_CUSTOMER_HISTORY",payload:e}),adjustCustomerPoints:e=>({type:"ADJUST_CUSTOMER_POINTS",payload:e}),setStoreCustomers:e=>({type:"SET_STORE_CUSTOMERS",payload:e}),setStoreSingleCustomer:e=>({type:"SET_SINGLE_CUSTOMER",payload:e}),setStoreSingleCustomerCustomer:e=>({type:"SET_SINGLE_CUSTOMER_POINTS",payload:e}),setStoreCustomerStatus:e=>({type:"SET_STORE_CUSTOMER_STATUS",payload:e}),setStoreCustomerSources:e=>({type:"SET_STORE_CUSTOMER_SOURCES",payload:e}),setStoreHIstoryEntries:e=>({type:"SET_STORE_HISTORY_ENTRIES",payload:e}),setStoreHistoryEntry:e=>({type:"SET_STORE_HISTORY_ENTRY",payload:e})};acfwpElements;const E=(e=[],t)=>{let n;switch(t.type){case u.SET_STORE_CUSTOMERS:{const{data:e}=t.payload;return e}case u.SET_SINGLE_CUSTOMER:{const{data:a}=t.payload;return n=e.findIndex((e=>e.id===a.id)),n>=0?(e[n]=a,[...e]):[a,...e]}case u.SET_SINGLE_CUSTOMER_POINTS:{const{id:a,data:l}=t.payload;return n=e.findIndex((e=>e.id===a)),e[n]={...e[n],points:l.points,expiry:l.expiry},[...e]}case u.SET_STORE_CUSTOMER_STATUS:{const{id:a,data:l}=t.payload;return n=e.findIndex((e=>e.id===a)),e[n]={...e[n],status:l},[...e]}case u.SET_STORE_CUSTOMER_SOURCES:{const{id:a,data:l}=t.payload;return n=e.findIndex((e=>e.id===a)),e[n]={...e[n],sources:l},[...e]}case u.SET_STORE_HISTORY_ENTRIES:{const{id:a,data:l}=t.payload;return n=e.findIndex((e=>e.id===a)),e[n]={...e[n],history:l},[...e]}case u.SET_STORE_HISTORY_ENTRY:{var a,l;const{id:s,data:o}=t.payload;n=e.findIndex((e=>e.id===s));const r=null!==(a=null===(l=e[n])||void 0===l?void 0:l.history)&&void 0!==a?a:[];return e[n]={...e[n],history:[...r,o]},[...e]}default:return e}};var w=(e=>(e.READ_LICENSE="READ_LICENSE",e.ACTIVATE_LICENSE="ACTIVATE_LICENSE",e.SET_LICENSE="SET_LICENSE",e))(w||{});const y={readLicenseData:e=>({type:"READ_LICENSE",payload:e}),activateLicenseData:e=>({type:"ACTIVATE_LICENSE",payload:e}),setLicenseData:e=>({type:"SET_LICENSE",payload:e})},g=(e=null,t)=>{if(t.type===w.SET_LICENSE){const{data:e}=t.payload;return e}return e},{axiosInstance:S,redux:{sagaEffects:_}}=acfwpElements,{put:h,call:T,takeEvery:v}=_,b=[v(t.READ_DASHBOARD_DATA,(function*(e){const{processingCB:t,successCB:n,failCB:l}=e.payload;try{"function"==typeof t&&t();const e=yield T((()=>S.get("loyalty-program/v1/dashboard")));e&&e.data&&h&&(yield h(a.setStoreDashboardData({data:e.data})),"function"==typeof n&&n(e))}catch(s){"function"==typeof l&&l({error:s})}})),v(t.READ_DASHBOARD_HISTORY_DATA,(function*(e){const{page:t,before_date:n,after_date:l,processingCB:s,successCB:o,failCB:r}=e.payload;try{"function"==typeof s&&s();const e=yield T((()=>S.get("loyalty-program/v1/dashboard/history",{params:{page:t,before_date:n,after_date:l}})));e&&e.data&&h&&(yield h(a.setStoreDashboardHistoryData({data:e.data})),"function"==typeof o&&o(e))}catch(c){"function"==typeof r&&r({error:c})}}))],{redux:{sagaEffects:C},axiosInstance:x}=acfwpElements,{put:R,call:I,takeEvery:A}=C,O=[A(s.READ_SECTIONS,(function*(e){const{id:t,processingCB:n,successCB:a,failCB:l}=e.payload,s=t||"general";try{"function"==typeof n&&n(),x.defaults.headers.section=s;const e=yield I((()=>x.get("loyalty-program/v1/settings/sections")));if(e&&e.data){const t=s?e.data.findIndex((e=>e.id===s)):0;yield R(m.rehydrateStoreSettings({data:e.data[t]})),yield R(o.setStoreSectionItems({data:e.data})),"function"==typeof a&&a(e)}}catch(r){"function"==typeof l&&l({error:r})}})),A(s.READ_SECTION,(function*(e){const{id:t,processingCB:n,successCB:a,failCB:l}=e.payload;try{"function"==typeof n&&n();const e=t||"general",l=yield I((()=>x.get(`loyalty-program/v1/settings/sections/${e}`)));l&&l.data&&(yield R(m.rehydrateStoreSettings({data:l.data})),yield R(o.setStoreSectionItem({data:l.data})),"function"==typeof a&&a(l))}catch(s){"function"==typeof l&&l({error:s})}}))],D=n.CancelToken,N=n.create({baseURL:wpApiSettings.root,timeout:3e4,headers:{"X-WP-Nonce":wpApiSettings.nonce}}),k=new Map,B=e=>new D((t=>k.set(e,t))),{redux:{sagaEffects:P}}=acfwpElements,{put:H,call:L,takeEvery:U}=P,M=[U(i.CREATE_SETTING,(function*(e){const{data:t,processingCB:n,successCB:a,failCB:l}=e.payload;try{"function"==typeof n&&n();const e=yield L((()=>N.post("loyalty-program/v1/setting/sections",t)));e&&e.data&&(yield H(m.rehydrateStoreSettings({})),"function"==typeof a&&a(e))}catch(s){"function"==typeof l&&l({error:s,payload:t})}})),U(i.UPDATE_SETTING,(function*(e){const{data:t,processingCB:a,successCB:l,failCB:s}=e.payload;try{if("function"==typeof a&&a(),!t.id)throw new Error("Can't update setting. No setting id provided.");const e=yield L((()=>{const{id:e,...n}=t;return N.put(`loyalty-program/v1/settings/${e}`,n,{cancelToken:B(e)})}));e&&e.data&&(yield H(m.rehydrateStoreSetting({id:e.data.id,data:e.data})),"function"==typeof l&&l(e))}catch(o){if(n.isCancel(o))return;"function"==typeof s&&s({error:o,payload:t})}})),U(i.DELETE_SETTING,(function*(e){const{id:t,processingCB:n,successCB:a,failCB:l}=e.payload;try{"function"==typeof n&&n();const e=yield L((()=>N.delete(`loyalty-program/v1/settings/${t}`)));e&&e.data&&(yield H(m.rehydrateStoreSettings({})),"function"==typeof a&&a(e))}catch(s){"function"==typeof l&&l({error:s})}})),U(i.READ_SETTINGS,(function*(e){const{processingCB:t,successCB:n,failCB:a}=e.payload;try{"function"==typeof t&&t();const e=yield L((()=>N.get("loyalty-program/v1/settings/")));e&&e.data&&(yield H(m.rehydrateStoreSettings({data:e.data})),"function"==typeof n&&n(e))}catch(l){"function"==typeof a&&a({error:l})}})),U(i.REHYDRATE_STORE_SETTINGS,(function*(e){const{data:t,processingCB:n,successCB:a,failCB:l}=e.payload;try{if("function"==typeof n&&n(),t){let e=t.fields.filter((e=>"title"!==e.type&&"sectionend"!==e.type)).map((e=>({id:e.id,value:e.value})));yield H(m.setStoreSettingItems({data:e})),"function"==typeof a&&a(e)}}catch(s){"function"==typeof l&&l({error:s})}})),U(i.REHYDRATE_STORE_SETTING,(function*(e){const{id:t,data:n,processingCB:a,successCB:l,failCB:s}=e.payload;try{if("function"==typeof a&&a(),n)yield H(m.setStoreSettingItem({data:n})),"function"==typeof l&&l(n);else{const e=yield L((()=>N.get(`loyalty-program/v1/settings/${t}`)));e&&e.data&&(yield H(m.setStoreSettingItem({data:e.data})),"function"==typeof l&&l(e))}}catch(o){"function"==typeof s&&s({error:o})}}))],{axiosInstance:Y,redux:{sagaEffects:V}}=acfwpElements,{put:G,call:$,takeEvery:j}=V,F=[j(u.READ_CUSTOMERS,(function*(e){const{params:t,processingCB:n,successCB:a,failCB:l,alwaysCB:s}=e.payload;try{"function"==typeof n&&n();const e=yield $((()=>Y.get("loyalty-program/v1/customers",{params:t})));e&&e.data&&(yield G(f.setStoreCustomers({data:e.data})),"function"==typeof a&&a(e))}catch(o){"function"==typeof l&&l({error:o})}"function"==typeof s&&s()})),j(u.READ_SINGLE_CUSTOMER,(function*(e){const{id:t,processingCB:n,successCB:a,failCB:l,alwaysCB:s}=e.payload;try{"function"==typeof n&&n();const e=yield $((()=>Y.get(`loyalty-program/v1/customers/${t}`)));e&&e.data&&(yield G(f.setStoreSingleCustomer({data:e.data})),"function"==typeof a&&a(e))}catch(o){"function"==typeof l&&l({error:o})}"function"==typeof s&&s()})),j(u.READ_SINGLE_CUSTOMER_POINTS,(function*(e){const{id:t,processingCB:n,successCB:a,failCB:l,alwaysCB:s}=e.payload;try{"function"==typeof n&&n();const e=yield $((()=>Y.get(`loyalty-program/v1/customers/points/${t}`)));e&&e.data&&(yield G(f.setStoreSingleCustomerCustomer({id:t,data:e.data})),"function"==typeof a&&a(e))}catch(o){"function"==typeof l&&l({error:o})}"function"==typeof s&&s()})),j(u.READ_CUSTOMER_STATUS,(function*(e){const{id:t,processingCB:n,successCB:a,failCB:l,alwaysCB:s}=e.payload;try{"function"==typeof n&&n();const e=yield $((()=>Y.get(`loyalty-program/v1/customers/status/${t}`)));e&&e.data&&G&&(yield G(f.setStoreCustomerStatus({id:t,data:e.data.status})),yield G(f.setStoreCustomerSources({id:t,data:e.data.sources})),"function"==typeof a&&a(e))}catch(o){"function"==typeof l&&l({error:o})}"function"==typeof s&&s()})),j(u.READ_CUSTOMER_HISTORY,(function*(e){const{id:t,page:n,processingCB:a,successCB:l,failCB:s,alwaysCB:o}=e.payload;try{"function"==typeof a&&a();const e=yield $((()=>Y.get(`loyalty-program/v1/customers/history/${t}`,{params:{page:n}})));e&&e.data&&G&&(yield G(f.setStoreHIstoryEntries({id:t,data:e.data})),"function"==typeof l&&l(e))}catch(r){"function"==typeof s&&s({error:r})}"function"==typeof o&&o()})),j(u.ADJUST_CUSTOMER_POINTS,(function*(e){const{id:t,type:n,points:a,notes:l,processingCB:s,successCB:o,failCB:r,alwaysCB:c}=e.payload;try{"function"==typeof s&&s();const e=yield $((()=>Y.post(`loyalty-program/v1/customers/points/${t}`,{id:t,type:n,points:a,notes:l})));e&&e.data&&G&&"function"==typeof o&&o(e)}catch(i){"function"==typeof r&&r({error:i})}"function"==typeof c&&c()}))],{axiosInstance:z,redux:{sagaEffects:q}}=acfwpElements,{put:J,call:Q,takeEvery:W}=q,K=[W(w.READ_LICENSE,(function*(e){const{processingCB:t,successCB:n,failCB:a,alwaysCB:l}=e.payload;try{"function"==typeof t&&t();const e=yield Q((()=>z({url:ajaxurl,baseURL:window.location.origin.toString(),params:{action:"lpfw_get_license_details"}})));var s,o;e&&e.data&&J&&(yield J(y.setLicenseData({data:{key:null!==(s=e.data.license_key)&&void 0!==s?s:"",email:null!==(o=e.data.email)&&void 0!==o?o:"",is_active:e.data.is_active}})),"function"==typeof n&&n(e))}catch(r){"function"==typeof a&&a({error:r})}"function"==typeof l&&l()})),W(w.ACTIVATE_LICENSE,(function*(e){const{license_key:t,email:n,processingCB:a,successCB:l,failCB:s,alwaysCB:o}=e.payload;try{"function"==typeof a&&a();const e=acfwAdminApp.loyalty_program.license._formNonce,s=new FormData;s.append("action","lpfw_activate_license"),s.append("activation-email",n),s.append("license-key",t),s.append("ajax-nonce",e);const o=yield Q((()=>z({url:ajaxurl,method:"POST",baseURL:window.location.origin.toString(),data:s})));o&&o.data&&J&&(yield J(y.setLicenseData({data:{key:t,email:n,is_active:"active"===o.data.license_status?"yes":"no"}})),"function"==typeof l&&l(o))}catch(r){"function"==typeof s&&s({error:r})}"function"==typeof o&&o()}))],{redux:{sagaEffects:X}}=acfwpElements,{all:Z}=X;function*ee(){yield Z([...b,...O,...M,...F,...K])}const{redux:{sagaEffects:te,createStore:ne,combineReducers:ae,applyMiddleware:le,createSagaMiddleware:se}}=acfwpElements,{element:{createContext:oe,useReducer:re}}=acfwpElements,ce=(e,t)=>{switch(t.type){case"SET_PAGE":return{...e,page:t.value};case"SET_PER_PAGE":return{...e,per_page:t.value};case"SET_SEARCH":return{...e,search:t.value,page:1};case"SET_SORT_BY":return{...e,sort_by:t.value};case"SET_SORT_ORDER":return{...e,sort_order:t.value};case"SET_QUERY":return t.value}return e},ie=oe({params:{page:1},dispatchParams:e=>{}}),me=({children:e})=>{const[t,n]=re(ce,{page:1});return acfwpElements.element.createElement(ie.Provider,{value:{params:t,dispatchParams:n}},e)},{element:{useState:pe,useEffect:de},antd:{Table:ue},redux:{bindActionCreators:fe,connect:Ee}}=acfwpElements,we=Ee((e=>{var t;return{status:null===(t=e.dashboard)||void 0===t?void 0:t.status}}),(e=>({actions:fe({},e)})))((e=>{const{status:t}=e,{loyalty_program:{labels:n}}=acfwAdminApp,{information:a,points:l,value:s}=n,[o,r]=pe(!0),c=[{title:a,dataIndex:"label",key:"label"},{title:l,dataIndex:"points",key:"points"},{title:s,dataIndex:"value",key:"value"}];return de((()=>{t&&t.length&&r(!1)}),[t,r]),acfwpElements.element.createElement(ue,{loading:o,pagination:!1,dataSource:t,columns:c})})),{element:{useState:ye,useEffect:ge},antd:{Table:Se},redux:{bindActionCreators:_e,connect:he}}=acfwpElements,Te=he((e=>{var t;return{sources:null===(t=e.dashboard)||void 0===t?void 0:t.sources}}),(e=>({actions:_e({},e)})))((e=>{const{sources:t}=e,{loyalty_program:{labels:n}}=acfwAdminApp,[a,l]=ye(!0),s=[{title:n.source,dataIndex:"label",key:"label"},{title:n.points,dataIndex:"points",key:"points"}];return ge((()=>{t&&t.length&&l(!1)}),[t,l]),acfwpElements.element.createElement(Se,{loading:a,pagination:!1,dataSource:t,columns:s})})),{element:{useState:ve,useEffect:be},router:{Link:Ce},antd:{Table:xe},redux:{connect:Re},pathPrefix:Ie}=acfwpElements,Ae=Re((e=>{var t;return{customers:null===(t=e.dashboard)||void 0===t?void 0:t.customers}}),null)((e=>{const{customers:t}=e,{loyalty_program:{labels:n}}=acfwAdminApp,[a,l]=ve(!0),s=[{title:n.customer,dataIndex:"name",key:"name",render:(e,t)=>acfwpElements.element.createElement(Ce,{to:`${Ie}admin.php?page=acfw-loyalty-program&tab=customers&customer=${t.id}`},e)},{title:n.points,dataIndex:"points",key:"points"}];return be((()=>{Array.isArray(t)&&l(!1)}),[t,l]),acfwpElements.element.createElement(xe,{loading:a,pagination:!1,dataSource:t,columns:s})})),{validateURL:Oe}=acfwpElements;function De(e){const{decimalPoint:t}=lpfwAdminApp,n=new RegExp(`[^-0-9%\\${t}]+`,"gi"),a=new RegExp(`[^\\${t}"]`,"gi");let l=e.replace(n,"");1<l.replace(a,"").length&&(l=l.replace(a,""));const s=parseFloat(l.replace(t,"."));return e===l&&s>=0}function Ne(e){const{decimalPoint:t}=lpfwAdminApp;return parseFloat(e.replace(t,"."))}function ke(e){return"increase"===e.type?"+":"-"}const{element:{useState:Be,useEffect:Pe},router:{Link:He},antd:{Card:Le,Select:Ue,DatePicker:Me,Table:Ye,Pagination:Ve,Popover:Ge},antdIcons:{FileTextOutlined:$e},redux:{bindActionCreators:je,connect:Fe},pathPrefix:ze}=acfwpElements,{readDashboardHistoryData:qe}=a,Je=Fe((e=>{var t;return{entries:null===(t=e.dashboard)||void 0===t?void 0:t.history}}),(e=>({actions:je({readDashboardHistoryData:qe},e)})))((e=>{const{entries:t,actions:n}=e,{loyalty_program:{labels:a,period_options:l}}=acfwAdminApp,[s,o]=Be(1),[r,c]=Be("month_to_date"),[i,m]=Be(moment().startOf("month")),[p,d]=Be(moment().startOf("day")),[u,f]=Be(""),[E,w]=Be(!0);Pe((()=>{w(!0),n.readDashboardHistoryData({page:s,before_date:i.format("YYYY-MM-DD"),after_date:p.format("YYYY-MM-DD"),successCB:e=>{f(e.headers["x-total"]),w(!1)}})}),[s,i,p]),Pe((()=>{t&&t.length&&w(!1)}),[t,w]);const y=[{title:a.date,dataIndex:"date",key:"date"},{title:a.customer,dataIndex:"user_id",key:"user_id",render:(e,t)=>acfwpElements.element.createElement(He,{to:`${ze}admin.php?page=acfw-loyalty-program&tab=customers&customer=${e}`},t.customer_name)},{title:a.activity,dataIndex:"activity",key:"activity",render:(e,t)=>[e,t.notes?acfwpElements.element.createElement(Ge,{placement:"top",content:t.notes,trigger:"click",overlayClassName:"lpfwp-popover-wrapper"},acfwpElements.element.createElement($e,{style:{paddingLeft:"5px"}})):null]},{title:a.points,dataIndex:"points",key:"points",render:(e,t)=>`${ke(t)}${e}`},{title:a.related,dataIndex:"rel_label",key:"rel_label",render:(e,t)=>t.rel_link?acfwpElements.element.createElement("a",{href:t.rel_link,target:"_blank"},e):e}];return acfwpElements.element.createElement(Le,{className:"lpfw-dashboard-history",title:a.points_history,extra:acfwpElements.element.createElement("div",{className:"lpfw-dashboard-period-selector"},acfwpElements.element.createElement(Ue,{value:r,onSelect:e=>{switch(c(e),e){case"week_to_date":m(moment().startOf("week")),d(moment().startOf("day"));break;case"month_to_date":m(moment().startOf("month")),d(moment().startOf("day"));break;case"quarter_to_date":m(moment().startOf("quarter")),d(moment().startOf("day"));break;case"year_to_date":m(moment().startOf("year")),d(moment().startOf("day"));break;case"last_week":m(moment().subtract(1,"weeks").startOf("week")),d(moment().subtract(1,"weeks").endOf("week"));break;case"last_month":m(moment().subtract(1,"months").startOf("month")),d(moment().subtract(1,"months").endOf("month"));break;case"last_quarter":m(moment().subtract(1,"quarters").startOf("quarter")),d(moment().subtract(1,"quarters").endOf("quarter"));break;case"last_year":m(moment().subtract(1,"years").startOf("year")),d(moment().subtract(1,"years").endOf("year"))}}},l.map((e=>acfwpElements.element.createElement(Ue.Option,{value:e.value},e.label)))),acfwpElements.element.createElement(Me.RangePicker,{value:[i,p],onChange:e=>{m(e[0]),d(e[1]),c("custom")}}))},acfwpElements.element.createElement(Ye,{loading:E,pagination:!1,dataSource:t,columns:y}),u>10&&acfwpElements.element.createElement(Ve,{disabled:E,current:s,total:u,onChange:o,showSizeChanger:!1}))})),{element:{Fragment:Qe,useEffect:We},redux:{bindActionCreators:Ke,connect:Xe},antd:{Row:Ze,Col:et,Card:tt}}=acfwpElements,{readDashboardData:nt}=a,at=Xe((e=>({dashboard:e.dashboard})),(e=>({actions:Ke({readDashboardData:nt},e)})))((e=>{const{dashboard:t,actions:n}=e,{loyalty_program:{labels:{points_status:a,points_sources:l,top_customers:s,points_history:o}}}=acfwAdminApp;return We((()=>{t||n.readDashboardData({})}),[]),acfwpElements.element.createElement(Qe,null,acfwpElements.element.createElement(Ze,{className:"lpfw-dashboard",gutter:20},acfwpElements.element.createElement(et,{span:8},acfwpElements.element.createElement(tt,{title:a},acfwpElements.element.createElement(we,null))),acfwpElements.element.createElement(et,{span:8},acfwpElements.element.createElement(tt,{title:l},acfwpElements.element.createElement(Te,null))),acfwpElements.element.createElement(et,{span:8},acfwpElements.element.createElement(tt,{title:s},acfwpElements.element.createElement(Ae,null))),acfwpElements.element.createElement(et,{span:24},acfwpElements.element.createElement(Je,null))))})),{element:{useState:lt,useEffect:st,useContext:ot,Fragment:rt},antd:{Card:ct,Table:it,Pagination:mt,Input:pt,Button:dt},antdIcons:{ReloadOutlined:ut},redux:{bindActionCreators:ft,connect:Et},router:{useHistory:wt},pathPrefix:yt}=acfwpElements,gt=e=>{const{text:t,customer:n,readSingleCustomerPoints:a}=e,[l,s]=lt(!1),[o,r]=lt(!1);return acfwpElements.element.createElement("div",{className:"reload-points-btn-wrap",onMouseEnter:()=>s(!0),onMouseLeave:()=>s(!1)},acfwpElements.element.createElement("span",{className:"points-value"},t),acfwpElements.element.createElement(dt,{className:l||o?"show":"hide",size:"small",icon:acfwpElements.element.createElement(ut,null),type:"text",shape:"circle",loading:o,onClick:e=>{r(!0),a({id:n.id,alwaysCB:()=>r(!1)})}}))},{element:{useState:St,Fragment:_t},antd:{Modal:ht,Button:Tt,message:vt}}=acfwpElements,bt=e=>{var t,n,a,l;const{customer_list_page:{rest_url:s,labels:o,nonce:r},adminUrl:c}=lpfwAdminApp,{customer:i}=e,[m,p]=St(!1),[d,u]=St(!1),[f,E]=vt.useMessage(),w=()=>{const e=new URLSearchParams;e.append("action","lpfw_loyalty_point_reminder_preview_email"),null!=i&&i.id&&e.append("args[user_id]",null==i?void 0:i.id),null!=i&&i.email&&e.append("args[email]",null==i?void 0:i.email);const t=`${null==i?void 0:i.first_name} ${null==i?void 0:i.last_name}`;return null!=i&&i.first_name&&null!=i&&i.last_name&&e.append("args[name]",t),e.append("_wpnonce",null==r?void 0:r.preview),`${c}admin-ajax.php?${e.toString()}`},y=()=>{u(!1),p(!1)};return null!=o&&o.remind?acfwpElements.element.createElement(_t,null,E,acfwpElements.element.createElement(Tt,{onClick:()=>{p(!0)}},o.remind),acfwpElements.element.createElement(ht,{title:null==o||null===(t=o.modal)||void 0===t?void 0:t.heading,className:"lpfw-modal send-a-reminder-modal",width:500,open:m,onCancel:()=>{p(!1)},footer:[acfwpElements.element.createElement(Tt,{key:"preview",className:"action-preview",onClick:()=>{p(!1),window.open(w())},"data-url":w()},null==o||null===(n=o.modal)||void 0===n||null===(n=n.button)||void 0===n?void 0:n.preview),acfwpElements.element.createElement(Tt,{key:"send",className:"action-send",type:"primary",onClick:()=>{u(!0),jQuery.ajax({type:"GET",url:s,data:{user_id:null==i?void 0:i.id},success:function(e){var t,n;e.status&&"error"!==e.status?f.open({type:"success",content:acfwpElements.element.createElement(_t,null,null==o||null===(t=o.modal)||void 0===t||null===(t=t.success)||void 0===t?void 0:t.text,null!=i&&i.email?` <${null==i?void 0:i.email}>.`:"")}):f.open({type:"error",content:`${null==o||null===(n=o.modal)||void 0===n||null===(n=n.error)||void 0===n?void 0:n.heading}: ${null==e?void 0:e.error_msg}`}),y()},error:function(e,t,n){var a,l;null!=e&&null!==(a=e.responseJSON)&&void 0!==a&&a.message&&(n=e.responseJSON.message),f.open({type:"error",content:`${null==o||null===(l=o.modal)||void 0===l||null===(l=l.error)||void 0===l?void 0:l.heading}: ${n}`}),y()}})},disabled:d},d?`${null==o?void 0:o.loading}...`:null==o||null===(a=o.modal)||void 0===a||null===(a=a.button)||void 0===a?void 0:a.send)]},acfwpElements.element.createElement("p",null,null==o||null===(l=o.modal)||void 0===l?void 0:l.text),acfwpElements.element.createElement("p",null,null==i?void 0:i.first_name," ",null==i?void 0:i.last_name,null!=i&&i.email?` <${null==i?void 0:i.email}>`:""))):null},{element:{useState:Ct,useEffect:xt,useContext:Rt,Fragment:It},antd:{Card:At,Table:Ot,Pagination:Dt,Input:Nt,Button:kt},redux:{bindActionCreators:Bt,connect:Pt},router:{useHistory:Ht},pathPrefix:Lt}=acfwpElements,{readCustomers:Ut,readSingleCustomerPoints:Mt}=f,Yt=Pt((e=>({customers:e.customers})),(e=>({actions:Bt({readCustomers:Ut,readSingleCustomerPoints:Mt},e)})))((e=>{var t;const{customers:n,actions:a}=e,{loyalty_program:{labels:l}}=acfwAdminApp,{customer_list_page:s}=lpfwAdminApp,{params:o,dispatchParams:r}=Rt(ie),[c,i]=Ct(!1),[m,p]=Ct(0),[d,u]=Ct(o.search),[f,E]=Ct(null),w=Ht(),y=[{title:l.customer_name,dataIndex:"name",key:"name"},{title:l.email,dataIndex:"email",key:"email"},{title:l.points,dataIndex:"points",key:"points",render:(e,t)=>acfwpElements.element.createElement(gt,{text:e,customer:t,readSingleCustomerPoints:a.readSingleCustomerPoints})},{title:l.points_expiry,dataIndex:"expiry",key:"expiry"},{dataIndex:"id",key:"id",render:(e,t)=>acfwpElements.element.createElement(It,null,acfwpElements.element.createElement(kt,{onClick:()=>g(t)},s.labels.view_stats),acfwpElements.element.createElement(bt,{customer:t}))}],g=e=>{w.push(`${Lt}admin.php?page=acfw-loyalty-program&tab=customers&customer=${e.id}`)};return xt((()=>{i(!0),a.readCustomers({params:o,successCB:e=>{p(e.headers["x-total"]),i(!1)}})}),[o]),acfwpElements.element.createElement(At,{title:"Customers List",className:"lpfw-customers-list"},acfwpElements.element.createElement("div",{className:"customer-search"},acfwpElements.element.createElement("label",null,l.search_customers),acfwpElements.element.createElement(Nt.Search,{allowClear:!0,value:d,onChange:e=>{return t=e.target.value,u(t),f&&clearTimeout(f),void E(setTimeout((()=>r({type:"SET_SEARCH",value:t})),1e3));var t},placeholder:l.name_or_email})),acfwpElements.element.createElement(Ot,{className:"customers-list-table",loading:c,pagination:!1,dataSource:n,columns:y}),0<m&&acfwpElements.element.createElement(Dt,{defaultContent:o.page,current:o.page,hideOnSinglePage:!0,disabled:c,total:m,pageSize:null!==(t=o.per_page)&&void 0!==t?t:10,showSizeChanger:!1,onChange:e=>{r({type:"SET_PAGE",value:e})}}))})),{element:{useState:Vt,useRef:Gt},antd:{Card:$t,Form:jt,Space:Ft,Input:zt,Select:qt,Button:Jt,Popconfirm:Qt,message:Wt},antdIcons:{QuestionCircleOutlined:Kt},redux:{bindActionCreators:Xt,connect:Zt}}=acfwpElements,{adjustCustomerPoints:en,setStoreCustomerStatus:tn,setStoreCustomerSources:nn}=f,an=Zt(null,(e=>({actions:Xt({adjustCustomerPoints:en,setStoreCustomerStatus:tn,setStoreCustomerSources:nn},e)})))((e=>{const{customer:t,actions:n}=e,{loyalty_program:{labels:a}}=acfwAdminApp,[l]=jt.useForm(),[s,o]=Vt(!1),[r,c]=Vt(!1),[i,m]=Vt(null),[p,d]=Vt(!1),u=Gt(null);return acfwpElements.element.createElement($t,{className:"adjust-points-card",title:a.adjust_points},acfwpElements.element.createElement("h4",null,a.adjust_for_user),acfwpElements.element.createElement(jt,{form:l,initialValues:{type:"increase",points:0,notes:null},onFinish:({type:e,points:a,notes:s})=>{c(!1),o(!0),n.adjustCustomerPoints({id:t.id,type:e,points:a,notes:s,successCB:e=>{Wt.success(e.data.message),n.setStoreCustomerStatus({id:t.id,data:e.data.status}),n.setStoreCustomerSources({id:t.id,data:e.data.sources})},failCB:({error:e})=>{Wt.error(e.response.data.message)},alwaysCB:()=>{l.resetFields(),m(null),o(!1)}})}},acfwpElements.element.createElement(Ft,{direction:"vertical"},acfwpElements.element.createElement(Ft,{direction:"horizontal"},acfwpElements.element.createElement(jt.Item,{name:"type",style:{marginBottom:"10px"}},acfwpElements.element.createElement(qt,{onChange:e=>{const n=null!=t&&t.status?null==t?void 0:t.status[1].points:0,a="decrease"===l.getFieldValue("type")?n:null;m(a)}},acfwpElements.element.createElement(qt.Option,{value:"increase"},a.increase_points),acfwpElements.element.createElement(qt.Option,{value:"decrease"},a.decrease_points))),acfwpElements.element.createElement(jt.Item,{name:"points",style:{marginBottom:"10px"}},acfwpElements.element.createElement(zt,{type:"number",placeholder:"points",min:0,max:i})),acfwpElements.element.createElement(jt.Item,{style:{marginBottom:"10px"}},acfwpElements.element.createElement(Qt,{visible:r,title:()=>a.adjust_confirm.replace("{type}","increase"===l.getFieldValue("type")?a.uc_increase:a.uc_decrease).replace("{points}",l.getFieldValue("points")),icon:acfwpElements.element.createElement(Kt,null),okText:a.proceed,cancelText:a.cancel,okButtonProps:{className:"confirm-adjust-points"},onConfirm:()=>l.submit(),onCancel:()=>{c(!1),l.resetFields()}},acfwpElements.element.createElement(Jt,{type:"primary",htmlType:"button",loading:s,onClick:()=>{const e=l.getFieldValue("points");!e||e<1?Wt.error(a.invalid_points):i&&e>i?Wt.error(a.invalid_maxpoints.replace("{maxpoints}",i)):c(!0)}},a.adjust)))),acfwpElements.element.createElement(Ft.Compact,{direction:"vertical"},acfwpElements.element.createElement("a",{onClick:()=>{d(!p),p||l.setFieldsValue({notes:null}),setTimeout((()=>u.current.focus({cursor:"start"})),400)},style:{marginBottom:"0px"}},"Add note"),p?acfwpElements.element.createElement(jt.Item,{name:"notes"},acfwpElements.element.createElement(zt.TextArea,{ref:u,rows:2,style:{minWidth:"520px"},placeholder:a.notes,maxLength:255})):null))))})),{element:{useState:ln,useEffect:sn},antd:{Card:on,Table:rn}}=acfwpElements,cn=e=>{const{customer:{status:t}}=e,{loyalty_program:{labels:n}}=acfwAdminApp,{points_status:a,information:l,points:s,value:o}=n,[r,c]=ln(!0),i=[{title:l,dataIndex:"label",key:"label"},{title:s,dataIndex:"points",key:"points"},{title:o,dataIndex:"value",key:"value"}];return sn((()=>{t&&t.length?c(!1):c(!0)}),[t,c]),acfwpElements.element.createElement(on,{className:"customer-points-status",title:a},acfwpElements.element.createElement(rn,{loading:r,pagination:!1,dataSource:t,columns:i}))},{element:{useState:mn,useEffect:pn},antd:{Card:dn,Table:un}}=acfwpElements,fn=e=>{const{customer:{sources:t}}=e,{loyalty_program:{labels:n}}=acfwAdminApp,[a,l]=mn(!0),s=[{title:n.source,dataIndex:"label",key:"label"},{title:n.points,dataIndex:"points",key:"points"}];return pn((()=>{t&&t.length?l(!1):l(!0)}),[t,l]),acfwpElements.element.createElement(dn,{className:"customer-points-sources",title:n.points_sources},acfwpElements.element.createElement(un,{loading:a,pagination:!1,dataSource:t,columns:s}))},{element:{useState:En,useEffect:wn},antd:{Card:yn,Table:gn,Pagination:Sn,Popover:_n},antdIcons:{FileTextOutlined:hn},redux:{bindActionCreators:Tn,connect:vn}}=acfwpElements,{readCustomerHistory:bn,setStoreHIstoryEntries:Cn}=f,xn=vn(null,(e=>({actions:Tn({readCustomerHistory:bn,setStoreHIstoryEntries:Cn},e)})))((e=>{var t;const{customer:n,actions:a}=e,l=null!==(t=null==n?void 0:n.history)&&void 0!==t?t:[],{loyalty_program:{labels:s}}=acfwAdminApp,[o,r]=En(!0),[c,i]=En(1),[m,p]=En(0),d=null!=n&&n.status?null==n?void 0:n.status[1].points:-1,u=[{title:s.date,dataIndex:"date",key:"date"},{title:s.activity,dataIndex:"activity",key:"activity",render:(e,t)=>[e,t.notes?acfwpElements.element.createElement(_n,{placement:"top",content:t.notes,trigger:"click",overlayClassName:"lpfwp-popover-wrapper"},acfwpElements.element.createElement(hn,{style:{paddingLeft:"5px"}})):null]},{title:s.points,dataIndex:"points",key:"points",render:(e,t)=>`${ke(t)}${e}`},{title:s.related,dataIndex:"rel_label",key:"rel_label",render:(e,t)=>t.rel_link?acfwpElements.element.createElement("a",{href:t.rel_link,target:"_blank"},e):e}],f=e=>{null!=n&&n.id&&(r(!0),i(e),a.readCustomerHistory({id:n.id,page:e,successCB:t=>{1===e&&p(t.headers["x-total"]),r(!1)}}))};return wn((()=>{r(!0)}),[null==n?void 0:n.id]),wn((()=>{null!=n&&n.id&&f(c)}),[d]),acfwpElements.element.createElement(yn,{title:s.points_history},acfwpElements.element.createElement(gn,{loading:o,pagination:!1,dataSource:l,columns:u}),m?acfwpElements.element.createElement(Sn,{defaultCurrent:c,hideOnSinglePage:!0,disabled:o,current:c,total:m,pageSize:10,showSizeChanger:!1,onChange:f}):null)})),{element:{Fragment:Rn,useEffect:In},redux:{bindActionCreators:An,connect:On},antd:{Descriptions:Dn,Row:Nn,Col:kn,Skeleton:Bn,Button:Pn},antdIcons:{LeftOutlined:Hn},router:{useHistory:Ln}}=acfwpElements,{readSingleCustomer:Un,readCustomerStatus:Mn,readCustomerHistory:Yn}=f,Vn=On((e=>({customers:e.customers})),(e=>({actions:An({readSingleCustomer:Un,readCustomerStatus:Mn,readCustomerHistory:Yn},e)})))((e=>{var t;const{customerID:n,customers:a,actions:l}=e,{loyalty_program:{labels:s}}=acfwAdminApp,o=a.findIndex((e=>e.id===n)),r=null!==(t=a[o])&&void 0!==t?t:null,c=Ln();return In((()=>{r&&r.id?(l.readCustomerStatus({id:r.id}),l.readCustomerHistory({id:r.id})):l.readSingleCustomer({id:n,successCB:()=>{l.readCustomerStatus({id:n}),l.readCustomerHistory({id:n})}})}),[]),acfwpElements.element.createElement("div",{className:"lpfw-single-customer"},acfwpElements.element.createElement(Pn,{className:"go-back-customers",icon:acfwpElements.element.createElement(Hn,null),onClick:()=>{c.goBack()}},"Go back"),r?acfwpElements.element.createElement(Rn,null,acfwpElements.element.createElement(Dn,{title:s.customer_info,bordered:!0},acfwpElements.element.createElement(Dn.Item,{label:s.customer_name},r.name),acfwpElements.element.createElement(Dn.Item,{label:s.email},r.email)),acfwpElements.element.createElement(an,{customer:r}),acfwpElements.element.createElement(Nn,{gutter:16},acfwpElements.element.createElement(kn,{span:12},acfwpElements.element.createElement(cn,{customer:r})),acfwpElements.element.createElement(kn,{span:12},acfwpElements.element.createElement(fn,{customer:r}))),acfwpElements.element.createElement(xn,{customer:r})):acfwpElements.element.createElement(Bn,null))})),{router:{useLocation:Gn}}=acfwpElements,$n=()=>{const e=new URLSearchParams(Gn().search).get("customer");return e?acfwpElements.element.createElement(Vn,{customerID:parseInt(e)}):acfwpElements.element.createElement(Yt,null)},{element:{useEffect:jn,useState:Fn},antdIcons:{SettingOutlined:zn,DollarCircleOutlined:qn,TrophyOutlined:Jn,UserOutlined:Qn,MailOutlined:Wn,MedicineBoxOutlined:Kn,InfoCircleOutlined:Xn,ToolOutlined:Zn}}=acfwpElements,ea=e=>{const{section:t}=e;switch(t){case"general":return acfwpElements.element.createElement(zn,null);case"emails":return acfwpElements.element.createElement(Wn,null);case"points_earning":return acfwpElements.element.createElement(qn,null);case"messages":return acfwpElements.element.createElement(Xn,null);case"redemption_expiry":return acfwpElements.element.createElement(Jn,null);case"restrictions":return acfwpElements.element.createElement(Qn,null);case"help":return acfwpElements.element.createElement(Kn,null);case"advanced_tools":return acfwpElements.element.createElement(Zn,null)}return null},{element:{useEffect:ta,useState:na},router:{Link:aa},redux:{bindActionCreators:la,connect:sa},antd:{Skeleton:oa,Menu:ra},pathPrefix:ca}=acfwpElements,ia=sa((e=>({sections:e.settingSections})),(e=>({actions:la({},e)})))((e=>{const{sections:t,currentSection:n}=e,a=n||"general";return t.length<1?acfwpElements.element.createElement("div",{className:"settings-nav-skeleton"},acfwpElements.element.createElement(oa,{active:!0,paragraph:!1}),acfwpElements.element.createElement(oa,{active:!0,paragraph:!1}),acfwpElements.element.createElement(oa,{active:!0,paragraph:!1}),acfwpElements.element.createElement(oa,{active:!0,paragraph:!1}),acfwpElements.element.createElement(oa,{active:!0,paragraph:!1})):acfwpElements.element.createElement(ra,{className:"acfw-settings-nav",defaultSelectedKeys:[a]},t.map((({id:e,title:t})=>acfwpElements.element.createElement(ra.Item,{key:e},acfwpElements.element.createElement(aa,{to:`${ca}admin.php?page=acfw-loyalty-program&tab=settings&section=${e}`},acfwpElements.element.createElement(ea,{section:e}),t)))))})),{antd:{Input:ma}}=acfwpElements,pa={conditions:["text","url","permalink"],component:e=>{const{field:t,value:n}=e,{id:a,type:l,placeholder:s,default:o}=t,r=void 0!==n&&!1!==n?n:o;return acfwpElements.element.createElement(ma,{key:a,type:"permalink"===l?"text":l,name:a,placeholder:s,defaultValue:r,onChange:t=>{let n=t.target.value;e.handleValueChange({inputValue:n,needTimeout:!0})}})}},{antd:{Input:da}}=acfwpElements,ua={conditions:["price"],component:e=>{const{field:t,value:n}=e,{id:a,placeholder:l,default:s,format:o}=t,{currencySymbol:r}=lpfwAdminApp,c=void 0!==n&&!1!==n?n:s;return acfwpElements.element.createElement(da,{addonBefore:r,type:"text",className:"wc_input_price",name:a,placeholder:l,defaultValue:c,onChange:t=>{let n=t.target.value;e.handleValueChange({inputValue:n,needTimeout:!0})}})}},{antd:{TimePicker:fa},moment:Ea}=acfwpElements,wa={conditions:["timepicker"],component:e=>{const{field:t,value:n}=e,{id:a,default:l,format:s}=t,o=void 0!==n&&!1!==n?n:l;let r=s||"HH:mm:ss";return acfwpElements.element.createElement(fa,{key:a,format:r,defaultValue:(e=>{let n=e||t.default;return n=n||"00:00:00",n=Ea(n,r),n})(o),onChange:t=>{let n=t.format("HH:mm:ss");e.handleValueChange({inputValue:n,needTimeout:!0})}})}},{antd:{Select:ya}}=acfwpElements,ga={conditions:["multiselect"],component:e=>{const{field:t,value:n}=e,{id:a,options:l,placeholder:s,default:o}=t,r=void 0!==n&&!1!==n?n:o;let c=l||[];return c=c.map((e=>e.label.label?e.label:{value:e.key,label:e.label})),acfwpElements.element.createElement(ya,{key:a,mode:"multiple",defaultValue:r,style:{width:"100%"},placeholder:s,options:c,onChange:t=>{e.handleValueChange({inputValue:t,needTimeout:!0})}})}},{element:{useMemo:Sa,useRef:_a,useState:ha},antd:{Select:Ta,Spin:va}}=acfwpElements,ba={conditions:["debounceselect"],component({fetchOptions:e,debounceTimeout:t=800,...n}){const[a,l]=ha(!1),[s,o]=ha([]),r=_a(0),c=Sa((()=>window.lodash.debounce((t=>{if(t.length<3)return void o([]);r.current+=1;const n=r.current;o([]),l(!0),e(t).then((e=>{n===r.current&&(o(e),l(!1))}))}),t)),[e,t]);return acfwpElements.element.createElement(Ta,{labelInValue:!0,filterOption:!1,onSearch:c,notFoundContent:a?acfwpElements.element.createElement(va,{size:"small"}):null,...n,options:s})}},{element:{useState:Ca}}=acfwpElements;async function xa(e){const{root:t,nonce:n}=wpApiSettings,a=new URLSearchParams({context:"edit",search:e,_wpnonce:n});return fetch(`${t}wp/v2/users?${a}`).then((e=>e.json())).then((e=>e.map((e=>({value:e.id,label:e.name}))))).catch((e=>{console.error("Error fetching user:",e)}))}const Ra={conditions:["multiuser"],component:e=>{const{field:t,value:n}=e,{default:a}=t,[l,s]=Ca(void 0!==n?n:a),o=ba.component;return acfwpElements.element.createElement(o,{mode:"multiple",value:l,placeholder:"Select users",fetchOptions:xa,onChange:t=>{s(t),e.handleValueChange({inputValue:t,needTimeout:!0})},style:{width:"100%"}})}},{antd:{Input:Ia}}=acfwpElements,Aa={conditions:["number"],component:e=>{const{field:t,value:n}=e,{id:a,type:l,placeholder:s,default:o}=t,r=void 0!==n&&!1!==n?n:o;return acfwpElements.element.createElement(Ia,{key:a,type:l,name:a,placeholder:s,defaultValue:r,min:null==t?void 0:t.min,max:null==t?void 0:t.max,step:null==t?void 0:t.step,suffix:null==t?void 0:t.suffix,onChange:t=>{let n=t.target.value;e.handleValueChange({inputValue:n,needTimeout:!0})}})}},{antd:{Select:Oa}}=acfwpElements,Da={conditions:["select"],component:e=>{var t;const{field:n,value:a}=e,{id:l,options:s,placeholder:o,default:r}=n,c=void 0!==a&&!1!==a?a:r;let i=s||[];return i=i.map((e=>e.label.label?e.label:{value:e.key,label:e.label})),acfwpElements.element.createElement(Oa,{key:l,defaultValue:c||null,style:{width:"50%"},placeholder:o,allowClear:null===(t=null==n?void 0:n.allow_clear)||void 0===t||t,options:i,onSelect:t=>{e.handleValueChange({inputValue:t})},onClear:t=>{e.handleValueChange({inputValue:null})}})}},{antd:{Switch:Na}}=acfwpElements,ka={conditions:["checkbox","module"],component:e=>{const{field:t,value:n}=e,{id:a,default:l}=t,s=void 0!==n&&!1!==n?n:l;return acfwpElements.element.createElement(Na,{key:a,checked:"yes"===s,defaultChecked:"yes"===s,onChange:t=>{let n=t?"yes":"";e.handleValueChange({inputValue:n})}})}},{antd:{Input:Ba}}=acfwpElements,Pa={conditions:["textarea"],component:e=>{const{field:t,value:n}=e,{id:a,placeholder:l,default:s}=t,o=void 0!==n&&!1!==n?n:s;return acfwpElements.element.createElement(Ba.TextArea,{key:a,rows:3,placeholder:l,defaultValue:o,onChange:t=>{let n=t.target.value;e.handleValueChange({inputValue:n,needTimeout:!0})}})}},{element:{useEffect:Ha},redux:{bindActionCreators:La,connect:Ua},antd:{Switch:Ma,Typography:Ya}}=acfwpElements,{Text:Va}=Ya,{setStoreSettingItems:Ga}=m,$a=Ua(((e,t)=>{const{options:n}=t.field,a=n.map((e=>e.key));return{values:e.settingValues.filter((e=>a.includes(e.id)))}}),(e=>({actions:La({setStoreSettingItems:Ga},e)})))((e=>{const{field:{options:t},values:n,handleValueChange:a,actions:l}=e;Ha((()=>{if(n.length)return;const e=null==t?void 0:t.map((({key:e,value:t})=>({id:e,value:t})));e&&l.setStoreSettingItems({data:e})}),[]);const s=e=>{const{option:t}=e,{key:l,label:s}=t,o=n.findIndex((e=>e.id===l)),{value:r}=n[o];return acfwpElements.element.createElement("div",{className:"option"},acfwpElements.element.createElement(Ma,{checked:"yes"===r,defaultChecked:"yes"===r,onChange:e=>{a({inputValue:e?"yes":"no",needTimeout:!1,overrideId:l,overrideTitle:s})}}),acfwpElements.element.createElement(Va,null,s))};return n.length<1?null:acfwpElements.element.createElement("div",{className:"actions-earn-points-options"},null==t?void 0:t.map(((e,t)=>acfwpElements.element.createElement(s,{option:e,key:t}))))})),{element:{useEffect:ja,useReducer:Fa,useState:za,Fragment:qa},lodash:{isEqual:Ja},antd:{Table:Qa,Input:Wa,Text:Ka},antdIcons:{DeleteOutlined:Xa,PlusCircleOutlined:Za}}=acfwpElements;function el(e,t){const{type:n,payload:a}=t,l=[...e];switch(n){case"rehydrate":return a;case"delete_row":return l.splice(a,1),l;case"add_row":return l.splice(a+1,0,{amount:"",points:"",sanitized:0}),l;case"set_amount":{const{index:e,value:t}=a;return l[e]={...l[e],amount:t},l}case"set_points":{const{index:e,value:t}=a;return l[e]={...l[e],points:t},l}default:return e}}const tl=e=>{const{value:t,handleValueChange:n}=e,{loyalty_program:{labels:a}}=acfwAdminApp,{currencySymbol:l}=lpfwAdminApp,[s,o]=za(!1),[r,c]=Fa(el,[]);ja((()=>{const e="string"==typeof t?JSON.parse(t):t;o(!0),e&&e.length&&c({type:"rehydrate",payload:e})}),[]),ja((()=>{if(!s)return;const t=r.filter((({amount:e,points:t})=>e&&t)).sort(((e,t)=>{const n=Ne(e.amount),a=Ne(t.amount);return n<a?-1:n>a?1:0}));Ja(e.value,t)||n({inputValue:t,needTimeout:!0})}),[r]);const i=[{title:a.breakpoint,dataIndex:"amount",render:(e,t,n)=>acfwpElements.element.createElement(Wa,{addonBefore:l,type:"text",className:"wc_input_price",value:e,onChange:e=>c({type:"set_amount",payload:{index:n,value:e.target.value}})})},{title:a.points_earned,dataIndex:"points",render:(e,t,n)=>acfwpElements.element.createElement(Wa,{type:"number",value:e,min:1,onChange:e=>c({type:"set_points",payload:{index:n,value:e.target.value}})})},{title:"",dataIndex:"points",render:(e,t,n)=>acfwpElements.element.createElement("div",{className:"points-table-actions"},acfwpElements.element.createElement("button",{className:"delete",onClick:()=>c({type:"delete_row",payload:n})},acfwpElements.element.createElement(Xa,null)),acfwpElements.element.createElement("button",{className:"add"},acfwpElements.element.createElement(Za,{onClick:()=>c({type:"add_row",payload:n})})))}];return acfwpElements.element.createElement(Qa,{columns:i,dataSource:r.length?r:[{amount:"",points:"",sanitized:0}],pagination:!1,size:"small"})},{element:{Fragment:nl,useEffect:al,useReducer:ll,useState:sl},lodash:{isEqual:ol},antd:{Table:rl,DatePicker:cl,Input:il},antdIcons:{DeleteOutlined:ml,PlusCircleOutlined:pl},moment:dl}=acfwpElements,{RangePicker:ul}=cl;function fl(e,t){const{type:n,payload:a}=t,l=[...e];switch(n){case"rehydrate":return a;case"delete_row":return l.splice(a,1),l;case"add_row":return l.splice(a+1,0,{dateRange:null,points:""}),l;case"set_data":{const{index:e,value:t}=a;return l[e]={...t},l}default:return e}}const El=e=>{const{value:t,handleValueChange:n}=e,{loyalty_program:{labels:a}}=acfwAdminApp,[l,s]=sl(!1),[o,r]=ll(fl,[]);al((()=>{const e="string"==typeof t?JSON.parse(t):t;s(!0),e&&e.length&&r({type:"rehydrate",payload:e.map(c)})}),[]),al((()=>{if(!l)return;const t=o.sort(((e,t)=>{if(null!=e&&e.dateRange&&null!=t&&t.dateRange){var n,a;const l=null!==(n=null==e?void 0:e.dateRange[0].unix())&&void 0!==n?n:0,s=null!==(a=null==t?void 0:t.dateRange[0].unix())&&void 0!==a?a:0;if(l<s)return-1;if(l>s)return 1}return 0})).map(i).filter((e=>e.sdate&&e.stime&&e.edate&&e.etime&&e.points));ol(e.value,t)||n({inputValue:t,needTimeout:!0})}),[o]);const c=e=>{const{sdate:t,stime:n,edate:a,etime:l,points:s}=e;return{dateRange:[dl(`${t} ${n}`,"MM/DD/YYYY hh:mm a"),dl(`${a} ${l}`,"MM/DD/YYYY hh:mm a")],points:s}},i=e=>{var t,n,a,l;const{dateRange:s,points:o}=e,r=s?s[0]:null,c=s?s[1]:null;return{sdate:null!==(t=null==r?void 0:r.format("MM/DD/YYYY"))&&void 0!==t?t:"",stime:null!==(n=null==r?void 0:r.format("hh:mm a"))&&void 0!==n?n:"",edate:null!==(a=null==c?void 0:c.format("MM/DD/YYYY"))&&void 0!==a?a:"",etime:null!==(l=null==c?void 0:c.format("hh:mm a"))&&void 0!==l?l:"",points:o}},m=[{title:a.date_range,dataIndex:"dateRange",render:(e,t,n)=>acfwpElements.element.createElement(ul,{format:"YYYY/MM/DD hh:mm a",showTime:!0,value:e,onChange:e=>r({type:"set_data",payload:{index:n,value:{...t,dateRange:e}}})})},{title:a.points_earned,dataIndex:"points",render:(e,t,n)=>acfwpElements.element.createElement(il,{className:"points",type:"number",value:e,min:1,onChange:e=>r({type:"set_data",payload:{index:n,value:{...t,points:e.target.value}}})})},{title:"",dataIndex:"points",render:(e,t,n)=>acfwpElements.element.createElement("div",{className:"points-table-actions"},acfwpElements.element.createElement("button",{className:"delete",onClick:()=>r({type:"delete_row",payload:n})},acfwpElements.element.createElement(ml,null)),acfwpElements.element.createElement("button",{className:"add"},acfwpElements.element.createElement(pl,{onClick:()=>r({type:"add_row",payload:n})})))}];return acfwpElements.element.createElement(rl,{className:"order-points-table",columns:m,dataSource:o&&o.length?o:[{dateRange:null,points:""}],pagination:!1,size:"small"})},{antd:{Typography:wl,Switch:yl,Popover:gl},antdIcons:{QuestionCircleOutlined:Sl}}=acfwpElements,{Text:_l}=wl,hl=e=>{const{field:{options:t},value:n,handleValueChange:a}=e;return acfwpElements.element.createElement("div",{className:"point-calc-options"},t?t.map((({key:e,default:t,label:l,tooltip:s})=>acfwpElements.element.createElement("div",{className:"option",key:e},acfwpElements.element.createElement(yl,{checked:"yes"===n[e],defaultChecked:"yes"===t,onChange:t=>((e,t)=>{const l={...n};l[e]=t?"yes":"",a({inputValue:l,needTimeout:!0})})(e,t)}),acfwpElements.element.createElement(_l,null,l),acfwpElements.element.createElement(gl,{placement:"right",content:acfwpElements.element.createElement("div",{className:"setting-tooltip-content"},s),trigger:"click"},acfwpElements.element.createElement(Sl,null))))):null)},{element:{useState:Tl},antd:{Button:vl,message:bl}}=acfwpElements,Cl=e=>{const{field:t}=e,[n,a]=Tl(!1);return acfwpElements.element.createElement(vl,{type:"primary",loading:n,onClick:()=>{a(!0),jQuery.ajax({method:"post",url:ajaxurl,data:{action:t.id,nonce:null==t?void 0:t.nonce},dataType:"json"}).done((e=>{"success"===e.status?bl.success(e.message):"warning"===e.status?bl.warning(e.message):bl.error(e.error_msg)})).always((()=>{a(!1)}))}},t.title)},{element:{Fragment:xl,useState:Rl},antd:{message:Il},redux:{bindActionCreators:Al,connect:Ol},lodash:{defaults:Dl}}=acfwpElements,{updateSetting:Nl,setStoreSettingItem:kl}=m,{action_notices:Bl}=acfwAdminApp,Pl=new class{constructor(){this.types={input:pa,multiselect:ga,multiuser:Ra,number:Aa,price:ua,select:Da,switch:ka,textarea:Pa,timepicker:wa}}getComponent(e){for(const t in this.types){const{conditions:n,component:a}=this.types[t];if(n.includes(e))return a}return null}},Hl=new class{constructor(){this.types={actions_earn_points:$a,breakpoints:tl,order_period:El,points_calculation:hl,refetch_update_data:Cl}}getComponent(e){return this.types.hasOwnProperty(e)?this.types[e]:null}},Ll=Ol(((e,t)=>{const{id:n}=t.field,a=e.settingValues.findIndex((e=>e.id===n));return{value:a>-1?e.settingValues[a].value:""}}),(e=>({actions:Al({updateSetting:Nl,setStoreSettingItem:kl},e)})))((e=>{const{field:t,showSpinner:n,setShowSpinner:a,validateInput:l,value:s,actions:o}=e,{id:r,type:c,default:i}=t,[m,p]=Rl(null),d=void 0!==s&&!1!==s?s:i,u=e=>{const{inputValue:s,needTimeout:i,overrideId:d,overrideTitle:u}=Dl(e,{needTimeout:!1,overrideID:"",overrideTitle:""}),f=d||r,E=u||t.title;o.setStoreSettingItem({data:{id:f,value:s}}),n&&((e=>{const t=k.get(e);t&&(t(),k.delete(e))})(f),i&&a(!1));const w=()=>{l(s)&&o.updateSetting({data:{id:f,value:["breakpoints","order_period"].indexOf(c)>-1?JSON.stringify(s):s,type:c},processingCB:()=>a(!0),successCB:()=>{Il.success(acfwpElements.element.createElement(xl,null,acfwpElements.element.createElement("strong",null,E)," ",Bl.success)),a(!1)},failCB:()=>{Il.error(acfwpElements.element.createElement(xl,null,acfwpElements.element.createElement("strong",null,E)," ",Bl.fail)),a(!1)}})};i?(m&&(clearTimeout(m),p(null)),p(setTimeout(w,1e3))):w()},f=Pl.getComponent(c);if(f)return acfwpElements.element.createElement(f,{...e,handleValueChange:u});const E=Hl.getComponent(c);if(E){let e={field:t,value:d,handleValueChange:u};return acfwpElements.element.createElement(E,{...e})}return null})),{element:{useState:Ul},antd:{Typography:Ml,Spin:Yl,Row:Vl,Col:Gl,Divider:$l,Popover:jl},antdIcons:{QuestionCircleOutlined:Fl,LoadingOutlined:zl}}=acfwpElements,{Text:ql}=Ml,Jl=e=>{const{field:t,order:n}=e,{id:a,title:l,type:s,desc:o,desc_tip:r}=t,{validation:c}=acfwAdminApp,[i,m]=Ul(!1),[p,d]=Ul(!1),u=r?acfwpElements.element.createElement("div",{className:"setting-tooltip-content"},r):null;return"title"===s?acfwpElements.element.createElement("div",{className:"form-heading"},acfwpElements.element.createElement("h1",null,l),acfwpElements.element.createElement("p",null,o)):"subtitle"===s?acfwpElements.element.createElement("div",{className:"form-heading "+(n>0?"spacer":"")},acfwpElements.element.createElement("h3",null,l),acfwpElements.element.createElement("p",null,o)):acfwpElements.element.createElement(Vl,{gutter:16,className:"form-control",id:`${a}_field`,key:a},n>0?acfwpElements.element.createElement($l,null):null,acfwpElements.element.createElement(Gl,{span:8},acfwpElements.element.createElement("label",{className:"lpfw-setting-field-label"},acfwpElements.element.createElement("strong",null,l)),r?acfwpElements.element.createElement(jl,{placement:"right",content:u,trigger:"click"},acfwpElements.element.createElement(Fl,{className:"setting-tooltip-icon"})):null),acfwpElements.element.createElement(Gl,{className:"setting-field-column",span:16},acfwpElements.element.createElement(Ll,{field:t,showSpinner:i,setShowSpinner:m,validateInput:e=>{let n=function(e,t,n){var a;let l=!0;switch(t){case"number":const t=null!==(a=null==n?void 0:n.min)&&void 0!==a?a:0;l=""===e||parseInt(e)>=t;break;case"url":l=e&&Oe(e+"");break;case"price":l=e&&De(e+"");break;case"breakpoints":l=e.reduce(((e,{amount:t})=>De(t)&&e),!0);break;case"order_period":l=e.reduce(((e,{points:t})=>parseInt(t)>0&&e),!0)}return l}(e,s,t);return d(!n),n}}),i?acfwpElements.element.createElement(Yl,{indicator:acfwpElements.element.createElement(zl,{style:{fontSize:24},spin:!0})}):null,acfwpElements.element.createElement("div",{className:"invalid-input"+(p?" show":"")},p?acfwpElements.element.createElement(ql,{type:"danger"},c[s]?c[s]:c.default):null),o?acfwpElements.element.createElement("p",{className:"field-desc",dangerouslySetInnerHTML:{__html:o}}):null))},{element:{useEffect:Ql},redux:{bindActionCreators:Wl,connect:Kl},lodash:Xl}=acfwpElements,Zl=Kl(((e,t)=>{var n,a,l;const{toggle:s}=t.field,o=e.settingValues.findIndex((e=>e.id===s)),r=o>=0?e.settingValues[o]:null;let c=null!==(n=null==r?void 0:r.value)&&void 0!==n?n:null;const i=null!==(a=null===(l=t.field)||void 0===l?void 0:l.toggleValue)&&void 0!==a?a:"yes";var m,p;return Xl.isNull(c)&&(c=null!==(m=null===(p=t.field)||void 0===p?void 0:p.default)&&void 0!==m?m:c),{show:c===i}}),(e=>({actions:Wl({},e)})))((e=>{const{field:t,show:n,order:a}=e;return n?acfwpElements.element.createElement(Jl,{field:t,order:a}):null})),{element:{useState:es,useEffect:ts,useMemo:ns},antd:{Row:as,Col:ls,Checkbox:ss,Select:os,Popover:rs,Button:cs,Progress:is,message:ms,Descriptions:ps},antdIcons:{QuestionCircleOutlined:ds},axiosInstance:us}=acfwpElements,fs=e=>{var t;const{field:n}=e,{id:a,title:l,desc:s,desc_tip:o,placeholder:r,options:c,data:i,labels:m}=n,[p,d]=es(null!==(t=null==i?void 0:i.plugin)&&void 0!==t?t:null),[u,f]=es(!i||(null==i?void 0:i.deactivate)),[E,w]=es(!(null==i||!i.plugin)),[y,g]=es(!1),[S,_]=es(0),[h,T]=es({total:0,imported:0,failed:0}),[v,b]=es(0),C=o?acfwpElements.element.createElement("div",{className:"setting-tooltip-content"},o):null,x=ns((()=>{if(null==c||!c.length||!p)return"";const e=null==c?void 0:c.findIndex((e=>e.key.toString()===p));return c[e].label}),[p]),R=e=>{d(e),g(!1)},I=()=>{us.get("loyalty-program/v1/tools/import_points",{params:{plugin:p}}).then((e=>{const{data:t}=e.data,n=100-t.pending/t.total*100;if(_(parseInt(n.toString())),t.pending>0)return void setTimeout((()=>I()),2e3);const{summary:a,total_points:l}=e.data;w(!1),T(a),b(l),g(!0),ms.success(e.data.message)})).catch((e=>{ms.error(e.response.data.message),w(!1)}))};return ts((()=>{null!=i&&i.plugin&&I()}),[]),acfwpElements.element.createElement(as,{gutter:16,className:"form-control",id:`${a}_field`,key:a},acfwpElements.element.createElement(ls,{span:8},acfwpElements.element.createElement("label",{className:"lpfw-setting-field-label tool-field-label"},acfwpElements.element.createElement("strong",null,l)),o?acfwpElements.element.createElement(rs,{placement:"right",content:C,trigger:"click"},acfwpElements.element.createElement(ds,{className:"setting-tooltip-icon"})):null),acfwpElements.element.createElement(ls,{className:"setting-field-column tool-field-column",span:16},s?acfwpElements.element.createElement("p",{className:"field-desc",dangerouslySetInnerHTML:{__html:s}}):null,acfwpElements.element.createElement("div",{className:"import-points-form-wrapper"},acfwpElements.element.createElement(os,{style:{width:"100%"},placeholder:r,allowClear:!0,value:p,disabled:E,onSelect:e=>R(e),onClear:()=>R(null)},(null==c?void 0:c.length)&&(null==c?void 0:c.map((({key:e,label:t})=>acfwpElements.element.createElement(os.Option,{key:e.toString(),value:e.toString()},t))))),acfwpElements.element.createElement(ss,{className:"deactivate-plugin-checkbox",checked:u,disabled:E,onChange:e=>f(e.target.checked)},m.deactivate_plugin),acfwpElements.element.createElement(cs,{type:"primary",disabled:!p||y,loading:E,onClick:()=>(w(!0),void us.post("loyalty-program/v1/tools/import_points",{plugin:p,deactivate:u}).then((()=>I())).catch((e=>{ms.error(e.response.data.message),w(!1)})))},m.import_btn)),(E||y)&&acfwpElements.element.createElement("div",{className:"import-points-progress-wrapper"},acfwpElements.element.createElement("p",{dangerouslySetInnerHTML:{__html:m.progress_text.replace("%s",`<strong>${x}</strong>`)}}),acfwpElements.element.createElement(is,{percent:S,status:100>S?"active":"",strokeColor:{from:"#108ee9",to:"#87d068"}}),y&&acfwpElements.element.createElement(ps,{column:1,bordered:!0,size:"small"},acfwpElements.element.createElement(ps.Item,{label:m.processed},h.imported.toLocaleString()," ",m.users),acfwpElements.element.createElement(ps.Item,{label:m.failed},h.failed.toLocaleString()," ",m.users),acfwpElements.element.createElement(ps.Item,{label:m.total_imported_points},v.toLocaleString()," ",m.points)))))},Es=e=>{const{field:t,order:n}=e;return"import_loyalty_points"===t.id?acfwpElements.element.createElement(fs,{field:t,order:n}):null!=t&&t.toggle?acfwpElements.element.createElement(Zl,{field:t,order:n}):acfwpElements.element.createElement(Jl,{field:t,order:n})},{element:{Fragment:ws},antd:{Skeleton:ys,Divider:gs},redux:{bindActionCreators:Ss,connect:_s}}=acfwpElements,hs=_s((e=>({sections:e.settingSections,settingValues:e.settingValues})),(e=>({actions:Ss({},e)})))((e=>{const{sections:t,settingValues:n,currentSection:a}=e,l=a?t.findIndex((e=>e.id===a)):0,s=t.length?t[l].id:"",o=t.length?t[l].fields:[];if(o.length<1||n.length<1){const e=[0,1,2];return acfwpElements.element.createElement(ws,null,acfwpElements.element.createElement(ys,{loading:!0,active:!0,paragraph:{rows:1}}),e.map((e=>acfwpElements.element.createElement(ws,null,acfwpElements.element.createElement(gs,null),acfwpElements.element.createElement(ys,{loading:!0,active:!0,paragraph:{rows:2},title:!1})))))}return acfwpElements.element.createElement("div",{className:`settings-form ${s}-form`},o.map(((e,t)=>acfwpElements.element.createElement(Es,{key:e.id,field:e,order:t}))))})),{element:{Fragment:Ts,useEffect:vs},router:{useLocation:bs},antd:{Row:Cs,Col:xs},redux:{bindActionCreators:Rs,connect:Is}}=acfwpElements,{readSections:As,readSection:Os}=o,Ds=Is((e=>({sections:e.settingSections})),(e=>({actions:Rs({readSections:As,readSection:Os},e)})))((e=>{const{sections:t,actions:n}=e,{loyalty_program:{tabs:a}}=acfwAdminApp,l=new URLSearchParams(bs().search),s=l.get("section")||"general",o=l.get("tab"),r=a.findIndex((e=>"settings"===e.slug)),{label:c,desc:i}=a[r];return vs((()=>{t.length>0||n.readSections({id:s||"general"})}),[]),vs((()=>{if(t.length<1)return;const e=s?t.findIndex((e=>e.id===s)):0;t[e].fields.length<1&&n.readSection({id:s})}),[t,n,s]),"settings"!==o?null:acfwpElements.element.createElement(Ts,null,acfwpElements.element.createElement("div",{className:"tab-header"},acfwpElements.element.createElement("h1",null,c),acfwpElements.element.createElement("p",null,i)),acfwpElements.element.createElement(Cs,{className:"settings-content"},acfwpElements.element.createElement(xs,{span:6},acfwpElements.element.createElement(ia,{currentSection:s})),acfwpElements.element.createElement(xs,{span:18,className:"content-column"},acfwpElements.element.createElement(hs,{currentSection:s}))))})),{element:{Fragment:Ns,useEffect:ks,useState:Bs},redux:{bindActionCreators:Ps,connect:Hs},antd:{Form:Ls,Input:Us,Button:Ms,Typography:Ys,Skeleton:Vs,message:Gs},antdIcons:{CheckCircleFilled:$s}}=acfwpElements,{Link:js}=Ys,{readLicenseData:Fs,activateLicenseData:zs}=y,qs=Hs((e=>({license:e.license})),(e=>({actions:Ps({readLicenseData:Fs,activateLicenseData:zs},e)})))((e=>{const{license:t,actions:n}=e,a=acfwAdminApp.loyalty_program.license,[l,s]=Bs(!1),[o,r]=Bs(!1),[c]=Ls.useForm();return ks((()=>{t?s(!0):n.readLicenseData({alwaysCB:()=>s(!0)})}),[]),acfwpElements.element.createElement("div",{className:"acfw-license-box"},acfwpElements.element.createElement("div",{className:"overview"},acfwpElements.element.createElement("h1",null,a.title)),acfwpElements.element.createElement("div",{className:"license-info"},acfwpElements.element.createElement("div",{className:"heading"},acfwpElements.element.createElement("div",{className:"left"},acfwpElements.element.createElement("span",null,a.license_status)),acfwpElements.element.createElement("div",{className:"right"},acfwpElements.element.createElement("span",{className:"action-button active-indicator no-hover "+("yes"==(null==t?void 0:t.is_active)?"activated":"")},"yes"==(null==t?void 0:t.is_active)&&acfwpElements.element.createElement($s,null),"yes"===(null==t?void 0:t.is_active)?a.activated:a.not_activated))),acfwpElements.element.createElement("div",{className:"content"},acfwpElements.element.createElement("p",null,a.description),acfwpElements.element.createElement("table",{className:"license-specs"},acfwpElements.element.createElement("thead",null,acfwpElements.element.createElement("tr",null,acfwpElements.element.createElement("th",null,a.plan_label),acfwpElements.element.createElement("th",null,a.version_label))),acfwpElements.element.createElement("tbody",null,acfwpElements.element.createElement("tr",null,acfwpElements.element.createElement("td",null,a.plan_value),acfwpElements.element.createElement("td",null,a.version_value))))),acfwpElements.element.createElement("div",{className:"license-form lpfw-license-form"},l?acfwpElements.element.createElement(Ns,null,acfwpElements.element.createElement(Ls,{layout:"vertical",form:c,initialValues:{key:null!=t&&t.key?t.key:"",email:null!=t&&t.email?t.email:""},onFinish:({key:e,email:t})=>{r(!0),n.activateLicenseData({license_key:e,email:t,successCB:e=>{"success"===e.data.status?Gs.success(e.data.message):Gs.error(e.data.message)},alwaysCB:()=>r(!1)})}},acfwpElements.element.createElement(Ls.Item,{className:"license-form-item license-key-field",label:a.license_key,name:"key"},acfwpElements.element.createElement(Us,{type:"password",autocomplete:"off",required:!0})),acfwpElements.element.createElement(Ls.Item,{className:"license-form-item activation-email-field",label:a.license_email,name:"email"},acfwpElements.element.createElement(Us,{type:"email",autocomplete:"off",required:!0})),acfwpElements.element.createElement(Ls.Item,{className:"license-form-item form-action"},acfwpElements.element.createElement(Ms,{type:"primary",htmlType:"submit",loading:o},a.activate_btn))),acfwpElements.element.createElement("div",{className:"help-row"},a.help.text," ",acfwpElements.element.createElement(js,{href:a.help.link,target:"_blank"},a.help.login))):acfwpElements.element.createElement(Vs,{loading:!0,active:!0,paragraph:{rows:1}}))))})),Js=e=>{const{slug:t}=e;if("dashboard"===t)return acfwpElements.element.createElement(at,null);if("customers"===t)return acfwpElements.element.createElement(me,null,acfwpElements.element.createElement($n,null));if("settings"===t)return acfwpElements.element.createElement(Ds,null);if("license"===t){const{is_multisite:e}=acfwAdminApp.loyalty_program.license;return e?(window.location.href=acfwAdminApp.loyalty_program.license.license_page,null):acfwpElements.element.createElement(qs,null)}return null},{element:{useState:Qs,useEffect:Ws},router:{useHistory:Ks,useLocation:Xs},antd:{Tabs:Zs},appStore:{store:eo},pathPrefix:to}=acfwpElements,{TabPane:no}=Zs,ao=()=>{const{logo:e,loyalty_program:{title:t,tabs:n}}=acfwAdminApp,[a,l]=Qs(""),s=new URLSearchParams(Xs().search),[o,r]=Qs(s.get("tab")),c=o?n.findIndex((e=>e.slug===o)):0,i=Ks();return Ws((()=>{a||l(eo.getState().page)}),[]),eo.subscribe((()=>{const e=eo.getState().page;a!==e&&l(e)})),"acfw-license/LPFW"===a?acfwpElements.element.createElement(qs,null):"acfw-loyalty-program"!==a?null:acfwpElements.element.createElement("div",{className:"lpfw-app acfw-admin-app"},acfwpElements.element.createElement("div",{className:"page-header loyalty-program-header"},acfwpElements.element.createElement("img",{className:"acfw-logo",src:e,alt:"acfw logo"}),acfwpElements.element.createElement("h1",null,t)),acfwpElements.element.createElement(Zs,{activeKey:c+"",defaultActiveKey:c+"",onTabClick:e=>{"license"===n[e].slug?(i.push(`${to}admin.php?page=acfw-license&tab=LPFW`),eo.dispatch({type:"SET_STORE_PAGE",payload:{data:"acfw-license/LPFW"}})):(r(n[e].slug),i.push(`${to}admin.php?page=acfw-loyalty-program&tab=${n[e].slug}`))}},n.map(((e,t)=>acfwpElements.element.createElement(no,{tab:e.label,key:t},acfwpElements.element.createElement(Js,{slug:e.slug}))))))},{dom:lo,router:{BrowserRouter:so,Route:oo},pathPrefix:ro,appStore:{Provider:co,store:io}}=acfwpElements,mo=function(e){const t=se(),n=ne(ae({dashboard:l,settingSections:c,settingValues:d,customers:E,license:g}),e,(a=[t],le(...a)));var a;return t.run(ee),n}();document.querySelectorAll("#lpfw_admin_app").forEach((e=>{lo.render(acfwpElements.element.createElement(co,{store:mo},acfwpElements.element.createElement(so,null,acfwpElements.element.createElement(oo,{path:`${ro}admin.php`,component:ao}))),e)}))}}}));
