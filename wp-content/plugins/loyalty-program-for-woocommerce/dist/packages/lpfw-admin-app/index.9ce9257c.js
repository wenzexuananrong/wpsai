import{a as ye}from"../../common/index.241b22b8.js";import"../../common/reactLib.86ff7851.js";function Mo(){import.meta.url,import("_").catch(()=>1);async function*e(){}}var q=(e=>(e.READ_DASHBOARD_DATA="READ_DASHBOARD_DATA",e.READ_DASHBOARD_HISTORY_DATA="READ_DASHBOARD_HISTORY_DATA",e.SET_DASHBOARD_DATA="SET_DASHBOARD_DATA",e.SET_DASHBOARD_HISTORY_DATA="SET_DASHBOARD_HISTORY_DATA",e))(q||{});const oe={readDashboardData:e=>({type:"READ_DASHBOARD_DATA",payload:e}),readDashboardHistoryData:e=>({type:"READ_DASHBOARD_HISTORY_DATA",payload:e}),setStoreDashboardData:e=>({type:"SET_DASHBOARD_DATA",payload:e}),setStoreDashboardHistoryData:e=>({type:"SET_DASHBOARD_HISTORY_DATA",payload:e})},gt=(e=null,t)=>{switch(t.type){case q.SET_DASHBOARD_DATA:{const{data:a}=t.payload;return{...e,...a}}case q.SET_DASHBOARD_HISTORY_DATA:{const{data:a}=t.payload;return{...e,history:a}}default:return e}};var Q=(e=>(e.READ_SECTIONS="READ_SECTIONS",e.READ_SECTION="READ_SECTION",e.SET_STORE_SECTIONS="SET_STORE_SECTIONS",e.SET_STORE_SECTION="SET_STORE_SECTION",e))(Q||{});const we={readSections:e=>({type:"READ_SECTIONS",payload:e}),readSection:e=>({type:"READ_SECTION",payload:e}),setStoreSectionItems:e=>({type:"SET_STORE_SECTIONS",payload:e}),setStoreSectionItem:e=>({type:"SET_STORE_SECTION",payload:e})},{lodash:{cloneDeep:yt}}=acfwpElements,wt=(e=[],t)=>{switch(t.type){case Q.SET_STORE_SECTIONS:{const{data:a}=t.payload;return a}case Q.SET_STORE_SECTION:{const{data:a}=t.payload,s=e.findIndex(n=>n.id===a.id);if(s<0)return e;const l=yt(e);return l[s]={...l[s],...a},l}default:return e}};var b=(e=>(e.CREATE_SETTING="CREATE_SETTING",e.UPDATE_SETTING="UPDATE_SETTING",e.DELETE_SETTING="DELETE_SETTING",e.READ_SETTINGS="READ_SETTINGS",e.REHYDRATE_STORE_SETTINGS="REHYDRATE_STORE_SETTINGS",e.REHYDRATE_STORE_SETTING="REHYDRATE_STORE_SETTING",e.SET_STORE_SETTINGS="SET_STORE_SETTINGS",e.SET_STORE_SETTING="SET_STORE_SETTING",e))(b||{});const v={createSetting:e=>({type:"CREATE_SETTING",payload:e}),updateSetting:e=>({type:"UPDATE_SETTING",payload:e}),deleteSetting:e=>({type:"DELETE_SETTING",payload:e}),readSettings:e=>({type:"READ_SETTINGS",payload:e}),rehydrateStoreSettings:e=>({type:"REHYDRATE_STORE_SETTINGS",payload:e}),rehydrateStoreSetting:e=>({type:"REHYDRATE_STORE_SETTING",payload:e}),setStoreSettingItems:e=>({type:"SET_STORE_SETTINGS",payload:e}),setStoreSettingItem:e=>({type:"SET_STORE_SETTING",payload:e})},{lodash:{cloneDeep:Te}}=acfwpElements,_t=(e=[],t)=>{switch(t.type){case b.SET_STORE_SETTINGS:{const{data:a}=t.payload;let s=Te(e);for(const l of a){let n=e.findIndex(c=>c.id===l.id);s[n]?s[n]=l:s.push(l)}return s}case b.SET_STORE_SETTING:{const{data:a}=t.payload,s=e.findIndex(n=>n.id===a.id);if(s<0)return e;const l=Te(e);return l[s]={...l[s],...a},l}default:return e}};var $=(e=>(e.READ_CUSTOMERS="READ_CUSTOMERS",e.READ_SINGLE_CUSTOMER="READ_SINGLE_CUSTOMER",e.READ_SINGLE_CUSTOMER_POINTS="READ_SINGLE_CUSTOMER_POINTS",e.READ_CUSTOMER_STATUS="READ_CUSTOMER_STATUS",e.READ_CUSTOMER_HISTORY="READ_CUSTOMER_HISTORY",e.ADJUST_CUSTOMER_POINTS="ADJUST_CUSTOMER_POINTS",e.SET_STORE_CUSTOMERS="SET_STORE_CUSTOMERS",e.SET_SINGLE_CUSTOMER="SET_SINGLE_CUSTOMER",e.SET_SINGLE_CUSTOMER_POINTS="SET_SINGLE_CUSTOMER_POINTS",e.SET_STORE_CUSTOMER_STATUS="SET_STORE_CUSTOMER_STATUS",e.SET_STORE_CUSTOMER_SOURCES="SET_STORE_CUSTOMER_SOURCES",e.SET_STORE_HISTORY_ENTRIES="SET_STORE_HISTORY_ENTRIES",e.SET_STORE_HISTORY_ENTRY="SET_STORE_HISTORY_ENTRY",e))($||{});const R={readCustomers:e=>({type:"READ_CUSTOMERS",payload:e}),readSingleCustomer:e=>({type:"READ_SINGLE_CUSTOMER",payload:e}),readSingleCustomerPoints:e=>({type:"READ_SINGLE_CUSTOMER_POINTS",payload:e}),readCustomerStatus:e=>({type:"READ_CUSTOMER_STATUS",payload:e}),readCustomerHistory:e=>({type:"READ_CUSTOMER_HISTORY",payload:e}),adjustCustomerPoints:e=>({type:"ADJUST_CUSTOMER_POINTS",payload:e}),setStoreCustomers:e=>({type:"SET_STORE_CUSTOMERS",payload:e}),setStoreSingleCustomer:e=>({type:"SET_SINGLE_CUSTOMER",payload:e}),setStoreSingleCustomerCustomer:e=>({type:"SET_SINGLE_CUSTOMER_POINTS",payload:e}),setStoreCustomerStatus:e=>({type:"SET_STORE_CUSTOMER_STATUS",payload:e}),setStoreCustomerSources:e=>({type:"SET_STORE_CUSTOMER_SOURCES",payload:e}),setStoreHIstoryEntries:e=>({type:"SET_STORE_HISTORY_ENTRIES",payload:e}),setStoreHistoryEntry:e=>({type:"SET_STORE_HISTORY_ENTRY",payload:e})};acfwpElements;const Tt=(e=[],t)=>{var s,l;let a;switch(t.type){case $.SET_STORE_CUSTOMERS:{const{data:n}=t.payload;return n}case $.SET_SINGLE_CUSTOMER:{const{data:n}=t.payload;return a=e.findIndex(c=>c.id===n.id),a>=0?(e[a]=n,[...e]):[n,...e]}case $.SET_SINGLE_CUSTOMER_POINTS:{const{id:n,data:c}=t.payload;return a=e.findIndex(o=>o.id===n),e[a]={...e[a],points:c.points,expiry:c.expiry},[...e]}case $.SET_STORE_CUSTOMER_STATUS:{const{id:n,data:c}=t.payload;return a=e.findIndex(o=>o.id===n),e[a]={...e[a],status:c},[...e]}case $.SET_STORE_CUSTOMER_SOURCES:{const{id:n,data:c}=t.payload;return a=e.findIndex(o=>o.id===n),e[a]={...e[a],sources:c},[...e]}case $.SET_STORE_HISTORY_ENTRIES:{const{id:n,data:c}=t.payload;return a=e.findIndex(o=>o.id===n),e[a]={...e[a],history:c},[...e]}case $.SET_STORE_HISTORY_ENTRY:{const{id:n,data:c}=t.payload;a=e.findIndex(r=>r.id===n);const o=(l=(s=e[a])==null?void 0:s.history)!=null?l:[];return e[a]={...e[a],history:[...o,c]},[...e]}default:return e}};var ae=(e=>(e.READ_LICENSE="READ_LICENSE",e.ACTIVATE_LICENSE="ACTIVATE_LICENSE",e.SET_LICENSE="SET_LICENSE",e))(ae||{});const _e={readLicenseData:e=>({type:"READ_LICENSE",payload:e}),activateLicenseData:e=>({type:"ACTIVATE_LICENSE",payload:e}),setLicenseData:e=>({type:"SET_LICENSE",payload:e})},ht=(e=null,t)=>{switch(t.type){case ae.SET_LICENSE:{const{data:a}=t.payload;return a}default:return e}},{axiosInstance:st,redux:{sagaEffects:Ct}}=acfwpElements,{put:se,call:lt,takeEvery:he}=Ct;function*$t(e){const{processingCB:t,successCB:a,failCB:s}=e.payload;try{typeof t=="function"&&t();const l=yield lt(()=>st.get("loyalty-program/v1/dashboard"));l&&l.data&&se&&(yield se(oe.setStoreDashboardData({data:l.data})),typeof a=="function"&&a(l))}catch(l){typeof s=="function"&&s({error:l})}}function*It(e){const{page:t,before_date:a,after_date:s,processingCB:l,successCB:n,failCB:c}=e.payload;try{typeof l=="function"&&l();const o=yield lt(()=>st.get("loyalty-program/v1/dashboard/history",{params:{page:t,before_date:a,after_date:s}}));o&&o.data&&se&&(yield se(oe.setStoreDashboardHistoryData({data:o.data})),typeof n=="function"&&n(o))}catch(o){typeof c=="function"&&c({error:o})}}const vt=[he(q.READ_DASHBOARD_DATA,$t),he(q.READ_DASHBOARD_HISTORY_DATA,It)],{redux:{sagaEffects:Rt},axiosInstance:Se}=acfwpElements,{put:le,call:ct,takeEvery:Ce}=Rt;function*At(e){const{id:t,processingCB:a,successCB:s,failCB:l}=e.payload,n=t||"general";try{typeof a=="function"&&a(),Se.defaults.headers.section=n;const c=yield ct(()=>Se.get("loyalty-program/v1/settings/sections"));if(c&&c.data){const o=n?c.data.findIndex(r=>r.id===n):0;yield le(v.rehydrateStoreSettings({data:c.data[o]})),yield le(we.setStoreSectionItems({data:c.data})),typeof s=="function"&&s(c)}}catch(c){typeof l=="function"&&l({error:c})}}function*bt(e){const{id:t,processingCB:a,successCB:s,failCB:l}=e.payload;try{typeof a=="function"&&a();const n=t||"general",c=yield ct(()=>Se.get("loyalty-program/v1/settings/sections/".concat(n)));c&&c.data&&(yield le(v.rehydrateStoreSettings({data:c.data})),yield le(we.setStoreSectionItem({data:c.data})),typeof s=="function"&&s(c))}catch(n){typeof l=="function"&&l({error:n})}}const Ot=[Ce(Q.READ_SECTIONS,At),Ce(Q.READ_SECTION,bt)],xt=ye.CancelToken,J=ye.create({baseURL:wpApiSettings.root,timeout:3e4,headers:{"X-WP-Nonce":wpApiSettings.nonce}}),ge=new Map,Dt=e=>{const t=ge.get(e);t&&(t(),ge.delete(e))},Nt=e=>new xt(t=>ge.set(e,t)),{redux:{sagaEffects:Pt}}=acfwpElements,{put:L,call:W,takeEvery:V}=Pt;function*kt(e){const{data:t,processingCB:a,successCB:s,failCB:l}=e.payload;try{typeof a=="function"&&a();const n=yield W(()=>J.post("loyalty-program/v1/setting/sections",t));n&&n.data&&(yield L(v.rehydrateStoreSettings({})),typeof s=="function"&&s(n))}catch(n){typeof l=="function"&&l({error:n,payload:t})}}function*Bt(e){const{data:t,processingCB:a,successCB:s,failCB:l}=e.payload;try{if(typeof a=="function"&&a(),!t.id)throw new Error("Can't update setting. No setting id provided.");const n=yield W(()=>{const{id:c,...o}=t;return J.put("loyalty-program/v1/settings/".concat(c),o,{cancelToken:Nt(c)})});n&&n.data&&(yield L(v.rehydrateStoreSetting({id:n.data.id,data:n.data})),typeof s=="function"&&s(n))}catch(n){if(ye.isCancel(n))return;typeof l=="function"&&l({error:n,payload:t})}}function*Lt(e){const{id:t,processingCB:a,successCB:s,failCB:l}=e.payload;try{typeof a=="function"&&a();const n=yield W(()=>J.delete("loyalty-program/v1/settings/".concat(t)));n&&n.data&&(yield L(v.rehydrateStoreSettings({})),typeof s=="function"&&s(n))}catch(n){typeof l=="function"&&l({error:n})}}function*Vt(e){const{processingCB:t,successCB:a,failCB:s}=e.payload;try{typeof t=="function"&&t();const l=yield W(()=>J.get("loyalty-program/v1/settings/"));l&&l.data&&(yield L(v.rehydrateStoreSettings({data:l.data})),typeof a=="function"&&a(l))}catch(l){typeof s=="function"&&s({error:l})}}function*Ht(e){const{data:t,processingCB:a,successCB:s,failCB:l}=e.payload;try{if(typeof a=="function"&&a(),t){let n=t.fields.filter(c=>c.type!=="title"&&c.type!=="sectionend").map(c=>({id:c.id,value:c.value}));yield L(v.setStoreSettingItems({data:n})),typeof s=="function"&&s(n)}}catch(n){typeof l=="function"&&l({error:n})}}function*Mt(e){const{id:t,data:a,processingCB:s,successCB:l,failCB:n}=e.payload;try{if(typeof s=="function"&&s(),a)yield L(v.setStoreSettingItem({data:a})),typeof l=="function"&&l(a);else{const c=yield W(()=>J.get("loyalty-program/v1/settings/".concat(t)));c&&c.data&&(yield L(v.setStoreSettingItem({data:c.data})),typeof l=="function"&&l(c))}}catch(c){typeof n=="function"&&n({error:c})}}const Ut=[V(b.CREATE_SETTING,kt),V(b.UPDATE_SETTING,Bt),V(b.DELETE_SETTING,Lt),V(b.READ_SETTINGS,Vt),V(b.REHYDRATE_STORE_SETTINGS,Ht),V(b.REHYDRATE_STORE_SETTING,Mt)],{axiosInstance:F,redux:{sagaEffects:Ft}}=acfwpElements,{put:O,call:Y,takeEvery:H}=Ft;function*Yt(e){const{params:t,processingCB:a,successCB:s,failCB:l,alwaysCB:n}=e.payload;try{typeof a=="function"&&a();const c=yield Y(()=>F.get("loyalty-program/v1/customers",{params:t}));c&&c.data&&(yield O(R.setStoreCustomers({data:c.data})),typeof s=="function"&&s(c))}catch(c){typeof l=="function"&&l({error:c})}typeof n=="function"&&n()}function*Gt(e){const{id:t,processingCB:a,successCB:s,failCB:l,alwaysCB:n}=e.payload;try{typeof a=="function"&&a();const c=yield Y(()=>F.get("loyalty-program/v1/customers/".concat(t)));c&&c.data&&(yield O(R.setStoreSingleCustomer({data:c.data})),typeof s=="function"&&s(c))}catch(c){typeof l=="function"&&l({error:c})}typeof n=="function"&&n()}function*jt(e){const{id:t,processingCB:a,successCB:s,failCB:l,alwaysCB:n}=e.payload;try{typeof a=="function"&&a();const c=yield Y(()=>F.get("loyalty-program/v1/customers/points/".concat(t)));c&&c.data&&(yield O(R.setStoreSingleCustomerCustomer({id:t,data:c.data})),typeof s=="function"&&s(c))}catch(c){typeof l=="function"&&l({error:c})}typeof n=="function"&&n()}function*zt(e){const{id:t,processingCB:a,successCB:s,failCB:l,alwaysCB:n}=e.payload;try{typeof a=="function"&&a();const c=yield Y(()=>F.get("loyalty-program/v1/customers/status/".concat(t)));c&&c.data&&O&&(yield O(R.setStoreCustomerStatus({id:t,data:c.data.status})),yield O(R.setStoreCustomerSources({id:t,data:c.data.sources})),typeof s=="function"&&s(c))}catch(c){typeof l=="function"&&l({error:c})}typeof n=="function"&&n()}function*qt(e){const{id:t,page:a,processingCB:s,successCB:l,failCB:n,alwaysCB:c}=e.payload;try{typeof s=="function"&&s();const o=yield Y(()=>F.get("loyalty-program/v1/customers/history/".concat(t),{params:{page:a}}));o&&o.data&&O&&(yield O(R.setStoreHIstoryEntries({id:t,data:o.data})),typeof l=="function"&&l(o))}catch(o){typeof n=="function"&&n({error:o})}typeof c=="function"&&c()}function*Qt(e){const{id:t,type:a,points:s,notes:l,processingCB:n,successCB:c,failCB:o,alwaysCB:r}=e.payload;try{typeof n=="function"&&n();const i=yield Y(()=>F.post("loyalty-program/v1/customers/points/".concat(t),{id:t,type:a,points:s,notes:l}));i&&i.data&&O&&typeof c=="function"&&c(i)}catch(i){typeof o=="function"&&o({error:i})}typeof r=="function"&&r()}const Jt=[H($.READ_CUSTOMERS,Yt),H($.READ_SINGLE_CUSTOMER,Gt),H($.READ_SINGLE_CUSTOMER_POINTS,jt),H($.READ_CUSTOMER_STATUS,zt),H($.READ_CUSTOMER_HISTORY,qt),H($.ADJUST_CUSTOMER_POINTS,Qt)],{axiosInstance:ot,redux:{sagaEffects:Wt}}=acfwpElements,{put:ce,call:rt,takeEvery:$e}=Wt;function*Kt(e){var n,c;const{processingCB:t,successCB:a,failCB:s,alwaysCB:l}=e.payload;try{typeof t=="function"&&t();const o=yield rt(()=>ot({url:ajaxurl,baseURL:window.location.origin.toString(),params:{action:"lpfw_get_license_details"}}));o&&o.data&&ce&&(yield ce(_e.setLicenseData({data:{key:(n=o.data.license_key)!=null?n:"",email:(c=o.data.email)!=null?c:"",is_active:o.data.is_active}})),typeof a=="function"&&a(o))}catch(o){typeof s=="function"&&s({error:o})}typeof l=="function"&&l()}function*Xt(e){const{license_key:t,email:a,processingCB:s,successCB:l,failCB:n,alwaysCB:c}=e.payload;try{typeof s=="function"&&s();const o=acfwAdminApp.loyalty_program.license._formNonce,r=new FormData;r.append("action","lpfw_activate_license"),r.append("activation-email",a),r.append("license-key",t),r.append("ajax-nonce",o);const i=yield rt(()=>ot({url:ajaxurl,method:"POST",baseURL:window.location.origin.toString(),data:r}));i&&i.data&&ce&&(yield ce(_e.setLicenseData({data:{key:t,email:a,is_active:i.data.license_status==="active"?"yes":"no"}})),typeof l=="function"&&l(i))}catch(o){typeof n=="function"&&n({error:o})}typeof c=="function"&&c()}const Zt=[$e(ae.READ_LICENSE,Kt),$e(ae.ACTIVATE_LICENSE,Xt)],{redux:{sagaEffects:en}}=acfwpElements,{all:tn}=en;function*nn(){yield tn([...vt,...Ot,...Ut,...Jt,...Zt])}const{redux:{sagaEffects:Yo,createStore:an,combineReducers:sn,applyMiddleware:ln,createSagaMiddleware:cn}}=acfwpElements,on=e=>ln(...e);function rn(e=void 0){const t=cn(),a=an(sn({dashboard:gt,settingSections:wt,settingValues:_t,customers:Tt,license:ht}),e,on([t]));return t.run(nn),a}const{element:{createContext:mn,useReducer:dn}}=acfwpElements,un=(e,t)=>{switch(t.type){case"SET_PAGE":return{...e,page:t.value};case"SET_PER_PAGE":return{...e,per_page:t.value};case"SET_SEARCH":return{...e,search:t.value,page:1};case"SET_SORT_BY":return{...e,sort_by:t.value};case"SET_SORT_ORDER":return{...e,sort_order:t.value};case"SET_QUERY":return t.value}return e},it=mn({params:{page:1},dispatchParams:e=>{}}),pn=({children:e})=>{const t={page:1},[a,s]=dn(un,t);return acfwpElements.element.createElement(it.Provider,{value:{params:a,dispatchParams:s}},e)};const{element:{useState:fn,useEffect:En},antd:{Table:Sn},redux:{bindActionCreators:gn,connect:yn}}=acfwpElements,wn=e=>{const{status:t}=e,{loyalty_program:{labels:a}}=acfwAdminApp,{information:s,points:l,value:n}=a,[c,o]=fn(!0),r=[{title:s,dataIndex:"label",key:"label"},{title:l,dataIndex:"points",key:"points"},{title:n,dataIndex:"value",key:"value"}];return En(()=>{t&&t.length&&o(!1)},[t,o]),acfwpElements.element.createElement(Sn,{loading:c,pagination:!1,dataSource:t,columns:r})},_n=e=>{var t;return{status:(t=e.dashboard)==null?void 0:t.status}},Tn=e=>({actions:gn({},e)}),hn=yn(_n,Tn)(wn),{element:{useState:Cn,useEffect:$n},antd:{Table:In},redux:{bindActionCreators:vn,connect:Rn}}=acfwpElements,An=e=>{const{sources:t}=e,{loyalty_program:{labels:a}}=acfwAdminApp,[s,l]=Cn(!0),n=[{title:a.source,dataIndex:"label",key:"label"},{title:a.points,dataIndex:"points",key:"points"}];return $n(()=>{t&&t.length&&l(!1)},[t,l]),acfwpElements.element.createElement(In,{loading:s,pagination:!1,dataSource:t,columns:n})},bn=e=>{var t;return{sources:(t=e.dashboard)==null?void 0:t.sources}},On=e=>({actions:vn({},e)}),xn=Rn(bn,On)(An),{element:{useState:Dn,useEffect:Nn},router:{Link:Pn},antd:{Table:kn},redux:{connect:Bn},pathPrefix:Ln}=acfwpElements,Vn=e=>{const{customers:t}=e,{loyalty_program:{labels:a}}=acfwAdminApp,[s,l]=Dn(!0),n=[{title:a.customer,dataIndex:"name",key:"name",render:(c,o)=>acfwpElements.element.createElement(Pn,{to:"".concat(Ln,"admin.php?page=acfw-loyalty-program&tab=customers&customer=").concat(o.id)},c)},{title:a.points,dataIndex:"points",key:"points"}];return Nn(()=>{Array.isArray(t)&&l(!1)},[t,l]),acfwpElements.element.createElement(kn,{loading:s,pagination:!1,dataSource:t,columns:n})},Hn=e=>{var t;return{customers:(t=e.dashboard)==null?void 0:t.customers}},Mn=Bn(Hn,null)(Vn),{validateURL:Un}=acfwpElements;function Ie(e){const{decimalPoint:t}=lpfwAdminApp,a=new RegExp("[^-0-9%\\".concat(t,"]+"),"gi"),s=new RegExp("[^\\".concat(t,'"]'),"gi");let l=e.replace(a,"");1<l.replace(s,"").length&&(l=l.replace(s,""));const n=parseFloat(l.replace(t,"."));return e===l&&n>=0}function ve(e){const{decimalPoint:t}=lpfwAdminApp;return parseFloat(e.replace(t,"."))}function Fn(e,t,a){var l;let s=!0;switch(t){case"number":const n=(l=a==null?void 0:a.min)!=null?l:0;s=e===""||parseInt(e)>=n;break;case"url":s=e&&Un(e+"");break;case"price":s=e&&Ie(e+"");break;case"breakpoints":s=e.reduce((c,{amount:o})=>Ie(o)&&c,!0);break;case"order_period":s=e.reduce((c,{points:o})=>parseInt(o)>0&&c,!0);break}return s}function mt(e){return e.type==="increase"?"+":"-"}const{element:{useState:M,useEffect:Re},router:{Link:Yn},antd:{Card:Gn,Select:Ae,DatePicker:jn,Table:zn,Pagination:qn,Popover:Qn},antdIcons:{FileTextOutlined:Jn},redux:{bindActionCreators:Wn,connect:Kn},pathPrefix:Xn}=acfwpElements,{readDashboardHistoryData:Zn}=oe,ea=e=>{const{entries:t,actions:a}=e,{loyalty_program:{labels:s,period_options:l}}=acfwAdminApp,[n,c]=M(1),[o,r]=M("month_to_date"),[i,d]=M(moment().startOf("month")),[u,m]=M(moment().startOf("day")),[p,S]=M(""),[f,E]=M(!0),_=y=>{switch(r(y),y){case"week_to_date":d(moment().startOf("week")),m(moment().startOf("day"));break;case"month_to_date":d(moment().startOf("month")),m(moment().startOf("day"));break;case"quarter_to_date":d(moment().startOf("quarter")),m(moment().startOf("day"));break;case"year_to_date":d(moment().startOf("year")),m(moment().startOf("day"));break;case"last_week":d(moment().subtract(1,"weeks").startOf("week")),m(moment().subtract(1,"weeks").endOf("week"));break;case"last_month":d(moment().subtract(1,"months").startOf("month")),m(moment().subtract(1,"months").endOf("month"));break;case"last_quarter":d(moment().subtract(1,"quarters").startOf("quarter")),m(moment().subtract(1,"quarters").endOf("quarter"));break;case"last_year":d(moment().subtract(1,"years").startOf("year")),m(moment().subtract(1,"years").endOf("year"));break}},w=y=>{d(y[0]),m(y[1]),r("custom")};Re(()=>{E(!0),a.readDashboardHistoryData({page:n,before_date:i.format("YYYY-MM-DD"),after_date:u.format("YYYY-MM-DD"),successCB:y=>{S(y.headers["x-total"]),E(!1)}})},[n,i,u]),Re(()=>{t&&t.length&&E(!1)},[t,E]);const h=[{title:s.date,dataIndex:"date",key:"date"},{title:s.customer,dataIndex:"user_id",key:"user_id",render:(y,g)=>acfwpElements.element.createElement(Yn,{to:"".concat(Xn,"admin.php?page=acfw-loyalty-program&tab=customers&customer=").concat(y)},g.customer_name)},{title:s.activity,dataIndex:"activity",key:"activity",render:(y,g)=>[y,g.notes?acfwpElements.element.createElement(Qn,{placement:"top",content:g.notes,trigger:"click",overlayClassName:"lpfwp-popover-wrapper"},acfwpElements.element.createElement(Jn,{style:{paddingLeft:"5px"}})):null]},{title:s.points,dataIndex:"points",key:"points",render:(y,g)=>"".concat(mt(g)).concat(y)},{title:s.related,dataIndex:"rel_label",key:"rel_label",render:(y,g)=>g.rel_link?acfwpElements.element.createElement("a",{href:g.rel_link,target:"_blank"},y):y}];return acfwpElements.element.createElement(Gn,{className:"lpfw-dashboard-history",title:s.points_history,extra:acfwpElements.element.createElement("div",{className:"lpfw-dashboard-period-selector"},acfwpElements.element.createElement(Ae,{value:o,onSelect:_},l.map(y=>acfwpElements.element.createElement(Ae.Option,{value:y.value},y.label))),acfwpElements.element.createElement(jn.RangePicker,{value:[i,u],onChange:w}))},acfwpElements.element.createElement(zn,{loading:f,pagination:!1,dataSource:t,columns:h}),p>10&&acfwpElements.element.createElement(qn,{disabled:f,current:n,total:p,onChange:c,showSizeChanger:!1}))},ta=e=>{var t;return{entries:(t=e.dashboard)==null?void 0:t.history}},na=e=>({actions:Wn({readDashboardHistoryData:Zn},e)}),aa=Kn(ta,na)(ea),{element:{Fragment:sa,useEffect:la},redux:{bindActionCreators:ca,connect:oa},antd:{Row:ra,Col:K,Card:re}}=acfwpElements,{readDashboardData:ia}=oe,ma=e=>{const{dashboard:t,actions:a}=e,{loyalty_program:{labels:{points_status:s,points_sources:l,top_customers:n,points_history:c}}}=acfwAdminApp;return la(()=>{t||a.readDashboardData({})},[]),acfwpElements.element.createElement(sa,null,acfwpElements.element.createElement(ra,{className:"lpfw-dashboard",gutter:20},acfwpElements.element.createElement(K,{span:8},acfwpElements.element.createElement(re,{title:s},acfwpElements.element.createElement(hn,null))),acfwpElements.element.createElement(K,{span:8},acfwpElements.element.createElement(re,{title:l},acfwpElements.element.createElement(xn,null))),acfwpElements.element.createElement(K,{span:8},acfwpElements.element.createElement(re,{title:n},acfwpElements.element.createElement(Mn,null))),acfwpElements.element.createElement(K,{span:24},acfwpElements.element.createElement(aa,null))))},da=e=>({dashboard:e.dashboard}),ua=e=>({actions:ca({readDashboardData:ia},e)}),pa=oa(da,ua)(ma);const{element:{useState:be,useEffect:Go,useContext:jo,Fragment:zo},antd:{Card:qo,Table:Qo,Pagination:Jo,Input:Wo,Button:fa},antdIcons:{ReloadOutlined:Ea},redux:{bindActionCreators:Ko,connect:Xo},router:{useHistory:Zo},pathPrefix:er}=acfwpElements,Sa=e=>{const{text:t,customer:a,readSingleCustomerPoints:s}=e,[l,n]=be(!1),[c,o]=be(!1),r=i=>{o(!0),s({id:a.id,alwaysCB:()=>o(!1)})};return acfwpElements.element.createElement("div",{className:"reload-points-btn-wrap",onMouseEnter:()=>n(!0),onMouseLeave:()=>n(!1)},acfwpElements.element.createElement("span",{className:"points-value"},t),acfwpElements.element.createElement(fa,{className:l||c?"show":"hide",size:"small",icon:acfwpElements.element.createElement(Ea,null),type:"text",shape:"circle",loading:c,onClick:r}))},{element:{useState:Oe,Fragment:xe},antd:{Modal:ga,Button:ie,message:ya}}=acfwpElements,wa=e=>{var w,h,y,g,I,D;const{customer_list_page:{rest_url:t,labels:a,nonce:s},adminUrl:l}=lpfwAdminApp,{customer:n}=e,[c,o]=Oe(!1),[r,i]=Oe(!1),[d,u]=ya.useMessage(),m=()=>{o(!0)},p=()=>{const T=new URLSearchParams;T.append("action","lpfw_loyalty_point_reminder_preview_email"),n!=null&&n.id&&T.append("args[user_id]",n==null?void 0:n.id),n!=null&&n.email&&T.append("args[email]",n==null?void 0:n.email);const N="".concat(n==null?void 0:n.first_name," ").concat(n==null?void 0:n.last_name);return n!=null&&n.first_name&&(n!=null&&n.last_name)&&T.append("args[name]",N),T.append("_wpnonce",s==null?void 0:s.preview),"".concat(l,"admin-ajax.php?").concat(T.toString())},S=()=>{o(!1)},f=()=>{o(!1),window.open(p())},E=()=>{i(!1),o(!1)},_=()=>{i(!0),jQuery.ajax({type:"GET",url:t,data:{user_id:n==null?void 0:n.id},success:function(T){var N,x,P,A;!T.status||T.status==="error"?d.open({type:"error",content:"".concat((x=(N=a==null?void 0:a.modal)==null?void 0:N.error)==null?void 0:x.heading,": ").concat(T==null?void 0:T.error_msg)}):d.open({type:"success",content:acfwpElements.element.createElement(xe,null,(A=(P=a==null?void 0:a.modal)==null?void 0:P.success)==null?void 0:A.text,n!=null&&n.email?" <".concat(n==null?void 0:n.email,">."):"")}),E()},error:function(T,N,x){var P,A,G;(P=T==null?void 0:T.responseJSON)!=null&&P.message&&(x=T.responseJSON.message),d.open({type:"error",content:"".concat((G=(A=a==null?void 0:a.modal)==null?void 0:A.error)==null?void 0:G.heading,": ").concat(x)}),E()}})};return a!=null&&a.remind?acfwpElements.element.createElement(xe,null,u,acfwpElements.element.createElement(ie,{onClick:m},a.remind),acfwpElements.element.createElement(ga,{title:(w=a==null?void 0:a.modal)==null?void 0:w.heading,className:"lpfw-modal send-a-reminder-modal",width:500,open:c,onCancel:S,footer:[acfwpElements.element.createElement(ie,{key:"preview",className:"action-preview",onClick:f,"data-url":p()},(y=(h=a==null?void 0:a.modal)==null?void 0:h.button)==null?void 0:y.preview),acfwpElements.element.createElement(ie,{key:"send",className:"action-send",type:"primary",onClick:_,disabled:r},r?"".concat(a==null?void 0:a.loading,"..."):(I=(g=a==null?void 0:a.modal)==null?void 0:g.button)==null?void 0:I.send)]},acfwpElements.element.createElement("p",null,(D=a==null?void 0:a.modal)==null?void 0:D.text),acfwpElements.element.createElement("p",null,n==null?void 0:n.first_name," ",n==null?void 0:n.last_name,n!=null&&n.email?" <".concat(n==null?void 0:n.email,">"):""))):null},{element:{useState:X,useEffect:_a,useContext:Ta,Fragment:ha},antd:{Card:Ca,Table:$a,Pagination:Ia,Input:va,Button:Ra},redux:{bindActionCreators:Aa,connect:ba},router:{useHistory:Oa},pathPrefix:xa}=acfwpElements,{readCustomers:Da,readSingleCustomerPoints:Na}=R,Pa=e=>{var y;const{customers:t,actions:a}=e,{loyalty_program:{labels:s}}=acfwAdminApp,{customer_list_page:l}=lpfwAdminApp,{params:n,dispatchParams:c}=Ta(it),[o,r]=X(!1),[i,d]=X(0),[u,m]=X(n.search),[p,S]=X(null),f=Oa(),E=[{title:s.customer_name,dataIndex:"name",key:"name"},{title:s.email,dataIndex:"email",key:"email"},{title:s.points,dataIndex:"points",key:"points",render:(g,I)=>acfwpElements.element.createElement(Sa,{text:g,customer:I,readSingleCustomerPoints:a.readSingleCustomerPoints})},{title:s.points_expiry,dataIndex:"expiry",key:"expiry"},{dataIndex:"id",key:"id",render:(g,I)=>acfwpElements.element.createElement(ha,null,acfwpElements.element.createElement(Ra,{onClick:()=>h(I)},l.labels.view_stats),acfwpElements.element.createElement(wa,{customer:I}))}],_=g=>{m(g),p&&clearTimeout(p),S(setTimeout(()=>c({type:"SET_SEARCH",value:g}),1e3))},w=g=>{c({type:"SET_PAGE",value:g})},h=g=>{f.push("".concat(xa,"admin.php?page=acfw-loyalty-program&tab=customers&customer=").concat(g.id))};return _a(()=>{r(!0),a.readCustomers({params:n,successCB:g=>{d(g.headers["x-total"]),r(!1)}})},[n]),acfwpElements.element.createElement(Ca,{title:"Customers List",className:"lpfw-customers-list"},acfwpElements.element.createElement("div",{className:"customer-search"},acfwpElements.element.createElement("label",null,s.search_customers),acfwpElements.element.createElement(va.Search,{allowClear:!0,value:u,onChange:g=>_(g.target.value),placeholder:s.name_or_email})),acfwpElements.element.createElement($a,{className:"customers-list-table",loading:o,pagination:!1,dataSource:t,columns:E}),0<i&&acfwpElements.element.createElement(Ia,{defaultContent:n.page,current:n.page,hideOnSinglePage:!0,disabled:o,total:i,pageSize:(y=n.per_page)!=null?y:10,showSizeChanger:!1,onChange:w}))},ka=e=>({customers:e.customers}),Ba=e=>({actions:Aa({readCustomers:Da,readSingleCustomerPoints:Na},e)}),La=ba(ka,Ba)(Pa),{element:{useState:Z,useRef:Va},antd:{Card:Ha,Form:U,Space:me,Input:De,Select:de,Button:Ma,Popconfirm:Ua,message:ee},antdIcons:{QuestionCircleOutlined:Fa},redux:{bindActionCreators:Ya,connect:Ga}}=acfwpElements,{adjustCustomerPoints:ja,setStoreCustomerStatus:za,setStoreCustomerSources:qa}=R,Qa=e=>{const{customer:t,actions:a}=e,{loyalty_program:{labels:s}}=acfwAdminApp,[l]=U.useForm(),[n,c]=Z(!1),[o,r]=Z(!1),[i,d]=Z(null),[u,m]=Z(!1),p=Va(null),S=()=>{m(!u),u||l.setFieldsValue({notes:null}),setTimeout(()=>p.current.focus({cursor:"start"}),400)},f=()=>{const w=l.getFieldValue("points");!w||w<1?ee.error(s.invalid_points):i&&w>i?ee.error(s.invalid_maxpoints.replace("{maxpoints}",i)):r(!0)},E=()=>s.adjust_confirm.replace("{type}",l.getFieldValue("type")==="increase"?s.uc_increase:s.uc_decrease).replace("{points}",l.getFieldValue("points")),_=({type:w,points:h,notes:y})=>{r(!1),c(!0),a.adjustCustomerPoints({id:t.id,type:w,points:h,notes:y,successCB:g=>{ee.success(g.data.message),a.setStoreCustomerStatus({id:t.id,data:g.data.status}),a.setStoreCustomerSources({id:t.id,data:g.data.sources})},failCB:({error:g})=>{ee.error(g.response.data.message)},alwaysCB:()=>{l.resetFields(),d(null),c(!1)}})};return acfwpElements.element.createElement(Ha,{className:"adjust-points-card",title:s.adjust_points},acfwpElements.element.createElement("h4",null,s.adjust_for_user),acfwpElements.element.createElement(U,{form:l,initialValues:{type:"increase",points:0,notes:null},onFinish:_},acfwpElements.element.createElement(me,{direction:"vertical"},acfwpElements.element.createElement(me,{direction:"horizontal"},acfwpElements.element.createElement(U.Item,{name:"type",style:{marginBottom:"10px"}},acfwpElements.element.createElement(de,{onChange:w=>{const h=t!=null&&t.status?t==null?void 0:t.status[1].points:0,y=l.getFieldValue("type")==="decrease"?h:null;d(y)}},acfwpElements.element.createElement(de.Option,{value:"increase"},s.increase_points),acfwpElements.element.createElement(de.Option,{value:"decrease"},s.decrease_points))),acfwpElements.element.createElement(U.Item,{name:"points",style:{marginBottom:"10px"}},acfwpElements.element.createElement(De,{type:"number",placeholder:"points",min:0,max:i})),acfwpElements.element.createElement(U.Item,{style:{marginBottom:"10px"}},acfwpElements.element.createElement(Ua,{visible:o,title:E,icon:acfwpElements.element.createElement(Fa,null),okText:s.proceed,cancelText:s.cancel,okButtonProps:{className:"confirm-adjust-points"},onConfirm:()=>l.submit(),onCancel:()=>{r(!1),l.resetFields()}},acfwpElements.element.createElement(Ma,{type:"primary",htmlType:"button",loading:n,onClick:f},s.adjust)))),acfwpElements.element.createElement(me.Compact,{direction:"vertical"},acfwpElements.element.createElement("a",{onClick:S,style:{marginBottom:"0px"}},"Add note"),u?acfwpElements.element.createElement(U.Item,{name:"notes"},acfwpElements.element.createElement(De.TextArea,{ref:p,rows:2,style:{minWidth:"520px"},placeholder:s.notes,maxLength:255})):null))))},Ja=e=>({actions:Ya({adjustCustomerPoints:ja,setStoreCustomerStatus:za,setStoreCustomerSources:qa},e)}),Wa=Ga(null,Ja)(Qa),{element:{useState:Ka,useEffect:Xa},antd:{Card:Za,Table:es}}=acfwpElements,ts=e=>{const{customer:{status:t}}=e,{loyalty_program:{labels:a}}=acfwAdminApp,{points_status:s,information:l,points:n,value:c}=a,[o,r]=Ka(!0),i=[{title:l,dataIndex:"label",key:"label"},{title:n,dataIndex:"points",key:"points"},{title:c,dataIndex:"value",key:"value"}];return Xa(()=>{t&&t.length?r(!1):r(!0)},[t,r]),acfwpElements.element.createElement(Za,{className:"customer-points-status",title:s},acfwpElements.element.createElement(es,{loading:o,pagination:!1,dataSource:t,columns:i}))},{element:{useState:ns,useEffect:as},antd:{Card:ss,Table:ls}}=acfwpElements,cs=e=>{const{customer:{sources:t}}=e,{loyalty_program:{labels:a}}=acfwAdminApp,[s,l]=ns(!0),n=[{title:a.source,dataIndex:"label",key:"label"},{title:a.points,dataIndex:"points",key:"points"}];return as(()=>{t&&t.length?l(!1):l(!0)},[t,l]),acfwpElements.element.createElement(ss,{className:"customer-points-sources",title:a.points_sources},acfwpElements.element.createElement(ls,{loading:s,pagination:!1,dataSource:t,columns:n}))},{element:{useState:ue,useEffect:Ne},antd:{Card:os,Table:rs,Pagination:is,Popover:ms},antdIcons:{FileTextOutlined:ds},redux:{bindActionCreators:us,connect:ps}}=acfwpElements,{readCustomerHistory:fs,setStoreHIstoryEntries:Es}=R,Ss=e=>{var S;const{customer:t,actions:a}=e,s=(S=t==null?void 0:t.history)!=null?S:[],{loyalty_program:{labels:l}}=acfwAdminApp,[n,c]=ue(!0),[o,r]=ue(1),[i,d]=ue(0),u=t!=null&&t.status?t==null?void 0:t.status[1].points:-1,m=[{title:l.date,dataIndex:"date",key:"date"},{title:l.activity,dataIndex:"activity",key:"activity",render:(f,E)=>[f,E.notes?acfwpElements.element.createElement(ms,{placement:"top",content:E.notes,trigger:"click",overlayClassName:"lpfwp-popover-wrapper"},acfwpElements.element.createElement(ds,{style:{paddingLeft:"5px"}})):null]},{title:l.points,dataIndex:"points",key:"points",render:(f,E)=>"".concat(mt(E)).concat(f)},{title:l.related,dataIndex:"rel_label",key:"rel_label",render:(f,E)=>E.rel_link?acfwpElements.element.createElement("a",{href:E.rel_link,target:"_blank"},f):f}],p=f=>{t!=null&&t.id&&(c(!0),r(f),a.readCustomerHistory({id:t.id,page:f,successCB:E=>{f===1&&d(E.headers["x-total"]),c(!1)}}))};return Ne(()=>{c(!0)},[t==null?void 0:t.id]),Ne(()=>{t!=null&&t.id&&p(o)},[u]),acfwpElements.element.createElement(os,{title:l.points_history},acfwpElements.element.createElement(rs,{loading:n,pagination:!1,dataSource:s,columns:m}),i?acfwpElements.element.createElement(is,{defaultCurrent:o,hideOnSinglePage:!0,disabled:n,current:o,total:i,pageSize:10,showSizeChanger:!1,onChange:p}):null)},gs=e=>({actions:us({readCustomerHistory:fs,setStoreHIstoryEntries:Es},e)}),ys=ps(null,gs)(Ss),{element:{Fragment:ws,useEffect:_s},redux:{bindActionCreators:Ts,connect:hs},antd:{Descriptions:pe,Row:Cs,Col:Pe,Skeleton:$s,Button:Is},antdIcons:{LeftOutlined:vs},router:{useHistory:Rs}}=acfwpElements,{readSingleCustomer:As,readCustomerStatus:bs,readCustomerHistory:Os}=R,xs=e=>{var i;const{customerID:t,customers:a,actions:s}=e,{loyalty_program:{labels:l}}=acfwAdminApp,n=a.findIndex(d=>d.id===t),c=(i=a[n])!=null?i:null,o=Rs(),r=()=>{o.goBack()};return _s(()=>{c&&c.id?(s.readCustomerStatus({id:c.id}),s.readCustomerHistory({id:c.id})):s.readSingleCustomer({id:t,successCB:()=>{s.readCustomerStatus({id:t}),s.readCustomerHistory({id:t})}})},[]),acfwpElements.element.createElement("div",{className:"lpfw-single-customer"},acfwpElements.element.createElement(Is,{className:"go-back-customers",icon:acfwpElements.element.createElement(vs,null),onClick:r},"Go back"),c?acfwpElements.element.createElement(ws,null,acfwpElements.element.createElement(pe,{title:l.customer_info,bordered:!0},acfwpElements.element.createElement(pe.Item,{label:l.customer_name},c.name),acfwpElements.element.createElement(pe.Item,{label:l.email},c.email)),acfwpElements.element.createElement(Wa,{customer:c}),acfwpElements.element.createElement(Cs,{gutter:16},acfwpElements.element.createElement(Pe,{span:12},acfwpElements.element.createElement(ts,{customer:c})),acfwpElements.element.createElement(Pe,{span:12},acfwpElements.element.createElement(cs,{customer:c}))),acfwpElements.element.createElement(ys,{customer:c})):acfwpElements.element.createElement($s,null))},Ds=e=>({customers:e.customers}),Ns=e=>({actions:Ts({readSingleCustomer:As,readCustomerStatus:bs,readCustomerHistory:Os},e)}),Ps=hs(Ds,Ns)(xs),{router:{useLocation:ks}}=acfwpElements,Bs=()=>{const t=new URLSearchParams(ks().search).get("customer");return t?acfwpElements.element.createElement(Ps,{customerID:parseInt(t)}):acfwpElements.element.createElement(La,null)},{element:{useEffect:tr,useState:nr},antdIcons:{SettingOutlined:Ls,DollarCircleOutlined:Vs,TrophyOutlined:Hs,UserOutlined:Ms,MailOutlined:Us,MedicineBoxOutlined:Fs,InfoCircleOutlined:Ys,ToolOutlined:Gs}}=acfwpElements,js=e=>{const{section:t}=e;switch(t){case"general":return acfwpElements.element.createElement(Ls,null);case"emails":return acfwpElements.element.createElement(Us,null);case"points_earning":return acfwpElements.element.createElement(Vs,null);case"messages":return acfwpElements.element.createElement(Ys,null);case"redemption_expiry":return acfwpElements.element.createElement(Hs,null);case"restrictions":return acfwpElements.element.createElement(Ms,null);case"help":return acfwpElements.element.createElement(Fs,null);case"advanced_tools":return acfwpElements.element.createElement(Gs,null)}return null},{element:{useEffect:ar,useState:sr},router:{Link:zs},redux:{bindActionCreators:qs,connect:Qs},antd:{Skeleton:j,Menu:ke},pathPrefix:Js}=acfwpElements,Ws=e=>{const{sections:t,currentSection:a}=e,s=a||"general";return t.length<1?acfwpElements.element.createElement("div",{className:"settings-nav-skeleton"},acfwpElements.element.createElement(j,{active:!0,paragraph:!1}),acfwpElements.element.createElement(j,{active:!0,paragraph:!1}),acfwpElements.element.createElement(j,{active:!0,paragraph:!1}),acfwpElements.element.createElement(j,{active:!0,paragraph:!1}),acfwpElements.element.createElement(j,{active:!0,paragraph:!1})):acfwpElements.element.createElement(ke,{className:"acfw-settings-nav",defaultSelectedKeys:[s]},t.map(({id:l,title:n})=>acfwpElements.element.createElement(ke.Item,{key:l},acfwpElements.element.createElement(zs,{to:"".concat(Js,"admin.php?page=acfw-loyalty-program&tab=settings&section=").concat(l)},acfwpElements.element.createElement(js,{section:l}),n))))},Ks=e=>({sections:e.settingSections}),Xs=e=>({actions:qs({},e)}),Zs=Qs(Ks,Xs)(Ws);const{antd:{Input:el}}=acfwpElements,tl={conditions:["text","url","permalink"],component:e=>{const{field:t,value:a}=e,{id:s,type:l,placeholder:n,default:c}=t,o=a!==void 0&&a!==!1?a:c;return acfwpElements.element.createElement(el,{key:s,type:l==="permalink"?"text":l,name:s,placeholder:n,defaultValue:o,onChange:r=>{let i=r.target.value;e.handleValueChange({inputValue:i,needTimeout:!0})}})}},{antd:{Input:nl}}=acfwpElements,al={conditions:["price"],component:e=>{const{field:t,value:a}=e,{id:s,placeholder:l,default:n,format:c}=t,{currencySymbol:o}=lpfwAdminApp,r=a!==void 0&&a!==!1?a:n;return acfwpElements.element.createElement(nl,{addonBefore:o,type:"text",className:"wc_input_price",name:s,placeholder:l,defaultValue:r,onChange:i=>{let d=i.target.value;e.handleValueChange({inputValue:d,needTimeout:!0})}})}},{antd:{TimePicker:sl},moment:ll}=acfwpElements,cl={conditions:["timepicker"],component:e=>{const{field:t,value:a}=e,{id:s,default:l,format:n}=t,c=a!==void 0&&a!==!1?a:l;let o=n||"HH:mm:ss";return acfwpElements.element.createElement(sl,{key:s,format:o,defaultValue:(r=>{let i=r||t.default;return i=i||"00:00:00",i=ll(i,o),i})(c),onChange:r=>{let i=r.format("HH:mm:ss");e.handleValueChange({inputValue:i,needTimeout:!0})}})}},{antd:{Select:ol}}=acfwpElements,rl={conditions:["multiselect"],component:e=>{const{field:t,value:a}=e,{id:s,options:l,placeholder:n,default:c}=t,o=a!==void 0&&a!==!1?a:c;let r=l||[];return r=r.map(i=>i.label.label?i.label:{value:i.key,label:i.label}),acfwpElements.element.createElement(ol,{key:s,mode:"multiple",defaultValue:o,style:{width:"100%"},placeholder:n,options:r,onChange:i=>{e.handleValueChange({inputValue:i,needTimeout:!0})}})}},{element:{useMemo:il,useRef:ml,useState:Be},antd:{Select:dl,Spin:ul}}=acfwpElements,pl={conditions:["debounceselect"],component({fetchOptions:e,debounceTimeout:t=800,...a}){const[s,l]=Be(!1),[n,c]=Be([]),o=ml(0),r=il(()=>{const i=d=>{if(d.length<3){c([]);return}o.current+=1;const u=o.current;c([]),l(!0),e(d).then(m=>{u===o.current&&(c(m),l(!1))})};return window.lodash.debounce(i,t)},[e,t]);return acfwpElements.element.createElement(dl,{labelInValue:!0,filterOption:!1,onSearch:r,notFoundContent:s?acfwpElements.element.createElement(ul,{size:"small"}):null,...a,options:n})}},{element:{useState:fl}}=acfwpElements;async function El(e){const{root:t,nonce:a}=wpApiSettings,s=new URLSearchParams({context:"edit",search:e,_wpnonce:a});return fetch("".concat(t,"wp/v2/users?").concat(s)).then(l=>l.json()).then(l=>l.map(n=>({value:n.id,label:n.name}))).catch(l=>{console.error("Error fetching user:",l)})}const Sl={conditions:["multiuser"],component:e=>{const{field:t,value:a}=e,{default:s}=t,[l,n]=fl(a!==void 0?a:s),c=pl.component;return acfwpElements.element.createElement(c,{mode:"multiple",value:l,placeholder:"Select users",fetchOptions:El,onChange:o=>{n(o),e.handleValueChange({inputValue:o,needTimeout:!0})},style:{width:"100%"}})}},{antd:{Input:gl}}=acfwpElements,yl={conditions:["number"],component:e=>{const{field:t,value:a}=e,{id:s,type:l,placeholder:n,default:c}=t,o=a!==void 0&&a!==!1?a:c;return acfwpElements.element.createElement(gl,{key:s,type:l,name:s,placeholder:n,defaultValue:o,min:t==null?void 0:t.min,max:t==null?void 0:t.max,step:t==null?void 0:t.step,suffix:t==null?void 0:t.suffix,onChange:r=>{let i=r.target.value;e.handleValueChange({inputValue:i,needTimeout:!0})}})}},{antd:{Select:wl}}=acfwpElements,_l={conditions:["select"],component:e=>{var i;const{field:t,value:a}=e,{id:s,options:l,placeholder:n,default:c}=t,o=a!==void 0&&a!==!1?a:c;let r=l||[];return r=r.map(d=>d.label.label?d.label:{value:d.key,label:d.label}),acfwpElements.element.createElement(wl,{key:s,defaultValue:o||null,style:{width:"50%"},placeholder:n,allowClear:(i=t==null?void 0:t.allow_clear)!=null?i:!0,options:r,onSelect:d=>{e.handleValueChange({inputValue:d})},onClear:d=>{e.handleValueChange({inputValue:null})}})}},{antd:{Switch:Tl}}=acfwpElements,hl={conditions:["checkbox","module"],component:e=>{const{field:t,value:a}=e,{id:s,default:l}=t,n=a!==void 0&&a!==!1?a:l;return acfwpElements.element.createElement(Tl,{key:s,checked:n==="yes",defaultChecked:n==="yes",onChange:c=>{let o=c?"yes":"";e.handleValueChange({inputValue:o})}})}},{antd:{Input:Cl}}=acfwpElements,$l={conditions:["textarea"],component:e=>{const{field:t,value:a}=e,{id:s,placeholder:l,default:n}=t,c=a!==void 0&&a!==!1?a:n;return acfwpElements.element.createElement(Cl.TextArea,{key:s,rows:3,placeholder:l,defaultValue:c,onChange:o=>{let r=o.target.value;e.handleValueChange({inputValue:r,needTimeout:!0})}})}};class Il{constructor(){this.types={input:tl,multiselect:rl,multiuser:Sl,number:yl,price:al,select:_l,switch:hl,textarea:$l,timepicker:cl}}getComponent(t){for(const a in this.types){const{conditions:s,component:l}=this.types[a];if(s.includes(t))return l}return null}}const{element:{useEffect:vl},redux:{bindActionCreators:Rl,connect:Al},antd:{Switch:bl,Typography:Ol}}=acfwpElements,{Text:xl}=Ol,{setStoreSettingItems:Dl}=v,Nl=e=>{const{field:{options:t},values:a,handleValueChange:s,actions:l}=e;vl(()=>{if(a.length)return;const c=t==null?void 0:t.map(({key:o,value:r})=>({id:o,value:r}));c&&l.setStoreSettingItems({data:c})},[]);const n=c=>{const{option:o}=c,{key:r,label:i}=o,d=a.findIndex(m=>m.id===r),{value:u}=a[d];return acfwpElements.element.createElement("div",{className:"option"},acfwpElements.element.createElement(bl,{checked:u==="yes",defaultChecked:u==="yes",onChange:m=>{s({inputValue:m?"yes":"no",needTimeout:!1,overrideId:r,overrideTitle:i})}}),acfwpElements.element.createElement(xl,null,i))};return a.length<1?null:acfwpElements.element.createElement("div",{className:"actions-earn-points-options"},t==null?void 0:t.map((c,o)=>acfwpElements.element.createElement(n,{option:c,key:o})))},Pl=(e,t)=>{const{options:a}=t.field,s=a.map(n=>n.key);return{values:e.settingValues.filter(n=>s.includes(n.id))}},kl=e=>({actions:Rl({setStoreSettingItems:Dl},e)}),Bl=Al(Pl,kl)(Nl),{element:{useEffect:Le,useReducer:Ll,useState:Vl,Fragment:lr},lodash:{isEqual:Hl},antd:{Table:Ml,Input:Ve,Text:cr},antdIcons:{DeleteOutlined:Ul,PlusCircleOutlined:Fl}}=acfwpElements;function Yl(e,t){const{type:a,payload:s}=t,l=[...e];switch(a){case"rehydrate":return s;case"delete_row":return l.splice(s,1),l;case"add_row":return l.splice(s+1,0,{amount:"",points:"",sanitized:0}),l;case"set_amount":{const{index:n,value:c}=s;return l[n]={...l[n],amount:c},l}case"set_points":{const{index:n,value:c}=s;return l[n]={...l[n],points:c},l}default:return e}}const Gl=e=>{const{value:t,handleValueChange:a}=e,{loyalty_program:{labels:s}}=acfwAdminApp,{currencySymbol:l}=lpfwAdminApp,[n,c]=Vl(!1),[o,r]=Ll(Yl,[]);Le(()=>{const d=typeof t=="string"?JSON.parse(t):t;c(!0),!(!d||!d.length)&&r({type:"rehydrate",payload:d})},[]),Le(()=>{if(!n)return;const d=o.filter(({amount:u,points:m})=>u&&m).sort((u,m)=>{const p=ve(u.amount),S=ve(m.amount);return p<S?-1:p>S?1:0});Hl(e.value,d)||a({inputValue:d,needTimeout:!0})},[o]);const i=[{title:s.breakpoint,dataIndex:"amount",render:(d,u,m)=>acfwpElements.element.createElement(Ve,{addonBefore:l,type:"text",className:"wc_input_price",value:d,onChange:p=>r({type:"set_amount",payload:{index:m,value:p.target.value}})})},{title:s.points_earned,dataIndex:"points",render:(d,u,m)=>acfwpElements.element.createElement(Ve,{type:"number",value:d,min:1,onChange:p=>r({type:"set_points",payload:{index:m,value:p.target.value}})})},{title:"",dataIndex:"points",render:(d,u,m)=>acfwpElements.element.createElement("div",{className:"points-table-actions"},acfwpElements.element.createElement("button",{className:"delete",onClick:()=>r({type:"delete_row",payload:m})},acfwpElements.element.createElement(Ul,null)),acfwpElements.element.createElement("button",{className:"add"},acfwpElements.element.createElement(Fl,{onClick:()=>r({type:"add_row",payload:m})})))}];return acfwpElements.element.createElement(Ml,{columns:i,dataSource:o.length?o:[{amount:"",points:"",sanitized:0}],pagination:!1,size:"small"})},{element:{Fragment:or,useEffect:He,useReducer:jl,useState:zl},lodash:{isEqual:ql},antd:{Table:Ql,DatePicker:Jl,Input:Wl},antdIcons:{DeleteOutlined:Kl,PlusCircleOutlined:Xl},moment:Me}=acfwpElements,{RangePicker:Zl}=Jl;function ec(e,t){const{type:a,payload:s}=t,l=[...e];switch(a){case"rehydrate":return s;case"delete_row":return l.splice(s,1),l;case"add_row":return l.splice(s+1,0,{dateRange:null,points:""}),l;case"set_data":{const{index:n,value:c}=s;return l[n]={...c},l}default:return e}}const tc=e=>{const{value:t,handleValueChange:a}=e,{loyalty_program:{labels:s}}=acfwAdminApp,[l,n]=zl(!1),[c,o]=jl(ec,[]);He(()=>{const u=typeof t=="string"?JSON.parse(t):t;n(!0),!(!u||!u.length)&&o({type:"rehydrate",payload:u.map(r)})},[]),He(()=>{if(!l)return;const u=c.sort((m,p)=>{var S,f;if(m!=null&&m.dateRange&&(p!=null&&p.dateRange)){const E=(S=m==null?void 0:m.dateRange[0].unix())!=null?S:0,_=(f=p==null?void 0:p.dateRange[0].unix())!=null?f:0;if(E<_)return-1;if(E>_)return 1}return 0}).map(i).filter(m=>m.sdate&&m.stime&&m.edate&&m.etime&&m.points);ql(e.value,u)||a({inputValue:u,needTimeout:!0})},[c]);const r=u=>{const{sdate:m,stime:p,edate:S,etime:f,points:E}=u;return{dateRange:[Me("".concat(m," ").concat(p),"MM/DD/YYYY hh:mm a"),Me("".concat(S," ").concat(f),"MM/DD/YYYY hh:mm a")],points:E}},i=u=>{var E,_,w,h;const{dateRange:m,points:p}=u,S=m?m[0]:null,f=m?m[1]:null;return{sdate:(E=S==null?void 0:S.format("MM/DD/YYYY"))!=null?E:"",stime:(_=S==null?void 0:S.format("hh:mm a"))!=null?_:"",edate:(w=f==null?void 0:f.format("MM/DD/YYYY"))!=null?w:"",etime:(h=f==null?void 0:f.format("hh:mm a"))!=null?h:"",points:p}},d=[{title:s.date_range,dataIndex:"dateRange",render:(u,m,p)=>acfwpElements.element.createElement(Zl,{format:"YYYY/MM/DD hh:mm a",showTime:!0,value:u,onChange:S=>o({type:"set_data",payload:{index:p,value:{...m,dateRange:S}}})})},{title:s.points_earned,dataIndex:"points",render:(u,m,p)=>acfwpElements.element.createElement(Wl,{className:"points",type:"number",value:u,min:1,onChange:S=>o({type:"set_data",payload:{index:p,value:{...m,points:S.target.value}}})})},{title:"",dataIndex:"points",render:(u,m,p)=>acfwpElements.element.createElement("div",{className:"points-table-actions"},acfwpElements.element.createElement("button",{className:"delete",onClick:()=>o({type:"delete_row",payload:p})},acfwpElements.element.createElement(Kl,null)),acfwpElements.element.createElement("button",{className:"add"},acfwpElements.element.createElement(Xl,{onClick:()=>o({type:"add_row",payload:p})})))}];return acfwpElements.element.createElement(Ql,{className:"order-points-table",columns:d,dataSource:c&&c.length?c:[{dateRange:null,points:""}],pagination:!1,size:"small"})},{antd:{Typography:nc,Switch:ac,Popover:sc},antdIcons:{QuestionCircleOutlined:lc}}=acfwpElements,{Text:cc}=nc,oc=e=>{const{field:{options:t},value:a,handleValueChange:s}=e,l=(n,c)=>{const o={...a};o[n]=c?"yes":"",s({inputValue:o,needTimeout:!0})};return acfwpElements.element.createElement("div",{className:"point-calc-options"},t?t.map(({key:n,default:c,label:o,tooltip:r})=>acfwpElements.element.createElement("div",{className:"option",key:n},acfwpElements.element.createElement(ac,{checked:a[n]==="yes",defaultChecked:c==="yes",onChange:i=>l(n,i)}),acfwpElements.element.createElement(cc,null,o),acfwpElements.element.createElement(sc,{placement:"right",content:acfwpElements.element.createElement("div",{className:"setting-tooltip-content"},r),trigger:"click"},acfwpElements.element.createElement(lc,null)))):null)},{element:{useState:rc},antd:{Button:ic,message:fe}}=acfwpElements,mc=e=>{const{field:t}=e,[a,s]=rc(!1),l=()=>{s(!0),jQuery.ajax({method:"post",url:ajaxurl,data:{action:t.id,nonce:t==null?void 0:t.nonce},dataType:"json"}).done(n=>{n.status==="success"?fe.success(n.message):n.status==="warning"?fe.warning(n.message):fe.error(n.error_msg)}).always(()=>{s(!1)})};return acfwpElements.element.createElement(ic,{type:"primary",loading:a,onClick:l},t.title)};class dc{constructor(){this.types={actions_earn_points:Bl,breakpoints:Gl,order_period:tc,points_calculation:oc,refetch_update_data:mc}}getComponent(t){return this.types.hasOwnProperty(t)?this.types[t]:null}}const{element:{Fragment:Ue,useState:uc},antd:{message:Fe},redux:{bindActionCreators:pc,connect:fc},lodash:{defaults:Ec}}=acfwpElements,{updateSetting:Sc,setStoreSettingItem:gc}=v,{action_notices:Ye}=acfwAdminApp,yc=new Il,wc=new dc,_c=e=>{const{field:t,showSpinner:a,setShowSpinner:s,validateInput:l,value:n,actions:c}=e,{id:o,type:r,default:i}=t,[d,u]=uc(null),m=n!==void 0&&n!==!1?n:i,p=E=>{const{inputValue:_,needTimeout:w,overrideId:h,overrideTitle:y}=Ec(E,{needTimeout:!1,overrideID:"",overrideTitle:""}),g=h||o,I=y||t.title;c.setStoreSettingItem({data:{id:g,value:_}}),a&&(Dt(g),w&&s(!1));const D=()=>{if(!l(_))return;const T=["breakpoints","order_period"];c.updateSetting({data:{id:g,value:T.indexOf(r)>-1?JSON.stringify(_):_,type:r},processingCB:()=>s(!0),successCB:()=>{Fe.success(acfwpElements.element.createElement(Ue,null,acfwpElements.element.createElement("strong",null,I)," ",Ye.success)),s(!1)},failCB:()=>{Fe.error(acfwpElements.element.createElement(Ue,null,acfwpElements.element.createElement("strong",null,I)," ",Ye.fail)),s(!1)}})};w?(d&&(clearTimeout(d),u(null)),u(setTimeout(D,1e3))):D()},S=yc.getComponent(r);if(S)return acfwpElements.element.createElement(S,{...e,handleValueChange:p});const f=wc.getComponent(r);if(f){let E={field:t,value:m,handleValueChange:p};return acfwpElements.element.createElement(f,{...E})}return null},Tc=(e,t)=>{const{id:a}=t.field,s=e.settingValues.findIndex(n=>n.id===a);return{value:s>-1?e.settingValues[s].value:""}},hc=e=>({actions:pc({updateSetting:Sc,setStoreSettingItem:gc},e)}),Cc=fc(Tc,hc)(_c),{element:{useState:Ge},antd:{Typography:$c,Spin:Ic,Row:vc,Col:je,Divider:Rc,Popover:Ac},antdIcons:{QuestionCircleOutlined:bc,LoadingOutlined:Oc}}=acfwpElements,{Text:xc}=$c,dt=e=>{const{field:t,order:a}=e,{id:s,title:l,type:n,desc:c,desc_tip:o}=t,{validation:r}=acfwAdminApp,[i,d]=Ge(!1),[u,m]=Ge(!1),p=o?acfwpElements.element.createElement("div",{className:"setting-tooltip-content"},o):null,S=f=>{let E=Fn(f,n,t);return m(!E),E};return n==="title"?acfwpElements.element.createElement("div",{className:"form-heading"},acfwpElements.element.createElement("h1",null,l),acfwpElements.element.createElement("p",null,c)):n==="subtitle"?acfwpElements.element.createElement("div",{className:"form-heading ".concat(a>0?"spacer":"")},acfwpElements.element.createElement("h3",null,l),acfwpElements.element.createElement("p",null,c)):acfwpElements.element.createElement(vc,{gutter:16,className:"form-control",id:"".concat(s,"_field"),key:s},a>0?acfwpElements.element.createElement(Rc,null):null,acfwpElements.element.createElement(je,{span:8},acfwpElements.element.createElement("label",{className:"lpfw-setting-field-label"},acfwpElements.element.createElement("strong",null,l)),o?acfwpElements.element.createElement(Ac,{placement:"right",content:p,trigger:"click"},acfwpElements.element.createElement(bc,{className:"setting-tooltip-icon"})):null),acfwpElements.element.createElement(je,{className:"setting-field-column",span:16},acfwpElements.element.createElement(Cc,{field:t,showSpinner:i,setShowSpinner:d,validateInput:S}),i?acfwpElements.element.createElement(Ic,{indicator:acfwpElements.element.createElement(Oc,{style:{fontSize:24},spin:!0})}):null,acfwpElements.element.createElement("div",{className:"invalid-input".concat(u?" show":"")},u?acfwpElements.element.createElement(xc,{type:"danger"},r[n]?r[n]:r.default):null),c?acfwpElements.element.createElement("p",{className:"field-desc",dangerouslySetInnerHTML:{__html:c}}):null))},{element:{useEffect:rr},redux:{bindActionCreators:Dc,connect:Nc},lodash:Pc}=acfwpElements,kc=e=>{const{field:t,show:a,order:s}=e;return a?acfwpElements.element.createElement(dt,{field:t,order:s}):null},Bc=(e,t)=>{var o,r,i,d,u;const{toggle:a}=t.field,s=e.settingValues.findIndex(m=>m.id===a),l=s>=0?e.settingValues[s]:null;let n=(o=l==null?void 0:l.value)!=null?o:null;const c=(i=(r=t.field)==null?void 0:r.toggleValue)!=null?i:"yes";return Pc.isNull(n)&&(n=(u=(d=t.field)==null?void 0:d.default)!=null?u:n),{show:n===c}},Lc=e=>({actions:Dc({},e)}),Vc=Nc(Bc,Lc)(kc);const{element:{useState:B,useEffect:Hc,useMemo:Mc},antd:{Row:Uc,Col:ze,Checkbox:Fc,Select:qe,Popover:Yc,Button:Gc,Progress:jc,message:Ee,Descriptions:te},antdIcons:{QuestionCircleOutlined:zc},axiosInstance:Qe}=acfwpElements,qc=e=>{var G;const{field:t}=e,{id:a,title:s,desc:l,desc_tip:n,placeholder:c,options:o,data:r,labels:i}=t,[d,u]=B((G=r==null?void 0:r.plugin)!=null?G:null),[m,p]=B(r?r==null?void 0:r.deactivate:!0),[S,f]=B(!!(r!=null&&r.plugin)),[E,_]=B(!1),[w,h]=B(0),[y,g]=B({total:0,imported:0,failed:0}),[I,D]=B(0),T=n?acfwpElements.element.createElement("div",{className:"setting-tooltip-content"},n):null,N=Mc(()=>{if(!(o!=null&&o.length)||!d)return"";const C=o==null?void 0:o.findIndex(k=>k.key.toString()===d);return o[C].label},[d]),x=C=>{u(C),_(!1)},P=()=>{f(!0),Qe.post("loyalty-program/v1/tools/import_points",{plugin:d,deactivate:m}).then(()=>A()).catch(C=>{Ee.error(C.response.data.message),f(!1)})},A=()=>{Qe.get("loyalty-program/v1/tools/import_points",{params:{plugin:d}}).then(C=>{const{data:k}=C.data,ft=100-k.pending/k.total*100;if(h(parseInt(ft.toString())),k.pending>0){setTimeout(()=>A(),2e3);return}const{summary:Et,total_points:St}=C.data;f(!1),g(Et),D(St),_(!0),Ee.success(C.data.message)}).catch(C=>{Ee.error(C.response.data.message),f(!1)})};return Hc(()=>{r!=null&&r.plugin&&A()},[]),acfwpElements.element.createElement(Uc,{gutter:16,className:"form-control",id:"".concat(a,"_field"),key:a},acfwpElements.element.createElement(ze,{span:8},acfwpElements.element.createElement("label",{className:"lpfw-setting-field-label tool-field-label"},acfwpElements.element.createElement("strong",null,s)),n?acfwpElements.element.createElement(Yc,{placement:"right",content:T,trigger:"click"},acfwpElements.element.createElement(zc,{className:"setting-tooltip-icon"})):null),acfwpElements.element.createElement(ze,{className:"setting-field-column tool-field-column",span:16},l?acfwpElements.element.createElement("p",{className:"field-desc",dangerouslySetInnerHTML:{__html:l}}):null,acfwpElements.element.createElement("div",{className:"import-points-form-wrapper"},acfwpElements.element.createElement(qe,{style:{width:"100%"},placeholder:c,allowClear:!0,value:d,disabled:S,onSelect:C=>x(C),onClear:()=>x(null)},(o==null?void 0:o.length)&&(o==null?void 0:o.map(({key:C,label:k})=>acfwpElements.element.createElement(qe.Option,{key:C.toString(),value:C.toString()},k)))),acfwpElements.element.createElement(Fc,{className:"deactivate-plugin-checkbox",checked:m,disabled:S,onChange:C=>p(C.target.checked)},i.deactivate_plugin),acfwpElements.element.createElement(Gc,{type:"primary",disabled:!d||E,loading:S,onClick:()=>P()},i.import_btn)),(S||E)&&acfwpElements.element.createElement("div",{className:"import-points-progress-wrapper"},acfwpElements.element.createElement("p",{dangerouslySetInnerHTML:{__html:i.progress_text.replace("%s","<strong>".concat(N,"</strong>"))}}),acfwpElements.element.createElement(jc,{percent:w,status:100>w?"active":"",strokeColor:{from:"#108ee9",to:"#87d068"}}),E&&acfwpElements.element.createElement(te,{column:1,bordered:!0,size:"small"},acfwpElements.element.createElement(te.Item,{label:i.processed},y.imported.toLocaleString()," ",i.users),acfwpElements.element.createElement(te.Item,{label:i.failed},y.failed.toLocaleString()," ",i.users),acfwpElements.element.createElement(te.Item,{label:i.total_imported_points},I.toLocaleString()," ",i.points)))))},Qc=e=>{const{field:t,order:a}=e;return t.id==="import_loyalty_points"?acfwpElements.element.createElement(qc,{field:t,order:a}):t!=null&&t.toggle?acfwpElements.element.createElement(Vc,{field:t,order:a}):acfwpElements.element.createElement(dt,{field:t,order:a})},{element:{Fragment:Je},antd:{Skeleton:We,Divider:Jc},redux:{bindActionCreators:Wc,connect:Kc}}=acfwpElements,Xc=e=>{const{sections:t,settingValues:a,currentSection:s}=e,l=s?t.findIndex(o=>o.id===s):0,n=t.length?t[l].id:"",c=t.length?t[l].fields:[];if(c.length<1||a.length<1){const o=[0,1,2];return acfwpElements.element.createElement(Je,null,acfwpElements.element.createElement(We,{loading:!0,active:!0,paragraph:{rows:1}}),o.map(r=>acfwpElements.element.createElement(Je,null,acfwpElements.element.createElement(Jc,null),acfwpElements.element.createElement(We,{loading:!0,active:!0,paragraph:{rows:2},title:!1}))))}return acfwpElements.element.createElement("div",{className:"settings-form ".concat(n,"-form")},c.map((o,r)=>acfwpElements.element.createElement(Qc,{key:o.id,field:o,order:r})))},Zc=e=>({sections:e.settingSections,settingValues:e.settingValues}),eo=e=>({actions:Wc({},e)}),to=Kc(Zc,eo)(Xc),{element:{Fragment:no,useEffect:Ke},router:{useLocation:ao},antd:{Row:so,Col:Xe},redux:{bindActionCreators:lo,connect:co}}=acfwpElements,{readSections:oo,readSection:ro}=we,io=e=>{const{sections:t,actions:a}=e,{loyalty_program:{tabs:s}}=acfwAdminApp,l=new URLSearchParams(ao().search),n=l.get("section")||"general",c=l.get("tab"),o=s.findIndex(d=>d.slug==="settings"),{label:r,desc:i}=s[o];return Ke(()=>{t.length>0||a.readSections({id:n||"general"})},[]),Ke(()=>{if(t.length<1)return;const d=n?t.findIndex(u=>u.id===n):0;t[d].fields.length<1&&a.readSection({id:n})},[t,a,n]),c!=="settings"?null:acfwpElements.element.createElement(no,null,acfwpElements.element.createElement("div",{className:"tab-header"},acfwpElements.element.createElement("h1",null,r),acfwpElements.element.createElement("p",null,i)),acfwpElements.element.createElement(so,{className:"settings-content"},acfwpElements.element.createElement(Xe,{span:6},acfwpElements.element.createElement(Zs,{currentSection:n})),acfwpElements.element.createElement(Xe,{span:18,className:"content-column"},acfwpElements.element.createElement(to,{currentSection:n}))))},mo=e=>({sections:e.settingSections}),uo=e=>({actions:lo({readSections:oo,readSection:ro},e)}),po=co(mo,uo)(io);const{element:{Fragment:fo,useEffect:Eo,useState:Ze},redux:{bindActionCreators:So,connect:go},antd:{Form:z,Input:et,Button:yo,Typography:wo,Skeleton:_o,message:tt},antdIcons:{CheckCircleFilled:To}}=acfwpElements,{Link:ho}=wo,{readLicenseData:Co,activateLicenseData:$o}=_e,Io=e=>{const{license:t,actions:a}=e,s=acfwAdminApp.loyalty_program.license,[l,n]=Ze(!1),[c,o]=Ze(!1),[r]=z.useForm();Eo(()=>{t?n(!0):a.readLicenseData({alwaysCB:()=>n(!0)})},[]);const i=({key:d,email:u})=>{o(!0),a.activateLicenseData({license_key:d,email:u,successCB:m=>{m.data.status==="success"?tt.success(m.data.message):tt.error(m.data.message)},alwaysCB:()=>o(!1)})};return acfwpElements.element.createElement("div",{className:"acfw-license-box"},acfwpElements.element.createElement("div",{className:"overview"},acfwpElements.element.createElement("h1",null,s.title)),acfwpElements.element.createElement("div",{className:"license-info"},acfwpElements.element.createElement("div",{className:"heading"},acfwpElements.element.createElement("div",{className:"left"},acfwpElements.element.createElement("span",null,s.license_status)),acfwpElements.element.createElement("div",{className:"right"},acfwpElements.element.createElement("span",{className:"action-button active-indicator no-hover ".concat((t==null?void 0:t.is_active)=="yes"?"activated":"")},(t==null?void 0:t.is_active)=="yes"&&acfwpElements.element.createElement(To,null),(t==null?void 0:t.is_active)==="yes"?s.activated:s.not_activated))),acfwpElements.element.createElement("div",{className:"content"},acfwpElements.element.createElement("p",null,s.description),acfwpElements.element.createElement("table",{className:"license-specs"},acfwpElements.element.createElement("thead",null,acfwpElements.element.createElement("tr",null,acfwpElements.element.createElement("th",null,s.plan_label),acfwpElements.element.createElement("th",null,s.version_label))),acfwpElements.element.createElement("tbody",null,acfwpElements.element.createElement("tr",null,acfwpElements.element.createElement("td",null,s.plan_value),acfwpElements.element.createElement("td",null,s.version_value))))),acfwpElements.element.createElement("div",{className:"license-form lpfw-license-form"},l?acfwpElements.element.createElement(fo,null,acfwpElements.element.createElement(z,{layout:"vertical",form:r,initialValues:{key:t!=null&&t.key?t.key:"",email:t!=null&&t.email?t.email:""},onFinish:i},acfwpElements.element.createElement(z.Item,{className:"license-form-item license-key-field",label:s.license_key,name:"key"},acfwpElements.element.createElement(et,{type:"password",autocomplete:"off",required:!0})),acfwpElements.element.createElement(z.Item,{className:"license-form-item activation-email-field",label:s.license_email,name:"email"},acfwpElements.element.createElement(et,{type:"email",autocomplete:"off",required:!0})),acfwpElements.element.createElement(z.Item,{className:"license-form-item form-action"},acfwpElements.element.createElement(yo,{type:"primary",htmlType:"submit",loading:c},s.activate_btn))),acfwpElements.element.createElement("div",{className:"help-row"},s.help.text," ",acfwpElements.element.createElement(ho,{href:s.help.link,target:"_blank"},s.help.login))):acfwpElements.element.createElement(_o,{loading:!0,active:!0,paragraph:{rows:1}}))))},vo=e=>({license:e.license}),Ro=e=>({actions:So({readLicenseData:Co,activateLicenseData:$o},e)}),ut=go(vo,Ro)(Io),Ao=e=>{const{slug:t}=e;if(t==="dashboard")return acfwpElements.element.createElement(pa,null);if(t==="customers")return acfwpElements.element.createElement(pn,null,acfwpElements.element.createElement(Bs,null));if(t==="settings")return acfwpElements.element.createElement(po,null);if(t==="license"){const{is_multisite:a}=acfwAdminApp.loyalty_program.license;return a?(window.location.href=acfwAdminApp.loyalty_program.license.license_page,null):acfwpElements.element.createElement(ut,null)}return null},{element:{useState:nt,useEffect:bo},router:{useHistory:Oo,useLocation:xo},antd:{Tabs:pt},appStore:{store:ne},pathPrefix:at}=acfwpElements,{TabPane:Do}=pt,No=()=>{const{logo:e,loyalty_program:{title:t,tabs:a}}=acfwAdminApp,[s,l]=nt(""),n=new URLSearchParams(xo().search),[c,o]=nt(n.get("tab")),r=c?a.findIndex(m=>m.slug===c):0,i=Oo();bo(()=>{s||l(ne.getState().page)},[]);const d=()=>{const m=ne.getState().page;s!==m&&l(m)};ne.subscribe(d);const u=m=>{a[m].slug==="license"?(i.push("".concat(at,"admin.php?page=acfw-license&tab=LPFW")),ne.dispatch({type:"SET_STORE_PAGE",payload:{data:"acfw-license/LPFW"}})):(o(a[m].slug),i.push("".concat(at,"admin.php?page=acfw-loyalty-program&tab=").concat(a[m].slug)))};return s==="acfw-license/LPFW"?acfwpElements.element.createElement(ut,null):s!=="acfw-loyalty-program"?null:acfwpElements.element.createElement("div",{className:"lpfw-app acfw-admin-app"},acfwpElements.element.createElement("div",{className:"page-header loyalty-program-header"},acfwpElements.element.createElement("img",{className:"acfw-logo",src:e,alt:"acfw logo"}),acfwpElements.element.createElement("h1",null,t)),acfwpElements.element.createElement(pt,{activeKey:r+"",defaultActiveKey:r+"",onTabClick:u},a.map((m,p)=>acfwpElements.element.createElement(Do,{tab:m.label,key:p},acfwpElements.element.createElement(Ao,{slug:m.slug})))))},{dom:Po,router:{BrowserRouter:ko,Route:Bo},pathPrefix:Lo,appStore:{Provider:Vo,store:ir}}=acfwpElements,Ho=rn();document.querySelectorAll("#lpfw_admin_app").forEach(e=>{Po.render(acfwpElements.element.createElement(Vo,{store:Ho},acfwpElements.element.createElement(ko,null,acfwpElements.element.createElement(Bo,{path:"".concat(Lo,"admin.php"),component:No}))),e)});export{Mo as __vite_legacy_guard};
